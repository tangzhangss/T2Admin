!function(r,o){var c={init:function(n){var p={ajaxUrl:!1,multiple:!1,inline:!0,valueClass:!1,selectClass:!1,searchOn:!1,addBtn:!1,items:[],itemsCount:!1,labelEdit:!1,labelShow:!0,cellCount:4,ztree:!1,ztreeSetting:!1,title:!1,changeCallback:!1,handle:!1,groupFlag:!1,initFlag:!0,width:!1,height:!1,top:!1,splitStr:",",parentSelect:!1,dragParams:{left:0,top:0,currentX:0,currentY:0,flag:!1}};return this.each(function(e,t){var a=r.extend(!0,{},p,n),s=r(t);if((a.elem=s).data("options",a),a.ajaxUrl&&"string"==typeof a.ajaxUrl)r.ajax({type:"get",url:a.ajaxUrl,datatype:"json",async:!0,success:function(e){a.items="string"==typeof e?JSON.parse(e.items):e.items;var t=r('<input type="hidden" >');t.insertAfter(s),s.data("values",t),s.attr("name")&&(t.attr("name",s.attr("name")),s.attr("name","pops"+s.attr("name"))),s.attr("mustinput")&&""!=s.attr("mustinput")&&(t.attr("mustinput",s.attr("mustinput")),t.attr("title",s.attr("title")),s.removeAttr("mustinput")),s.data("items",a.items),a.ztree?(c.popTreeInit(a,s),c.showTreeValueDiv(s,a),c.itemsToJson(a)):(c.showValueDiv(s,a),c.buildSelectValue(s,a),c.initEvent(s),c.itemsToJson(a),c.initValue(s,a))},error:function(){console.log("数据源加载失败")}});else{s.is("input")||s.is("select")&&(r.isArray(a.items)&&0!=a.items.length||(a.items=c.getItemsBySelect(s)));var i=r('<input type="hidden" >');i.insertAfter(s),s.data("values",i),s.attr("name")&&(i.attr("name",s.attr("name")),s.attr("name","pops"+s.attr("name"))),s.attr("mustinput")&&""!=s.attr("mustinput")&&(i.attr("mustinput",s.attr("mustinput")),i.attr("title",s.attr("title")),s.removeAttr("mustinput")),s.data("items",a.items),a.ztree?(c.popTreeInit(a,s),c.showTreeValueDiv(s,a),c.itemsToJson(a)):(c.showValueDiv(s,a),c.buildSelectValue(s,a),c.initEvent(s),c.itemsToJson(a),c.initValue(s,a))}})},destroy:function(){return this.each(function(){})},initValue:function(e,t){var a=e.val(),s=[];a&&-1<a.indexOf(t.splitStr)?(s=a.split(t.splitStr),s=r.grep(s,function(e){return 0<r.trim(e).length})):a&&s.push(a);for(var i=e.data("popsparm"),n=0;n<s.length;n++)t.inline?c.setSelectValue(t,e,s[n]):(c.setChooseInitValue(t,e,i.find(".option-input[data-id="+s[n]+"]")),c.confirmValue(t,e));t.initFlag=!1},cleanValue:function(e,t){var a=e.data("popsparm"),s=e.data("popsvalue");if(t.inline){t.itemMap;if(t.multiple)a.find(".pops-item").removeClass("on"),s.find(".pops-label").remove();else s.html("")}else a.find(".pops-select-search").find(".pops-label").remove(),a.find(".option-input").prop("checked",!1),a.find(".pops-item").removeClass("pitch"),s.empty();e.val(""),e.data("text",""),e.data("values").val(""),c.hideSelect(e),t.initFlag=!1},showSelectValue:function(e,t){var a=e.data("values").val(),s=[];a&&-1<a.indexOf(t.splitStr)?s=a.split(t.splitStr):a&&s.push(a);var i=e.data("popsparm");c.clearValue(t,e),i.find(".pops-item").removeClass("pitch");for(var n=0;n<s.length;n++)if(s[n]){var p=i.find(".pops-item[data-id="+s[n]+"]");p.find(".option-input").prop("checked",!0);var o=r(c.getMultipleHtml(p,t));o.appendTo(i.find(".pops-select-search")),c.setLabelEvent(o,t),i.find(".pops-item[data-id="+p.data("id")+"]").addClass("pitch")}},getItemsBySelect:function(e){var s=[];return e.find("option").each(function(e,t){var a={};a.id=r(t).val(),a.name=r(t).text(),s.push(a)}),s},showValueDiv:function(e,t){var a=r('<div class="pops-value"></div>');t.valueClass&&"string"==typeof t.valueClass&&a.addClass(t.valueClass),a.css("min-height",e.outerHeight()-2),e.css("display","none"),a.insertAfter(e),a.bind("click",function(){c.showSelect(this,e)}),t.handle&&r(t.handle).bind("click",function(){return c.showSelect(this,e),!1}),e.data("popsvalue",a)},buildSelectValue:function(e,t){if(t.inline){var a=r(c.getInlineSelectHtml());e.parent().find(".pops-select").remove(),a.insertAfter(e);var s=r(c.getInlineItemsHtml(t.items));if(a.find(".pops-select-body").append(s),e.data("popsparm",a),s.find(".pops-item").bind("click",function(){c.setSelectValue(t,e,r(this).data("id"))}),t.searchOn){var i=r(c.getSearchHtml());a.find(".pops-select-head").append(i),a.find(".pops-search-input").bind("keyup",function(){c.searchItems(t,r(this).val())}),"function"==typeof r.fn.placeholder&&i.find("input").placeholder({isUseSpan:!0,all:!1})}if(t.addBtn&&!r.isEmptyObject(t.addBtn)){var n=r(c.getAddBtnHtml());a.find(".pops-select-foot").append(n),n.find(".pops-addbtn-btn").text(t.addBtn.title),t.addBtn.fun&&"function"==typeof t.addBtn.fun&&n.bind("click",function(){t.addBtn.fun.call(this,e.data("values"),e)}),t.addBtn.icon&&"string"==typeof t.addBtn.icon?n.find("i").addClass(t.addBtn.icon):n.find("i").addClass("pops-addbtn-icon").html("+")}}else{a=r(c.getOutlineSelectHtml(t));r("body").append(a);s=r(c.getOutlineItemsHtml(t.items,t));if(a.find(".pops-select-body").append(s),e.data("popsparm",a),s.find(".pops-item").bind("click",function(){c.setChooseValue(t,e,r(this).find(".option-input"))}),t.labelShow||a.find(".pops-select-search").hide(),t.title&&a.find(".pops-select-head").append('<span class="pops-select-title">'+t.title+"</span>"),t.addBtn&&!r.isEmptyObject(t.addBtn)){n=r(c.getTreeAddBtnHtml());a.find(".pops-select-head").append(n),n.text(t.addBtn.title),t.addBtn.fun&&"function"==typeof t.addBtn.fun&&n.bind("click",function(){t.addBtn.fun.call(this,e,e.data("values"))})}if(t.searchOn){i=r(c.getSearchHtml());a.find(".pops-select-head").append(i),a.find(".pops-search-input").bind("keyup",function(){c.searchItems(t,r(this).val())}),"function"==typeof r.fn.placeholder&&i.find("input").placeholder({isUseSpan:!0,all:!1})}a.find(".pops-select-head .pops-close").bind("click",function(){c.hideSelect(e)}),a.find(".pops-select-foot .pops-btn-confirm").bind("click",function(){c.confirmValue(t,e)}),c.startDrag(a.find(".pops-select-head")[0],a.find(".pops-select")[0],t)}},showSelect:function(e,t){if(t.prop("readonly")||"readonly"==t.attr("readonly"))return!1;var a=t.data("popsparm"),s=t.data("options");if(r(".pops-select").hide(),t.data("options").inline){t.data("popsvalue");if(r(".pops-select").css("z-index","1"),a.css("min-width",t.outerWidth()+"px"),a.css("z-index","19911027"),0!=a.find(".pops-item").not(".on").length){var i;if(a.show(),"number"==typeof s.itemsCount){i=a.find(".pops-item").not('[data-id=""]').not(".on").outerHeight(!0)*s.itemsCount;var n=o.innerHeight-a.find(".pops-select-head").outerHeight()-a.find(".pops-select-foot").outerHeight()-r(e).offset().top-r(e).outerHeight()-a.find(".pops-item[data-id='']").outerHeight(!0)-5;r(".formRowCenter")&&(n-=r(".formRowCenter").outerHeight(!0)),n<i?(a.css("top",""),a.css("bottom",r(e).outerHeight()+"px")):(a.css("bottom",""),a.css("top",r(e).offset().top+r(e).outerHeight()+"px"))}else i=o.innerHeight-a.find(".pops-select-head").outerHeight()-a.find(".pops-select-foot").outerHeight()-r(e).offset().top-r(e).outerHeight()-5,r(".formRowCenter")&&(i-=r(".formRowCenter").outerHeight(!0)),i<170?(i=r(e).offset().top-a.find(".pops-select-head").outerHeight()-a.find(".pops-select-foot").outerHeight(),a.css("top",""),a.css("bottom",r(e).outerHeight()+"px")):(a.css("bottom",""),a.css("top",r(e).position().top+r(e).outerHeight()+"px")),a.css("left",r(e).position().left+"px");a.find(".pops-select-body").css("max-height",i+"px")}}else{var p=a.find(".pops-select");r(".pops-select").css("z-index","1"),r(".pops-select").css("left",""),r(".pops-select").css("top",""),r(".pops-select").css("margin","0 auto"),s.width&&p.css("width",s.width),s.height&&p.css("height",s.height),s.top&&p.css("top",s.top),p.css("z-index","19911027"),a.find(".pops-select").show(),a.show(),c.showSelectValue(t,t.data("options"))}},resetSelect:function(e){var t=e.data("popsvalue");if(e.data("options").inline){var a=e.data("popsparm");e.data("popsvalue");r(".pops-select").css("z-index","1"),r(".pops-select").hide(),a.css("min-width",t.outerWidth()+"px"),a.css("z-index","19911027"),a.show();var s=o.innerHeight-a.find(".pops-select-head").outerHeight()-a.find(".pops-select-foot").outerHeight()-r(t).offset().top-r(t).outerHeight()-5;r(".formRowCenter")&&(s-=r(".formRowCenter").outerHeight(!0)),s<170?(s=r(t).offset().top-a.find(".pops-select-head").outerHeight()-a.find(".pops-select-foot").outerHeight(),a.css("top",""),a.css("bottom",r(t).outerHeight()+"px")):(a.css("bottom",""),a.css("top",r(t).position().top+r(t).outerHeight()+"px")),a.css("left",r(t).position().left+"px"),a.find(".pops-select-body").css("max-height",s+"px")}},hideSelect:function(e){var t=e.data("popsparm");e.data("options");t.hide(),c.searchItems(e.data("options"))},hideAll:function(){r(".pops-select").each(function(){0<r(this).parents(".pops-bg").length?r(this).parents(".pops-bg").hide():r(this).hide()})},getSearchHtml:function(){var e=[];return e.push('<div class="pops-search">'),e.push('\t<input type="text" class="pops-search-input"  placeholder="输入关键字"/>'),e.push('\t<i class="i i-fangdajing pops-search-btn"></i>'),e.push("</div>"),e.join(" ")},getAddBtnHtml:function(){var e=[];return e.push('<div class="pops-addbtn"><i></i>'),e.push('\t<button type="button" class="pops-addbtn-btn"></button>'),e.push("</div>"),e.join(" ")},getInlineSelectHtml:function(){var e=[];return e.push('<div class="pops-select">'),e.push('\t<div class="pops-select-head">'),e.push("\t</div>"),e.push('\t<div class="pops-select-body">'),e.push("\t</div>"),e.push('\t<div class="pops-select-foot">'),e.push("\t</div>"),e.push("</div>"),e.join(" ")},getInlineItemsHtml:function(e){var a=[];return a.push('\t<ul class="pops-items">'),r.each(e,function(e,t){a.push('\t<li class="pops-item" data-id="'+t.id+'">'),void 0!==t.id&&void 0!==t.name?a.push("<span>"+t.name+"</span>"):a.push("<span>"+t.id+"</span>"),a.push("\t</li>")}),a.push("\t</ul>"),a.join(" ")},getOutlineSelectHtml:function(e){var t=[];return t.push('<div class="pops-bg">'),t.push('<div class="pops-select" >'),t.push('\t<div class="pops-select-head">'),t.push('\t<i class="pops-close"></i>'),t.push("\t</div>"),t.push('\t<div class="pops-select-search">'),t.push("\t</div>"),e.multiple?(t.push('\t<div class="pops-select-body has-confirm">'),t.push("\t</div>"),t.push('\t<div class="pops-select-foot">'),t.push('\t<button type="button" class="pops-btn-confirm">确认</button>')):t.push('\t<div class="pops-select-body">'),t.push("\t</div>"),t.push("</div>"),t.push("</div>"),t.join(" ")},getOutlineItemsHtml:function(e,s){var i=[],n=0;return i.push('\t<table class="pops-items">'),s.groupFlag?r.each(e,function(e,a){r.each(a.items,function(e,t){e%s.cellCount==0&&(i.push('\t<tr class="pops-item-tr '),0==e&&i.push("group-tr"),i.push('">')),0==e&&(i.push('\t<td class="group-td" rowspan="'+Math.ceil(a.items.length/s.cellCount)+'">'),i.push('\t<span class="group-td-name">'),i.push(a.groupName),i.push(":\t</span>"),i.push("\t</td>")),n++,i.push('\t<td class="pops-item" data-id="'+t.id+'">'),s.multiple?i.push('<label title="'+t.name+'"><input  data-id="'+t.id+'" type="checkbox" class="option-input checkbox" /><span class="name-span">'+(void 0===t.name?t.id:t.name)+'</span><i class="i i-sanjiaoduihao"></i></label>'):i.push('<label title="'+t.name+'" class="label-radio"><input  data-id="'+t.id+'" type="radio" class="option-input option-radio checkbox" /><span class="radio-span"><span class="i i-radio2"></span><span class="i i-radio1"></span></span><span class="name-span">'+(void 0===t.name?t.id:t.name)+"</span></label>"),i.push("\t</td>"),n%s.cellCount==0&&(n=0,i.push("\t</tr>"))})}):r.each(e,function(e,t){e%s.cellCount==0&&i.push('\t<tr class="pops-item-tr">'),n++,i.push('\t<td class="pops-item" data-id="'+t.id+'">'),s.multiple?i.push('<label title="'+t.name+'"><input  data-id="'+t.id+'" type="checkbox" class="option-input checkbox" /><span class="name-span">'+(void 0===t.name?t.id:t.name)+'</span><i class="i i-sanjiaoduihao"></i></label>'):i.push('<label title="'+t.name+'" class="label-radio"><input  data-id="'+t.id+'" type="radio" class="option-input option-radio checkbox" /><span class="radio-span"><span class="i i-radio2"></span><span class="i i-radio1"></span></span><span class="name-span">'+(void 0===t.name?t.id:t.name)+"</span></label>"),i.push("\t</td>"),n%s.cellCount==0&&(n=0,i.push("\t</tr>"))}),i.push("\t</table>"),i.join(" ")},initEvent:function(e){r(o).bind("click",function(e){r(e.target).hasClass("pops-value")||r(e.target).hasClass("pops-select")||0!=r(e.target).parents(".pops-select").length||0!=r(e.target).parents(".pops-value").length||c.hideAll()})},setSelectValue:function(e,t,a){var s=t.data("popsvalue"),i=t.data("popsparm"),n=e.itemMap,p=e.changeCallback;if(e.multiple){var o=i.find(".pops-item[data-id="+a+"]");if(o.hasClass("on"))o.removeClass("on"),s.find(".pops-label[data-id="+a+"]").remove();else{o.addClass("on");var l=r(c.getMultipleHtml(o,e));l.appendTo(s),c.setInlineLabelEvent(l,e)}0==i.find(".pops-item").not(".on").length?c.hideSelect(t):e.initFlag||c.showSelect(s,t),c.setElemValue(e,t)}else n[a]&&n[a].name&&(s.html(n[a].name),t.data("text",n[a].name)),t.val(a),t.data("values").val(a),c.hideSelect(t),e.initFlag||p&&"function"==typeof p&&p.call(this,t)},clearOneValue:function(e,t){e.elem.data("popsparm").find(".pops-label[data-id="+r(t).data("id")+"]").remove()},clearValue:function(e,t){var a=t.data("popsparm");a.find(".pops-label").remove(),a.find(".option-input").prop("checked",!1)},getMultipleHtml:function(e,t){var a=t.itemMap,s=[];return t.labelShow?s.push('<div class="pops-label" data-id="'+r(e).data("id")+'">'):s.push('<div class="pops-label off" data-id="'+r(e).data("id")+'">'),s.push('<div class="pops-label-alt">'),s.push(a[r(e).data("id")].name),s.push("</div>"),s.push('\t<i class="pops-close"></i>'),t.labelEdit&&"function"==typeof t.labelEdit&&s.push('\t<i class="pops-edit"></i>'),s.push("</div>"),s.join(" ")},setChooseValue:function(e,t,a){var s=t.data("popsparm");e.itemMap;if(e.multiple)if(a.prop("checked")){if(0<s.find(".pops-select-search .pops-label[data-id="+a.data("id")+"]").length)return!1;(i=r(c.getMultipleHtml(a,e))).appendTo(s.find(".pops-select-search")),c.setLabelEvent(i,e),s.find(".pops-item[data-id="+a.data("id")+"]").addClass("pitch")}else c.clearOneValue(e,a),s.find(".pops-item[data-id="+a.data("id")+"]").removeClass("pitch");else{var i;if(a.prop("checked"))c.clearValue(e,t),s.find(".pops-item").removeClass("pitch"),(i=r(c.getMultipleHtml(a,e))).appendTo(s.find(".pops-select-search")),c.setLabelEvent(i,e),s.find(".option-input[data-id="+a.data("id")+"]").prop("checked",!0),s.find(".pops-item[data-id="+a.data("id")+"]").addClass("pitch");else c.clearOneValue(e,a);c.confirmValue(e,t)}},setChooseInitValue:function(e,t,a){var s=t.data("popsparm"),i=r(c.getMultipleHtml(a,e));i.appendTo(s.find(".pops-select-search")),c.setLabelEvent(i,e),s.find(".option-input[data-id="+a.data("id")+"]").prop("checked",!0),s.find(".pops-item[data-id="+a.data("id")+"]").addClass("pitch")},setInlineLabelEvent:function(e,t){t.changeCallback;e.find(".pops-close").bind("click",function(){return t.elem.data("popsparm").find(".pops-item[data-id="+r(this).parent().data("id")+"]").removeClass("on").show(),r(this).parent().remove(),c.resetSelect(t.elem),c.setElemValue(t,t.elem),!1}),e.find(".pops-edit").bind("click",function(){return t.labelEdit.call(this,t.itemMap[r(this).parent().data("id")]),!1})},setLabelEvent:function(e,a){e.find(".pops-close").bind("click",function(){var e=a.elem.data("popsparm"),t=r(this).parent().data("id");return e.find(".option-input[data-id="+t+"]").prop("checked",!1),e.find(".pops-label[data-id="+t+"]").remove(),r(this).parent().remove(),!1}),e.find(".pops-edit").bind("click",function(){return a.labelEdit.call(this,a.itemMap[r(this).parent().data("id")]),!1})},setValueLabelEvent:function(e,a){e.find(".pops-close").bind("click",function(){var e=a.elem.data("popsparm"),t=r(this).parent().data("id");return e.find(".option-input[data-id="+t+"]").prop("checked",!1),e.find(".pops-label[data-id="+t+"]").remove(),r(this).parent().remove(),c.confirmValue(a,a.elem),!1}),e.find(".pops-edit").bind("click",function(){return a.labelEdit.call(this,a.itemMap[r(this).parent().data("id")]),!1})},confirmValue:function(s,e){var i=e.data("popsvalue"),t=e.data("popsparm");s.itemMap;i.empty(),t.find(".pops-label").each(function(e,t){var a=r(c.getMultipleHtml(t,s));a.appendTo(i),c.setValueLabelEvent(a,s)}),c.hideSelect(e),c.setElemValue(s,e)},setElemValue:function(a,e){var t=e.data("popsvalue"),s="",i=a.changeCallback;t.find(".pops-label").each(function(e,t){a.multiple?s+=r(t).data("id")+a.splitStr:s=r(t).data("id")}),0<s.length&&(s=s.substring(0,s.length-1)),e.data("values").val(s),a.initFlag||i&&"function"==typeof i&&i.call(this,e)},itemsToJson:function(e){var a={},t=e.items;e.groupFlag?r.each(t,function(e,t){r.each(t.items,function(e,t){a[t.id]=t})}):r.each(t,function(e,t){a[t.id]=t}),e.itemMap=a},searchItems:function(e,a){var s={},t=e.elem.data("popsparm");a&&a.trim()?r.each(e.items,function(e,t){t.name&&-1<t.name.indexOf(a)&&(s[t.id]=t)}):(s=e.itemMap,0<t.find(".pops-search-input").length&&t.find(".pops-search-input").val("")),e.inline?t.find(".pops-select-body .pops-item").each(function(e,t){s[r(t).data("id")]&&!r(t).hasClass("on")?r(t).show():r(t).hide()}):(t.find(".pops-item-tr").hide(),t.find(".pops-select-body .pops-item").each(function(e,t){s[r(t).data("id")]?(r(t).show(),r(t).parent().show()):r(t).hide()})),e.elem.data("popsparm",t)},addItem:function(n){this.each(function(){var e=r(this),t=e.data("options"),a=e.data("popsparm");if(t.items.push(n),c.itemsToJson(t),t.inline){(i=[]).push('\t<li class="pops-item" data-id="'+n.id+'">'),i.push("<span>"+n.name+"</span>"),i.push("\t</li>");var s=r(i.join(" "));a.find(".pops-items").append(s),s.bind("click",function(){c.setSelectValue(t,e,r(this).data("id"))})}else{var i=[];if((t.items.length-1)%3==0){i.push('\t<tr class="pops-item-tr">'),i.push('\t<td class="pops-item" data-id="'+n.id+'">'),t.multiple?i.push('<label><input  data-id="'+n.id+'" type="checkbox" class="option-input checkbox" /><span class="name-span">'+n.name+"</span></label>"):i.push('<label class="label-radio"><input  data-id="'+n.id+'" type="radio" class="option-input option-radio checkbox" /><span class="radio-span"><span class="i i-radio2"></span><span class="i i-radio1"></span></span><span class="name-span">'+n.name+"</span></label>"),i.push("\t</td>"),i.push("\t</tr>");s=r(i.join(" "));a.find(".pops-items tbody").append(s),s.find(".pops-item").bind("click",function(){c.setChooseValue(t,e,r(this).find(".option-input"))})}else{i.push('\t<td class="pops-item" data-id="'+n.id+'">'),t.multiple?i.push('<label><input  data-id="'+n.id+'" type="checkbox" class="option-input checkbox" /><span class="name-span">'+n.name+"</span></label>"):i.push('<label class="label-radio"><input  data-id="'+n.id+'" type="radio" class="option-input option-radio checkbox" /><span class="radio-span"><i class="i i-radio2"></i><i class="i i-radio1"></i></span><span class="name-span">'+n.name+"</span></label>"),i.push("\t</td>");s=r(i.join(" "));a.find(".pops-items .pops-item-tr").eq(a.find(".pops-items .pops-item-tr").length-1).append(s),s.bind("click",function(){c.setChooseValue(t,e,r(this).find(".option-input"))})}}})},updateItems:function(a){this.each(function(){var e=r(this),t=e.data("options");e.data("popsparm");t.items=a,c.itemsToJson(t),e.data("items",t.items),c.buildSelectValue(e,t),c.initEvent(e),c.itemsToJson(t),c.clearnValue(e,t)})},clearnValue:function(e,t){e.data("popsvalue").empty(),e.data("values").val("")},selectedItem:function(o){this.each(function(){var e=r(this),t=e.data("options"),a=e.data("popsparm"),s=e.data("popsvalue"),i=t.changeCallback;if(t.inline)if(t.multiple){if((p=a.find(".pops-item[data-id="+o.id+"]")).hasClass("on"))p.removeClass("on"),s.find(".pops-label[data-id="+o.id+"]").remove();else p.addClass("on"),(n=r(c.getMultipleHtml(p,t))).appendTo(s),c.setInlineLabelEvent(n,t);c.setElemValue(t,e)}else s.html(o.name),e.val(o.id),e.data("text",o.name),e.data("values").val(o.id),c.hideSelect(e),t.initFlag||i&&"function"==typeof i&&i.call(this,e);else if(t.multiple){var n;if((p=a.find(".pops-item input[data-id="+o.id+"]")).prop("checked",!0),0<a.find(".pops-select-search .pops-label[data-id="+p.data("id")+"]").length)return!1;(n=r(c.getMultipleHtml(p,t))).appendTo(a.find(".pops-select-search")),c.setLabelEvent(n,t),a.find(".pops-item[data-id="+p.data("id")+"]").addClass("pitch")}else{var p;(p=a.find(".pops-item input[data-id="+o.id+"]")).prop("checked",!0),c.clearValue(t,e),a.find(".pops-item").removeClass("pitch"),c.setSelectValue(t,e,p.data("id"))}})},popTreeInit:function(e,t){var a=r(c.popTreeHtml(e));t.data("tree",a),r("body").append(a);var s={callback:{onClick:c.zTreeOnClick},check:{enable:!1},data:{simpleData:{enable:!0}},view:{fontCss:c.getFont}};e.multiple&&(s.check.enable=!0,a.find(".pops-btn-confirm").bind("click",function(){c.setTreeMultiple(e,t)}));var i=r.extend(s,e.ztreeSetting),n=(t.attr("id")?t.attr("id"):t.attr("name"),(new Date).getTime());a.find(".ztree").attr("id","poptree-"+n),t.data("ztreeId","poptree-"+n);var p=r.extend(!0,[],e.items);e.zNodes=p,e.popSetting=i;var o=r.fn.zTree.init(a.find(".ztree"),i,p);if(t.data("ztreeObj",o),e.title&&"string"==typeof e.title&&a.find(".pops-tree-title").html(e.title),e.addBtn&&!r.isEmptyObject(e.addBtn)){var l=r(c.getTreeAddBtnHtml());a.find(".pops-tree-foot").append(l),l.text(e.addBtn.title),e.addBtn.fun&&"function"==typeof e.addBtn.fun&&l.bind("click",function(){e.addBtn.fun.call(this,o,t)})}if(e.searchOn){var d=r(c.getTreeSearchHtml());a.find(".pops-tree-search").append(d),c.popTreeInitSearchEvent(e,t),"function"==typeof r.fn.placeholder&&d.find("input").placeholder({isUseSpan:!0,all:!1})}a.bind("click",function(e){r(e.target).hasClass("pops-value")||r(e.target).hasClass("pops-tree")||0!=r(e.target).parents(".pops-tree").length||0!=r(e.target).parents(".pops-value").length||c.popTreeHide()}),a.find(".pops-close").bind("click",function(e){c.popTreeHide()}),a.data("elem",t),e.initFlag=!1,c.startDrag(a.find(".pops-tree-head")[0],a.find(".pops-tree")[0],e)},initTreeValue:function(s,i){var e=s.val(),t=s.data("ztreeObj"),a=[];if(e&&-1<e.indexOf(i.splitStr)?(a=e.split(i.splitStr),a=r.grep(a,function(e){return 0<r.trim(e).length})):e&&a.push(e),i.multiple){for(var n=[],p=0;p<a.length;p++){0<(o=t.getNodesByParam("id",a[p],null)).length&&(o[0].checked=!0,t.updateNode(o[0]),n.push(o[0]))}r.each(n,function(e,t){var a=r(c.getTreeLabelHtml(t,i));a.appendTo(s.data("popsvalue")),c.setTreeLabelEvent(a,i)}),r(s).data("treeNode",n),c.setElemValue(i,s),c.popTreeHide(s)}else{var o;if(0<(o=t.getNodesByParam("id",a[0],null)).length){var l=o[0],d=r(c.getTreeLabelHtml(l,i));d.appendTo(s.data("popsvalue")),r(s).data("treeNode",l),c.setTreeLabelEvent(d,i),c.setElemValue(i,s)}}i.initFlag=!1},showTreeValueDiv:function(e,t){var a=r('<div class="pops-value"></div>'),s=e.data("tree");t.valueClass&&"string"==typeof t.valueClass&&a.addClass(t.valueClass),a.css("min-height",e.outerHeight()),a.insertAfter(e),a.bind("click",function(){if(e.prop("readonly")||"readonly"==e.attr("readonly"))return!1;r(".pops-select").hide(),s.find(".pops-tree").css({left:"",right:"",margin:"0 auto","margin-top":"5%"}),s.show()}),t.handle&&r(t.handle).bind("click",function(){return r(".pops-select").hide(),s.show(),!1}),e.data("popsvalue",a),e.css("display","none"),c.initTreeValue(e,t),t.initFlag=!1},popTreeHtml:function(e){var t=[];return t.push('<div class="pops-bg">'),t.push('<div class="pops-tree">'),t.push('\t<div class="pops-tree-head">'),t.push('\t<span class="pops-tree-title"></span>'),t.push('\t<i class="pops-close"></i>'),t.push("\t</div>"),t.push('\t<div class="pops-tree-search">'),t.push("\t</div>"),t.push('\t<div class="pops-tree-body">'),t.push('\t<ul class="pops-tree-ztree ztree">'),t.push("\t</ul>"),t.push("\t</div>"),t.push('\t<div class="pops-tree-foot">'),e.multiple&&t.push('\t<button type="button" class="pops-btn-confirm">确认</button>'),t.push("\t</div>"),t.push("</div>"),t.push("</div>"),t.join(" ")},getTreeLabelHtml:function(e,t){var a=[];return a.push('<div class="pops-label" data-id="'+e.id+'">'),a.push('<div class="pops-label-alt">'),a.push(e.name),a.push("</div>"),a.push('\t<i class="pops-close"></i>'),t.labelEdit&&"function"==typeof t.labelEdit&&a.push('\t<i class="pops-edit"></i>'),a.push("</div>"),a.join(" ")},popTreeHide:function(e){r(".pops-bg").hide()},getTreeSearchHtml:function(){var e=[];return e.push('<div class="pops-search">'),e.push('\t<input type="text" class="pops-search-input"  placeholder="输入关键字"/>'),e.push('\t<i class="i i-fangdajing pops-search-btn"></i>'),e.push("</div>"),e.join(" ")},getTreeAddBtnHtml:function(){var e=[];return e.push('\t<button type="button" class="pops-tree-addbtn"></button>'),e.join(" ")},popTreeInitSearchEvent:function(t,a){var s=a.data("tree");s.find(".pops-search-btn").bind("click",function(){var e=s.find(".pops-search-input").val();c.searchTreeNode(t,a,e)})},popTreeInitAddBtnEvent:function(e,t){t.data("tree").find(".pops-addbtn").bind("click",function(){console.log("新增按钮")})},showTreeNode:function(e,s){r.each(e,function(e,t){var a=t.getParentNode();for(s.find(".pops-tree-ztree #"+t.tId).show();a;)s.find(".pops-tree-ztree #"+a.tId).show(),a=a.getParentNode()})},searchTreeNode:function(e,t,a){var s=t.data("tree"),i=r.fn.zTree.init(s.find(".ztree"),e.popSetting,e.zNodes);if(a&&""!=a&&void 0!==a){var n=i.getNodesByParamFuzzy("name",a,null),p=[];r.each(n,function(e,t){t.font={color:"red"},t.open=!0;var a=t.getParentNode();null!=a&&(a.open=!0,a.children=[],-1==r.inArray(a,p)&&-1==r.inArray(a,n)&&p.push(a))});var o=r.merge(n,p);i=r.fn.zTree.init(s.find(".ztree"),e.popSetting,o),t.data("ztreeObj",i)}else i.expandAll(!1),t.data("ztreeObj",i)},getFont:function(e,t){return t.font?t.font:{}},setTreeLabelEvent:function(e,t){e.find(".pops-close").bind("click",function(){return r(this).parent().remove(),c.setElemValue(t,t.elem),!1}),e.find(".pops-edit").bind("click",function(){return t.labelEdit.call(this,t.itemMap[r(this).parent().data("id")]),!1})},zTreeOnClick:function(e,t,a){var s=r(e.target).parents(".pops-bg").data("elem"),i=s.data("options"),n=s.data("popsvalue");if(!a.isParent||i.parentSelect)if(i.multiple);else{n.empty();var p=r(c.getTreeLabelHtml(a,i));p.appendTo(n),r(s).data("treeNode",a),c.setTreeLabelEvent(p,i),c.setElemValue(i,s),c.popTreeHide(s)}},setTreeMultiple:function(s,e){var t=e.data("ztreeObj"),i=e.data("popsvalue"),a=t.getCheckedNodes(!0);i.empty();var n=[];r.each(a,function(e,t){if(!t.isParent||s.parentSelect){var a=r(c.getTreeLabelHtml(t,s));n.push(t),a.appendTo(i),c.setTreeLabelEvent(a,s)}}),r(e).data("treeNode",n),c.setElemValue(s,e),c.popTreeHide(e)},selectedTreeItem:function(o){this.each(function(){var e=r(this),s=(e.data("tree"),e.data("options")),t=e.data("ztreeObj"),i=e.data("popsvalue");if(s.multiple){o.checked=!0;var a=t.getCheckedNodes(!0);i.empty();var n=[];r.each(a,function(e,t){if(!t.isParent||s.parentSelect){var a=r(c.getTreeLabelHtml(t,s));n.push(t),a.appendTo(i),c.setTreeLabelEvent(a,s)}}),e.data("treeNode",n),c.setElemValue(s,e)}else{i.empty();var p=r(c.getTreeLabelHtml(o,s));p.appendTo(i),e.data("treeNode",o),c.setTreeLabelEvent(p,s),c.setElemValue(s,e)}})},updateTreeItems:function(e){this.each(function(){var t,a=r(this),s=a.data("options"),i=(a.data("popsparm"),a.data("ztreeId")),n=a.data("popsvalue"),p=s.popSetting,o=a.data("tree");e.ajaxUrl&&"string"==typeof e.ajaxUrl?r.ajax({type:"get",url:e.ajaxUrl,datatype:"json",async:!0,success:function(e){e.items&&"string"==typeof e.items?s.items=JSON.parse(e.items):s.items=e.items,a.data("items",s.items),r.fn.zTree.destroy(i),t=r.fn.zTree.init(o.find(".ztree"),p,s.items),n.remove(),c.showTreeValueDiv(a,s),c.itemsToJson(s),s.zNodes=s.items,a.data("options",s),c.popTreeInitSearchEvent(s,a)},error:function(){console.log("数据源加载失败")}}):"object"==typeof e&&(r.fn.zTree.destroy(i),s.items=e,a.data("items",s.items),t=r.fn.zTree.init(o.find(".ztree"),p,e),n.remove(),c.showTreeValueDiv(a,s),c.itemsToJson(s),s.zNodes=s.items,a.data("options",s),c.popTreeInitSearchEvent(s,a)),a.data("ztreeObj",t)})},getCss:function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]},startDrag:function(s,l,d,r){s.onmousedown=function(e){"auto"!==c.getCss(l,"left")&&(d.dragParams.left=c.getCss(l,"left")),"auto"!==c.getCss(l,"top")&&(d.dragParams.top=c.getCss(l,"top"));var t=document.getElementById("dragDivCell");null!=t&&t.parentNode.removeChild(t),d.dragParams.flag=!0,e||(e=window.event,s.onselectstart=function(){return!1},document.body.onselectstart=function(){return!1});var a=e;d.dragParams.currentX=a.clientX,d.dragParams.currentY=a.clientY,document.onmouseup=function(){var e=document.getElementById("dragDivCell");null!=e&&e.parentNode.removeChild(e),l.offsetLeft<=0&&(l.style.left="0px",l.style.marginLeft="0px"),l.offsetTop<=0&&(l.style.top="0px",l.style.marginTop="0px"),document.body.clientHeight-l.offsetTop<=s.offsetHeight&&(l.style.marginTop="0px",l.style.top=document.body.clientHeight-s.offsetHeight+"px"),document.body.clientWidth-l.offsetLeft<=50&&(l.style.marginLeft="0px",l.style.left=document.body.clientWidth-50+"px"),d.dragParams.flag=!1,"auto"!==c.getCss(l,"left")&&(d.dragParams.left=c.getCss(l,"left")),"auto"!==c.getCss(l,"top")&&(d.dragParams.top=c.getCss(l,"top"))},document.onmousemove=function(e){var t=e||window.event;if(d.dragParams.flag){var a=t.clientX,s=t.clientY,i=a-d.dragParams.currentX,n=s-d.dragParams.currentY,p=0,o=0;l.style.left=parseInt(d.dragParams.left)+i+"px",p=parseInt(d.dragParams.left)+i,l.style.top=parseInt(d.dragParams.top)+n+"px",o=parseInt(d.dragParams.top)+n}"function"==typeof r&&r(p,o)}}}};r.fn.popupSelection=function(e){return c[e]?c[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void r.error("Method "+e+" does not exist on jQuery.popupSelection"):c.init.apply(this,arguments)}}(jQuery,window);var popupSelectionJsPath=document.scripts[document.scripts.length-1].src,popupSelectionPath=popupSelectionJsPath.substring(0,popupSelectionJsPath.lastIndexOf("/")+1),popupSelectionlink=document.createElement("link");popupSelectionlink.type="text/css",popupSelectionlink.rel="stylesheet",popupSelectionlink.href=popupSelectionPath+"popupSelection.css",document.getElementsByTagName("head")[0].appendChild(popupSelectionlink),popupSelectionlink=null;