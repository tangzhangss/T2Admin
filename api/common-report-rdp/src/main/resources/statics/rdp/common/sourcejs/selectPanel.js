$(function(){});var $panel=$(".select_panel"),$showBtn=$panel.find(".show_btn"),panel={parmbar:$(".param_panel"),parmArea:$(".panel_area"),opt:{editor:$(".tb-center"),height:100,minHeight:178,maxHeight:700,speed:300,fa_lock:"fa-lock",fa_unlock:"fa-unlock",keydown:!1,init:!1,cssVal:"",jsVal:""},model:{text:{text:"文字",dbType:"string",parmCName:"文字",parmName:"param",parmType:"normal",parmvl:"",showType:"input",isnull:!1,selRange:"1",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"3",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"80",widthL:"100",widthR:"0",height:"35",fontSize:"12",verticalAlign:"1"},input:{text:"输入框",dbType:"string",parmCName:"输入框",parmName:"param",parmType:"normal",parmvl:"",showType:"input",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},select:{text:"下拉",dbType:"string",parmCName:"下拉",parmName:"param",parmType:"normal",parmvl:"",showType:"select",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},check:{text:"复选",dbType:"string",parmCName:"复选",parmName:"param",parmType:"normal",parmvl:"",showType:"checkbox",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},radio:{text:"单选",dbType:"string",parmCName:"单选",parmName:"param",parmType:"normal",parmvl:"",showType:"radio",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},time:{text:"时间",dbType:"string",parmCName:"时间",parmName:"param",parmType:"normal",parmvl:"",showType:"time",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},render:{text:"区域时间",dbType:"string",parmCName:"区域时间",parmName:"param",parmType:"normal",parmvl:"",showType:"render",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"1",fieldAlign:"1",labelStyle:"",fieldStyle:"dateStart",width:"120",widthL:"40",widthR:"60",height:"35",fontSize:"12",verticalAlign:"1"},searchlist:{text:"查询按钮",dbType:"string",parmCName:"查询按钮",parmName:"param",parmType:"normal",parmvl:"",showType:"input",isnull:!1,selRange:"0",position:{x:0,y:0},mustInput:"0",readonly:"0",labelAlign:"3",fieldAlign:"1",labelStyle:"",fieldStyle:"",width:"80",widthL:"0",widthR:"100",height:"35",fontSize:"12",verticalAlign:"1",sts:0}},setObjPos:function(e,a){var t=(a=$(a)).offset().left,n=a.offset().top,l=a.position().left,i=a.position().top,p=event.pageX,o=event.pageY,s=a.width(),r=a.height(),d={};d.top=n,d.left=t,d.rtop=i,d.rleft=l,d.width=s,d.height=r,d.x=p,d.y=o,a.data("pos",d)},setObjPosForObj:function(e,a){var t=$(a),n=t.offset().left,l=t.offset().top,i=t.width(),a=t.height(),t={};t.top=l,t.left=n,t.width=i,t.height=a,t.display="block",$(e).css(t)},position:function(){return{top:150,left:$(".tb-foot_left").offset().left}},relativePos:function(e,a){var t=(a=$(a)).offset().left,n=a.offset().top,l=event.pageX,i=event.pageY,n=(a.width(),a.height(),i-n),t=l-t;return panel.setData(a,"left",t),panel.setData(a,"top",n),{top:n,left:t}},innerPos:function(e,a){var t=(a=$(a)).offset().left,n=a.offset().top,l=e.pageX,e=e.pageY;return a.width(),a.height(),{left:l-t,top:e-n}},isHover:function(e,a){var t=(a=$(a)).offset().left,n=a.offset().top,l=a.width(),i=a.height(),a=e.pageX,e=e.pageY;return t<a&&n<e&&e<n+i&&a<+l},getCtrlVal:function(e,a,t){return e<=a?e=a:t<e&&a<t&&(e=t),e},setData:function(e,a,t){$(e).data(a,t)},getData:function(e,a){return $(e).data(a)},stopEvent:function(e){e.preventDefault(),e.stopPropagation()},add:function(e,a,t){return t<=(e=""==e||null==e||null==e?0:e)&&t?t:parseInt(e)+parseInt(a)},sub:function(e,a,t){return(e=""==e||null==e||null==e?0:e)<=t&&t?t:parseInt(e)-parseInt(a)},show:function(e){var a=panel.opt.editor;a.stop();var t=panel.opt.height,t=a.data("top")?a.data("top"):parseInt(t)+214;a.animate({top:t},panel.opt.speed,panel.callBack(e,!0))},hide:function(e){var a=panel.opt.editor;a.stop(),a.data("top",a.position().top),a.animate({top:panel.opt.minHeight},panel.opt.speed,panel.callBack(e,!1))},callBack:function(e,a){$panel.data("isShow",a),a?($showBtn.find(".fa_btn").removeClass("fa-eye-slash"),$showBtn.find(".fa_btn").addClass("fa-eye")):($showBtn.find(".fa_btn").removeClass("fa-eye"),$showBtn.find(".fa_btn").addClass("fa-eye-slash"))},modeCtrl:function(e,t,n){$(e).bind("click",function(e){var a=$(this).parents(".set_module").find(".m_body");a.is(":hidden")?($(this).removeClass(t),$(this).addClass(n),a.slideDown()):($(this).removeClass(n),$(this).addClass(t),a.slideUp())})},keyEvent:function(e){$(document).bind({keyup:function(e){var a,t;46!=e.keyCode||0<(a=panel.parmArea.find(".pbox.pbox-selected")).length&&a.data("puuid")&&(t=getParmNodeForNodeTId(a.data("puuid")),layer.confirm("确认删除参数  “"+t.name+"” 吗？",{btn:["确定","全部删除","取消"]},function(e){a.remove(),t.custom=0,editParmNodeForNode(t),$(".resizable").hide(),layer.alert("删除成功!")},function(e){a.remove(),removeForParms(t),$(".resizable").hide(),layer.alert("全部删除成功!")},function(e){layer.close(e)}))},keydown:function(e){}})},parmSetting:function(e,a,t){panel.isHover(e,panel.parmArea)?(a=a[0],panel.isexist(a.puuid)?layer.msg("已经存在"):(e=panel.innerPos(e,panel.parmArea),(a=panel.parmDefaultVaule(a)).position={y:e.top,x:e.left},editParmNodeForNode(a),a=panel.getPboxTarget(a),panel.parmArea.append(a),panel.pbox(a))):layer.msg("不在查询区")},getPboxTarget:function(e,a){a?a.html(""):a=$('<div class="pbox"></div>'),a.data("puuid",e.puuid);var t=$('<span class="s_label">'+e.parmCName+"</span>"),n=$('<span class="s_input form-input"></span>');a.css({width:e.width+"px","line-height":e.height+"px",height:e.height+"px",top:e.position.y+"px",left:e.position.x+"px"});var l={width:e.widthL+"%","font-size":e.fontSize+"px"},i={width:e.widthR+"%","font-size":e.fontSize+"px"};"input"==e.showType?n.append('<input type="text" name="'+e.parmName+'"/>'):"select"==e.showType?n.append('<select name="'+e.parmName+'"><option>下拉选择</option></select>'):"multiple"==e.showType||"date"==e.showType||["year","month","time","datetime","render"].includes(e.showType)?n.append('<input type="text" name="'+e.parmName+'"/>'):"radio"==e.showType?n.append('<span>单选</span><input type="radio" name="'+e.parmName+'" style="width:'+e.fontSize+'px;height:100%;"/>'):"checkbox"==e.showType&&n.append('<span>复选</span><input type="checkbox" name="'+e.parmName+'" style="width:'+e.fontSize+'px;height:100%;"/>');function p(e,a){0==a?e["text-align"]="left":1==a?e["text-align"]="center":2==a&&(e["text-align"]="right")}return p(l,e.labelAlign),p(i,e.fieldAlign),0==e.verticalAlign?(l["vertical-align"]="top",i["vertical-align"]="top"):1==e.verticalAlign?(l["vertical-align"]="middle",i["vertical-align"]="middle"):2==e.verticalAlign&&(l["vertical-align"]="bottom",i["vertical-align"]="bottom"),t.css(l),n.css(i),1==e.selRange?a.append(t):(2==e.selRange||a.append(t),a.append(n)),a.bind("click",function(){panel.toolbarDataInit(this,e)}),a},isexist:function(a){var t=!1;return $(".pbox").each(function(){var e=$(this).data("puuid");a==e&&(t=!0)}),t},removeBox:function(){},pbox:function(a){$(a).bind({click:function(e){$(this).siblings(".pbox-selected").removeClass("pbox-selected"),$(this).addClass("pbox-selected"),panel.resizable($(this),panel.parmArea),panel.stopEvent(e)},mousedown:function(e){panel.relativePos(e,$(a))},mouseup:function(e){}})},mousemove:function(){$(document).bind({mousemove:function(e){},mouseup:function(){panel.opt.keydown=!1,document.onmousemove=null},mousedown:function(){panel.opt.keydown=!0}})},toolbar:function(){panel.setData(panel.parmbar,"lock",!0),panel.parmbar.find(".btn_lock").bind("click",function(e){panel.parmbar.data("lock")?(panel.parmbar.find(".btn_lock").removeClass(panel.opt.fa_unlock),panel.parmbar.find(".btn_lock").addClass(panel.opt.fa_lock),panel.setData(panel.parmbar,"lock",!1)):(panel.parmbar.find(".btn_lock").removeClass(panel.opt.fa_lock),panel.parmbar.find(".btn_lock").addClass(panel.opt.fa_unlock),panel.setData(panel.parmbar,"lock",!0))}),panel.parmbar.find(".set_title").bind({mousedown:function(e){panel.parmbar.addClass("p_move");var a=e.pageX-panel.parmbar.offset().left,e=e.pageY-panel.parmbar.offset().top;panel.setData(panel.parmbar,"left",a),panel.setData(panel.parmbar,"top",e),document.onmousemove=function(){var e,a=window.event;panel.parmbar.data("lock")&&(e=a.pageX-panel.getData(panel.parmbar,"left"),a=a.pageY-panel.getData(panel.parmbar,"top"),panel.parmbar.css({top:a+"px",left:e+"px"}))}}})},toolbarDataInit:function(t,p){var e;void 0===panel.opt.left&&(e=panel.position(),panel.opt.top=e.top,panel.opt.left=e.left-panel.parmbar.width()-1,panel.parmbar.css({top:panel.opt.top+"px",left:panel.opt.left})),panel.parmbar.show(),panel.parmbar.data("target",t),p=getParmNodeForNodeTId($(t).data("puuid"));var o=["click","dbclick","focus","blur","select","change"],s=["labelAlign","selRange","fieldAlign","verticalAlign"];panel.parmbar.find("[data-type='p_data']").each(function(e,a){var t,n,l=$(this).attr("name"),i=p[l];"positionX"==l||"positionY"==l?(t=p.position.x,n=p.position.y,panel.parmbar.find("[name='positionX']").val(t),panel.parmbar.find("[name='positionY']").val(n)):(s.includes(l)?panel.selectCustomMenu(this,i):"mustInput"==l||"readonly"==l||o.includes(l)&&(i="",p.parmEvent&&p.parmEvent[l]&&(i=p.parmEvent[l])),$(this).val(i))}),panel.parmbar.find("[data-type='p_data']").unbind(),panel.parmbar.find("[data-type='p_data']").bind("change",function(){var e=$(this).attr("name"),a=$(this).val();p=getParmNodeForNodeTId(p.puuid),p=$.extend(!0,p,panel.getParmValue()),panel.getPboxTarget(p,$(t)),"widthL"==e?panel.parmbar.find("[name='widthR']").val(100-a):"widthR"==e&&panel.parmbar.find("[name='widthL']").val(100-a),editParmNodeForNode(p)})},parmDefaultVaule:function(e){function a(e,a,t){void 0===node[a]&&(node[a]=t)}return a(0,"dbType","string"),a(0,"parmCName","参数"),a(0,"parmName","param"),a(0,"parmType","normal"),a(0,"parmvl",""),a(0,"showType","input"),a(0,"isnull",!1),a(0,"format",""),a(0,"selRange","0"),a(0,"parmEvent",{click:"",dbclick:"",focus:"",blur:"",select:"",change:""}),a(0,"position",{x:0,y:0}),a(0,"mustInput","0"),a(0,"readonly","0"),a(0,"labelAlign","1"),a(0,"fieldAlign","1"),a(0,"labelStyle",""),a(0,"fieldStyle",""),a(0,"width","80"),a(0,"widthL","50"),a(0,"widthR","50"),a(0,"height","35"),a(0,"fontSize","12"),a(0,"fieldSize",""),a(0,"verticalAlign","1"),a(0,"maxLength",0),e.custom=1,e},getParmValue:function(){function e(e){return panel.parmbar.find("[name='"+e+"']").val()}var a=panel.parmbar.data("target"),t=$(a).position().left,a=$(a).position().top;return{dbType:e("dbType"),parmCName:e("parmCName"),parmName:e("parmName"),parmType:e("parmType"),parmvl:e("parmvl"),showType:e("showType"),isnull:!1,format:e("format"),selRange:e("selRange"),parmEvent:{click:e("click"),dbclick:e("dbclick"),focus:e("focus"),blur:e("blur"),select:e("select"),change:e("change")},position:{x:t,y:a},mustInput:e("mustInput"),readonly:e("readonly"),labelAlign:e("labelAlign"),fieldAlign:e("fieldAlign"),labelStyle:e("labelStyle"),fieldStyle:e("fieldStyle"),width:e("width"),widthL:e("widthL"),widthR:e("widthR"),height:e("height"),fontSize:e("fontSize"),fieldSize:e("fieldSize"),verticalAlign:e("verticalAlign"),maxLength:e("maxLength"),custom:1}},resizeArea:function(){$panel.find(".resize_line").bind({mousedown:function(e){$(this).addClass("isresize");var a=e.pageY,t=$panel.height(),n=panel.opt.editor.offset().top;document.onmousemove=function(){var e=window.event.pageY-a;60<t+e&&($panel.css({height:t+e}),panel.opt.editor.css({top:n+e}))}}}),panel.parmArea.bind({click:function(){$(this).find(".pbox-selected").removeClass("pbox-selected"),$(".resizable").hide().css({top:0,left:0,width:0,height:0}),panel.parmbar.hide()}})},updateTarget:function(e){e=getParmNodeForNodeTId($(e).data("puuid")),e=$.extend(!0,e,panel.getParmValue());panel.getPboxTarget(e,$(panel.parmbar.data("target"))),e.custom=1,editParmNodeForNode(e)},resizable:function(e,i){var p=$(e),o=$(".resizable");return panel.setObjPosForObj(o,p),o.bind({mousedown:function(e){panel.setObjPos(e,p),document.onmousemove=function(){var e=window.event,a=p.data("pos"),t=a.rleft+e.pageX-a.x,n=a.rtop+e.pageY-a.y,l=a.left+e.pageX-a.x,a=a.top+e.pageY-a.y;panel.resizableArea(p,i,n,t)&&(o.css({left:l,top:a}),p.css({left:t,top:n}),panel.parmbar.find("[name='positionX']").val(t),panel.parmbar.find("[name='positionY']").val(n),panel.updateTarget(panel.parmbar.data("target")))},panel.stopEvent(e)},mouseup:function(e){}}),o.find(".resizable-handle").bind({mousedown:function(e){panel.setObjPos(e,p),document.onmousemove=function(){var e=window.event,a=p.data("pos"),t=e.pageX-a.x,e=e.pageY-a.y,e=a.height+e,t=a.width+t;o.css({height:e,width:t}),p.css({height:e,width:t}),panel.parmbar.find("[name='width']").val(t),panel.parmbar.find("[name='height']").val(e),panel.updateTarget(panel.parmbar.data("target"))},panel.stopEvent(e)},mouseup:function(e){}}),o},resizableArea:function(e,a,t,n){return $(e).width(),$(e).height(),$(a).width(),$(a).height(),!0},iconMenu:function(){$(".customMenu").find(".licon").bind("click",function(){$(this).parent().find(".selected").removeClass("selected"),$(this).addClass("selected"),$(this).parents(".customMenu").siblings("[data-type='p_data']").val($(this).data("value")),$(this).parents(".customMenu").siblings("[data-type='p_data']").change()})},selectCustomMenu:function(e,a){e=$(e).siblings(".customMenu");e.find(".selected").removeClass("selected"),e.find("[data-value='"+a+"']").addClass("selected")},menuList:function(){var t=$panel.find(".menu_list");$.each(panel.model,function(e,a){0!=a.sts&&(a=$('<li class="ico_'+e+'" data-type="'+e+'"><i class="ico"></i>'+a.text+"</li>"),t.append(a))}),t.find("li").bind("mousedown",function(e){var a=$(this).data("type"),t=panel.model[a],a=panel.innerPos(event,panel.parmArea);t.position={y:a.top,x:a.left};var n=panel.getPboxTarget(t);panel.parmArea.append(n),document.onmousemove=function(){var e=window.event,e=panel.innerPos(e,panel.parmArea);n.css({left:e.left,top:e.top})},document.onmouseup=function(e){panel.isHover(e,panel.parmArea)&&(e=panel.innerPos(e,panel.parmArea),t.position={y:e.top,x:e.left},t=addParmNodeForVal(t),e=panel.getPboxTarget(t[0]),panel.parmArea.append(e),panel.pbox(e)),n.remove(),document.onmouseup=null},panel.stopEvent(e)})},pboxInit:function(e){panel.opt.init||($.each(e,function(e,a){1==a.custom&&(a=panel.getPboxTarget(a),panel.parmArea.append(a),panel.pbox(a))}),panel.opt.init=!0)},editer:function(){$(".js_edit").bind("click",function(){layer.open({type:1,title:"编辑JS",area:["60%","60%"],content:'<div id="jsEditor" style="width:100%;height: calc( 100% - 40px);border-bottom: 2px solid #f0f0f0;"></div>',success:function(e,a){var t=$('<div style="width: 100%;text-align: center;"></div>'),n=$('<input class="editor_btn" type="button" value="保存">');t.append(n),$(e).find(".layui-layer-content").append(t);var l=ace.edit($(e).find("#jsEditor")[0]);l.session.setMode("ace/mode/javascript");e=panel.opt.js;e&&l.setValue(e),n.bind("click",function(){panel.opt.js=l.getValue(),layer.close(a)})}})}),$(".css_edit").bind("click",function(){layer.open({type:1,title:"CSS编辑",area:["60%","60%"],content:'<div id="cssEditor" style="width:100%;height: calc( 100% - 40px);border-bottom: 2px solid #f0f0f0;"></div>',success:function(e,a){var t=$('<div style="width: 100%;text-align: center;"></div>'),n=$('<input class="editor_btn" type="button" value="保存">');t.append(n),$(e).find(".layui-layer-content").append(t);var l=ace.edit($(e).find("#cssEditor")[0]);l.session.setMode("ace/mode/css");e=panel.opt.css;e&&l.setValue(e),n.bind("click",function(){panel.opt.css=l.getValue(),layer.close(a)})}})})},getPanelVal:function(){var e={};return e.css=panel.opt.css,e.js=panel.opt.js,e.height=$(".panel_area").height(),e},getEncodeVal:function(){var e={};return e.css=panel.opt.css?Base64Util.encode64(panel.opt.css):"//4vACoA6oGaW0lOQwBTAFMAN2gPX02Rbn8gACh1jk7lZ+KLOlPfVyoALwA=",e.js=panel.opt.js?Base64Util.encode64(panel.opt.js):"//4vACoA6oGaW0lOSgBTADdoD19NkW5/IAAodY5O5WfiizpT31cqAC8A",e.height=$(".panel_area").height(),e},decode:function(){panel.opt.css=""==panel.opt.css||void 0===panel.opt.css?"":Base64Util.decode64(panel.opt.css),panel.opt.js=""==panel.opt.js||void 0===panel.opt.js?"":Base64Util.decode64(panel.opt.js)},init:function(e){panel.opt=$.extend(!0,panel.opt,e),panel.decode(),$panel.data("isShow",!1),$panel.css("height",parseInt(panel.opt.height)+30),$showBtn.find(".fa_btn").bind("click",function(e){$panel.data("isShow")?panel.hide(e):panel.show(e)}),panel.parmbar.find(".btn_close").bind("click",function(e){panel.parmbar.hide()}),panel.toolbar(),panel.mousemove(),panel.resizeArea(),panel.modeCtrl($(".m_title .t_btn .fa"),"fa-plus","fa-minus"),panel.keyEvent(),panel.iconMenu(),panel.menuList(),panel.editer()}};