function cellCreateImage(t,i,d){$.each(t,function(t,e){var a;null!=e.value&&((a=$('<div class="cell-img"></div>'))[0].style.backgroundImage='url("'+e.value+'")',a[0].style.backgroundRepeat="no-repeat",a.css({position:"absolute",left:e.left+"px",top:e.top+"px",width:e.width+"px",height:e.height+"px","z-index":101}),a.attr("data-index",t),a.data("r",i),a.data("c",d),a[0].style.backgroundSize=e.width+"px "+e.height+"px",$(".ht_master .wtHider").append(a),a.myDrag({randomPosition:!1,direction:"all",handler:!1,x:e.left+"px",y:e.top+"px",elem:$(".ht_master .wtHider"),dragEnd:function(t,e,a){0<=t.data("r")&&0<=t.data("c")&&((t=hot.Methods.getCellMeta(t.data("r"),t.data("c")).image[t.data("index")]).top=a,t.left=e)}}),a.dragDivResize($(".ht_master .wtHider")[0],function(t,e,a){t=hot.Methods.getCellMeta(t.data("r"),t.data("c")).image[t.data("index")];t.width=e,t.height=a}),a.bind("click",function(){return $(".cell-img").removeClass("curr-img"),$(this).addClass("curr-img"),!1}))})}$(function(){var e,a=window.URL||window.webkitURL,i=$("#image"),d=$("#dataX"),o=$("#dataY"),l=$(".rdp-cropper"),r=$("#dataHeight"),n=$("#dataWidth"),c=$("#dataWidthRatio"),s=$("#dataHeightRatio"),h=$("#dataRotate"),p=$("#dataScaleX"),u=$("#dataScaleY"),t=$("#save-cropper-image"),g=$("#cancel-cropper-image"),m=!1,v={aspectRatio:16/9,preview:".rdp-img-preview",crop:function(t){m||(d.val(Math.round(t.detail.x)),o.val(Math.round(t.detail.y)),r.val(Math.round(t.detail.height)),n.val(Math.round(t.detail.width)),s.val(Math.round(t.detail.height)),c.val(Math.round(t.detail.width)),h.val(t.detail.rotate),p.val(t.detail.scaleX),u.val(t.detail.scaleY))}};i.attr("src"),i.on({ready:function(t){},cropstart:function(t){},cropmove:function(t){},cropend:function(t){},crop:function(t){},zoom:function(t){}}).cropper(v),$(".rdp-img-menu .menu-item").bind("click",function(){var t=$(this).data();if(i.data("cropper")&&t.method)switch(t=$.extend({},t),result=i.cropper(t.method,t.option,t.secondOption),t.method){case"scaleX":case"scaleY":$(this).data("option",-t.option)}}),$(".docs-toggles").on("change","input",function(){var t=$(this),e=t.attr("name");"radio"===t.prop("type")&&(v[e]=t.val(),t.parents("li").addClass("active").siblings().removeClass("active")),i.cropper("destroy").cropper(v)}),$(".docs-data .cropper-data").bind("input propertychange",function(){m=!0;var t={};t.x=Number(d.val()),t.y=Number(o.val()),t.height=Number(r.val()),t.width=Number(n.val()),t.rotate=Number(h.val()),t.scaleX=Number(p.val()),t.scaleY=Number(u.val()),m=!1,i.cropper("setData",t),t=null}),$(".docs-data .cropper-ratio").bind("input propertychange",function(){var t,e,a=$('input[name="aspectRatio"]:checked').val();"NaN"!=a&&(t=Number(this.value),"dataWidthRatio"==this.id?(e=t/a,s.val(Math.round(e))):"dataHeightRatio"==this.id&&(e=t*a,c.val(Math.round(e))))}),t.bind("click",function(){var t,o,r,e={};e.width=c.val(),e.height=s.val(),e.fillColor="#fff",result=i.cropper("getCroppedCanvas",e),"importImage"==imageActionName?(t=hot.Methods.getSelected())&&(e=t[0],t=hot.Methods.getCell(e[0],e[1]),hot.Methods.setCellMeta(e[0],e[1],"bgimage",result.toDataURL()),t.style.backgroundImage='url("'+result.toDataURL()+'")',t.style.backgroundRepeat="no-repeat"):"addImage"==imageActionName&&((o=$('<div class="cell-img"></div>'))[0].style.backgroundImage='url("'+result.toDataURL()+'")',o[0].style.backgroundRepeat="no-repeat",o.css({position:"absolute",left:"49px",top:"25px","z-index":101}),(r=new Image).onload=function(){var t=r.width,e=r.height;o.css({width:t+"px",height:e+"px"}),o[0].style.backgroundSize=t+"px "+e+"px",$(".ht_master .wtHider").append(o),o.myDrag({randomPosition:!1,direction:"all",handler:!1,elem:$(".ht_master .wtHider"),dragEnd:function(t,e,a){0<=t.data("r")&&0<=t.data("c")&&((t=hot.Methods.getCellMeta(t.data("r"),t.data("c")).image[t.data("index")]).top=a,t.left=e)}}),o.dragDivResize($(".ht_master .wtHider")[0],function(t,e,a){t=hot.Methods.getCellMeta(t.data("r"),t.data("c")).image[t.data("index")];t.width=e,t.height=a});var a,i,d=hot.Methods.getSelected();d&&(a=d[0],i=hot.Methods.getCellMeta(a[0],a[1]).image||[],(d={}).value=result.toDataURL(),d.width=t,d.height=e,d.top=0,d.left=0,i.push(d),d=i.length-1,o.data("r",a[0]),o.data("c",a[1]),o.data("index",d),hot.Methods.setCellMeta(a[0],a[1],"image",i)),o.bind("click",function(){return $(".cell-img").removeClass("curr-img"),$(this).addClass("curr-img"),!1})},r.src=result.toDataURL()),l.hide()}),g.bind("click",function(){l.hide()});var f=$("#importImage");a?f.bind("change",function(){l.css({"z-index":104,opacity:1}).show();var t=this.files;i.data("cropper")&&t&&t.length&&(t=t[0],/^image\/\w+$/.test(t.type)?(t.name,t.type,e&&a.revokeObjectURL(e),e=a.createObjectURL(t),i.cropper("destroy").attr("src",e).cropper(v),f.val(""),setTimeout(function(){c.val(n.val()),s.val(r.val())},100)):window.alert("Please choose an image file."))}):f.prop("disabled",!0).parent().addClass("disabled"),$(document).bind("click",function(){$(".cell-img").removeClass("curr-img")})});