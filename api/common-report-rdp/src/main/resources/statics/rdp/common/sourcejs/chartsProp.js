var chartstool=function(event,opt){var cells=hot.Methods.getSelected(),metaData=hot.Methods.getCellMeta(cells[0][0],cells[0][1]),celldom=hot.Methods.getCell(cells[0][0],cells[0][1]),getOptions=function(){return metaData.charts.option},getOptionsKey=function(t,a,e){var n;return a&&t&&((n=t[(t=a.split("."))[0]])&&1<t.length&&(a=a.substring(a.indexOf(".")+1,a.length),"[object Array]"===Object.prototype.toString.apply(n)?n=getOptionsKey(n[e],a):"[object Object]"===Object.prototype.toString.apply(n)&&(n=getOptionsKey(n,a,e)))),n},setOption=function(t){var a=metaData.charts;a.option=t,hot.Methods.setCellMeta(cells[0][0],cells[0][1],"charts",a),createChartsTag($(celldom).find(".charts-tag"),t.options,t.theme)},getConfig=function(t){return getAjaxJsonFile("../../statics/rdp/common/sourcejs/charts_config/"+t)},getAjaxJsonFile=function(t){var a;return $.ajax({url:t,type:"GET",async:!1,dataType:"json",success:function(t){a=t}}),a},setOptionProp=function(t,a,e,n){if(!a)return t;var i=a.split(".");(t=t||{})[i[0]]||(t[i[0]]={});var o,l=t[i[0]];return 1<i.length?(o=a.substring(a.indexOf(".")+1,a.length),"[object Array]"===Object.prototype.toString.apply(l)?l[n=n||0]=setOptionProp(l[n],o,e):"[object Object]"===Object.prototype.toString.apply(l)&&(l=setOptionProp(l,o,e,n)),t[i[0]]=l):t[a]=e,t};function isNumber(t){return"number"==typeof t&&!isNaN(t)}function isArray(t){return"[object Array]"===Object.prototype.toString.apply(t)}function isObjecty(t){return"[object Object]"===Object.prototype.toString.apply(t)}var delOptionProp=function(t,a,e){var n,i;return!a||t[(n=a.split("."))[0]]&&(i=t[n[0]],1<n.length?(a=a.substring(a.indexOf(".")+1,a.length),"[object Array]"===Object.prototype.toString.apply(i)?i[e]=delOptionProp(i[e],a):"[object Object]"===Object.prototype.toString.apply(i)&&(i=delOptionProp(i,a,e))):delete t[n[0]]),t},updateProp=function(i,o){var l=getOptions();event.find(".tag-data").each(function(t,a){var e,n=$(a);n.data("prop")==i.data("prop")&&n.data("index")==i.data("index")&&(e=n.data("prop"),a=n.data("pval"),n.data("usable"),n=n.data("index"),void 0===o&&(o=!0,i.data("usable",!0),setTagState(i,!0)),l=o?setOptionProp(l,e,a,n):delOptionProp(l,e,n))}),setOption(l)},setTagState=function(a,t,e){function n(t){e&&e.call(this,a,t)}var i=a.find(".tag-state .fa");t?(i.removeClass("fa-square-o"),i.addClass("fa-check-square-o"),a.addClass("on"),n("on")):(i.removeClass("fa-check-square-o"),i.addClass("fa-square-o"),a.removeClass("on"),n("off"))},create_tag=function(t,a){var e=$('<li class="tag-data"></li>');return e.append('<div class="tag-state"><i class="fa fa-square-o"></i></div>'),e.append('<div class="tag-title"><span></span></div>'),e.append('<div class="tag-widget"></div>'),e.find(".tag-title span").text(t),e.find(".tag-state .fa").bind("click",function(){setTagState(e,$(this).hasClass("fa-square-o"),a)}),e},usable=function(t,a){"off"==a?(updateProp(t,!1),$(t).data("usable",!1)):(updateProp(t,!0),$(t).data("usable",!0))},setDefault=function(t,a,e,n){return t.data("prop",a),t.data("pval",n),t.data("usable",!1),t.data("index",e),n&&t.data("usable",!0),t},lineTag=function(t,a){var e=a.lineType,n=$('<span class="decollate_line"></span>'),a=$('<li class="tag-decollate"></li>');a.append(n),e&&n.addClass(e),t.append(a)},titleTag=function(t,a){var e=a.name,n=a.index,i=a.subTitle,a=$('<li class="tag-decollate"><span class="decollate_title">标题</span></li>');a.find(".decollate_title").text(e),i&&void 0!==n&&a.find(".decollate_title").text(e+"-"+n),t.append(a)},inputTag=function(t,a){var e=a.name,n=a.prop,i=create_tag(e,usable),e=a.index,i=setDefault(i,n,e);t.append(i);a=i.find(".tag-widget"),t=$('<input class="input-tag" type="text">'),e=getOptionsKey(getOptions(),n,e);e&&(t.val(e),setTagState(i,!0)),a.append(t),t.bind("change",function(){var t=$(this).val();i.data("pval",t),updateProp(i)})},textAreaTag=function(t,a){var e=a.name,n=a.prop,i=create_tag(e,usable),e=a.index,i=setDefault(i,n,e);t.append(i);a=i.find(".tag-widget"),t=$('<textarea class="textArea-tag" style="width:168px;height: 60px;">');t.bind("change",function(){var t=$(this).val();i.data("pval",t),updateProp(i)}),a.append(t);e=getOptionsKey(getOptions(),n,e);e&&("function"==typeof e&&(e=e.toString().replace(/\s+/g," ").replace(/\n/g,"")),t.val(e),setTagState(i,!0))},radioTag=function(event,config){var name=config.name,prop=config.prop,pram=config.pram,tag=create_tag(name,usable),index=config.index,tag=setDefault(tag,prop,index);event.append(tag);var widget=tag.find(".tag-widget"),ul=$('<ul class="plug_radio"></ul>'),tagVal=getOptionsKey(getOptions(),prop,index),evalVal,prams;pram&&(evalVal=function(val){return"false"==val||"true"==val?eval(val):val},prams=pram.split("|"),$.each(prams,function(t,a){var e=a.split("-")[0],n=a.split("-")[1],a=$("<li></li>");a.attr("data-val",n),a.text(e),null!=tagVal&&evalVal(n)==tagVal&&(a.addClass("on"),setTagState(tag,!0)),ul.append(a)}),widget.append(ul),tag.append(widget),ul.find("li").bind("click",function(){$(this).siblings().removeClass("on"),$(this).addClass("on");var t=$(this).attr("data-val");tag.data("pval",evalVal(t)),updateProp(tag)}))},colorTag=function(t,a){var e=a.name,n=a.prop,i=(a.pram,create_tag(e,usable)),a=a.index,i=setDefault(i,n,a);t.append(i);var t=i.find(".tag-widget"),o=$('<span class="color-tag"><span class="color-span"></span></span>');t.append(o);a=getOptionsKey(getOptions(),n,a);(a=isArray(a)?a[0]:a)&&(o.find(".color-span").css("background-color",a),setTagState(i,!0)),o.spectrum({showInput:!0,allowEmpty:!0,showAlpha:!1,showPalette:!0,togglePaletteOnly:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,cancelText:"取消",chooseText:"确认",togglePaletteMoreText:"更多",togglePaletteLessText:"简略",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(t){t=t.toRgbString();o.find(".color-span").css("background-color",t),i.data("pval",t),updateProp(i)},show:function(t){},move:function(t){}})},selectTag=function(t,a){a.name,a.prop,a.pram},sliderTag=function(t,a){var e=a.name,n=a.prop,i=(a.pram,create_tag(e,usable)),a=a.index,i=setDefault(i,n,a);t.append(i);var t=i.find(".tag-widget"),o=$('<span class="slider-tag"></span>');t.append(o);var l=$('<input class="slider-input" type="number">');t.append(l);t={change:function(t,a){},slide:function(t,a){var e=Number(a.value);l.val(a.value),i.data("pval",e),updateProp(i)}},n=getOptionsKey(getOptions(),n,a),a=function(t){return t?isNumber(t)?t:t.split("%")[0]:0};(n=isArray(n)?n[0]:n)&&(n=a(n),t.value=a(n),l.val(n),setTagState(i,!0)),o.slider(t),l.bind("change",function(){var t=Number($(this).val());o.slider("option","max")<t&&o.slider("option","max",t),o.slider("value",t),i.data("pval",t),updateProp(i)})},porpLoad=function(t,a){var e=a.propType;"input"==e?inputTag(t,a):"textarea"==e?textAreaTag(t,a):"radio"==e?radioTag(t,a):"slider"==e?sliderTag(t,a):"doubleSlider"==e?doubleSliderTag(t,a):"color"==e?colorTag(t,a):"inputBtn"==e?inputBtnTag(t,a):"button"==e?buttonTag(t,a):"line"==e?lineTag(t,a):"title"==e&&titleTag(t,a)},commonConfig=function(){},loadinit=function(){var l,t,s,a=getConfig("configure/"+metaData.charts.type+".json");void 0!==a?(l=$('<ul class="btn-list"></ul>'),t=$('<li class="child-attr-btn"></li>'),s=$('<li class="child-attr-context"></li>'),t.append(l),event.append(t),event.append(s),$.each(a,function(t,a){var e=a.name,n=a.sort,i=a.props,e=$('<li><span class="btn-text">'+e+"</span></li>");l.append(e);var o=$('<ul class="attr-list"></ul>');s.append(o),0==t?(e.addClass("selected"),o.show()):o.hide(),n?(n=getOptionsKey(getOptions(),"options.series"),$.each(n,function(t,a){var e=a.type,n=t;$.each(i,function(t,a){a.index=n,null!=a.sortType&&a.sortType!=e||porpLoad(o,a)})})):$.each(i,function(t,a){porpLoad(o,a)})}),l.find("li").bind("click",function(){$(this).siblings().removeClass("selected"),$(this).addClass("selected");var t=$(this).index(),a=$(this).parents(".attr_context").find(".child-attr-context .attr-list");a.eq(t).show(),a.eq(t).siblings().hide()})):console.log("未找到对应的属性配置")};return loadinit(),{}};