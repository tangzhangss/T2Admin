try{
    document.write("<script language=javascript src=../../statics/js/t2admin.js></script>");
}catch (e) {}
console.log("load:src/main/resources/statics/rdp/common/all/all.min.js");

!function (a) {
    a.extend({
        rdp: {
            ajax: function (e) {
                var t = e.success;
                e.success = function (e) {
                    e && "error" == e.flag ? layer.alert(e.msg, {skin: "layui-layer-alert"}) : t && t.call(this, e)
                }, a.ajax(e)
            }
        }
    })
}(jQuery);
var rdpConfig = function () {
    var t = {};
    return $.rdp.ajax({
        url: "common/file/config.json",
        type: "post",
        async: !1,
        dataType: "json",
        success: function (e) {
            t = e
        }
    }), {
        getConfig: function () {
            return t
        }, getConfigParm: function (e) {
            return t[e]
        }
    }
}();
$(function () {
    "left" == rdpConfig.getConfigParm("dataSet") && $(".tb-foot").addClass("tb-foot_left")
});
var Hot = function () {
    var l, t = function () {
        Handsontable.hooks.add("afterListen", e, l), Handsontable.hooks.add("afterDeselect", a, l), Handsontable.hooks.add("afterUnlisten", o, l), Handsontable.hooks.add("afterSelection", n, l), Handsontable.hooks.add("afterSelectionByProp", r, l), Handsontable.hooks.add("afterSelectionEnd", i, l), Handsontable.hooks.add("afterSelectionEndByProp", s, l), Handsontable.hooks.add("afterCreateRow", d, l), Handsontable.hooks.add("afterCreateCol", c, l), Handsontable.hooks.add("afterRemoveRow", u, l), Handsontable.hooks.add("afterRemoveCol", p, l), Handsontable.hooks.add("beforeOnCellMouseOver", f, l), Handsontable.hooks.add("afterOnCellMouseOver", g, l), Handsontable.hooks.add("beforeOnCellMouseOut", m, l), Handsontable.hooks.add("afterOnCellMouseOut", h, l), Handsontable.hooks.add("beforeOnCellMouseDown", v, l), Handsontable.hooks.add("afterOnCellMouseDown", b, l), Handsontable.hooks.add("afterBeginEditing", y, l), Handsontable.hooks.add("afterSetDataAtCell", C, l), Handsontable.hooks.add("beforeChange", S, l), Handsontable.hooks.add("beforeChangeRender", w, l), Handsontable.hooks.add("afterChange", M, l), Handsontable.hooks.add("beforeContextMenuShow", D, l), Handsontable.hooks.add("afterContextMenuShow", T, l), Handsontable.hooks.add("afterContextMenuHide", x, l), Handsontable.hooks.add("beforeUndo", k, l), Handsontable.hooks.add("beforeRedo", k, l), Handsontable.hooks.add("afterSetDataAtRowProp", A, l), Handsontable.hooks.add("afterRedo", P, l), Handsontable.hooks.add("afterUndo", R, l), Handsontable.hooks.add("afterSetCellMeta", _, l), Handsontable.hooks.add("beforeCopy", I, l), Handsontable.hooks.add("afterCopy", H, l), Handsontable.hooks.add("beforeCut", F, l), Handsontable.hooks.add("afterCut", B, l), Handsontable.hooks.add("beforePaste", z, l), Handsontable.hooks.add("afterPaste", O, l), Handsontable.hooks.add("beforeMergeCells", E, l), Handsontable.hooks.add("afterMergeCells", L, l), Handsontable.hooks.add("beforeUnmergeCells", j, l), Handsontable.hooks.add("afterUnmergeCells", U, l), Handsontable.hooks.add("beforeRenderer", V, l), Handsontable.hooks.add("afterRenderer", W, l), Handsontable.hooks.add("beforeKeyDown", Z, l), Handsontable.hooks.add("afterDocumentKeyDown", Y, l), Handsontable.hooks.add("beforeUndo", k, l), Handsontable.hooks.add("beforeRedo", N, l), Handsontable.hooks.add("afterUndo", R, l), Handsontable.hooks.add("afterRedo", P, l), Handsontable.hooks.add("afterColumnResize", q, l), Handsontable.hooks.add("afterRowResize", Q, l)
    }, e = function (e, t, a, o, n, r) {
    }, a = function (e, t, a, o, n, r) {
    }, o = function (e, t, a, o, n, r) {
    }, n = function (e, t, a, o, n, r) {
        hotafterSelection(e, t, a, o, n, r)
    }, r = function (e, t, a, o, n, r) {
    }, i = function (e, t, a, o, n, r) {
    }, s = function (e, t, a, o, n, r) {
    }, d = function (e, t, a) {
        hotafterCreateRow(e, t, a)
    }, c = function (e, t, a) {
        hotafterCreateCol(e, t, a)
    }, u = function (e, t) {
        hotafterRemoveRow(e, t)
    }, p = function (e, t) {
        hotafterRemoveCol(e, t)
    }, f = function (e, t, a, o, n, r) {
    }, g = function (e, t, a) {
        dragFlagForSets && ($(a).addClass("over"), setCoords(t))
    }, m = function (e, t, a, o, n, r) {
    }, h = function (e, t, a) {
        $(a).removeClass("over")
    }, v = function (e, t, a, o, n, r) {
    }, b = function (e, t, a, o, n, r) {
    }, y = function (e, t, a, o, n, r) {
    }, C = function (e, t, a, o, n, r) {
    }, S = function (e, t) {
    }, w = function (e, t) {
    }, M = function (e, t) {
        "edit" == t ? (l.setCellMeta(e[0][0], e[0][1], "value", e[0][3]), e[0][2] != e[0][3] && cPush(t)) : "CopyPaste.paste" == t && (pasteSetValue(e), cPush(t))
    }, D = function (e, t, a, o, n, r) {
    }, T = function (e, t, a, o, n, r) {
    }, x = function (e, t, a, o, n, r) {
    }, k = function (e, t, a, o, n, r) {
    }, N = function (e, t, a, o, n, r) {
    }, A = function (e, t, a, o, n, r) {
    }, P = function (e, t, a, o, n, r) {
    }, R = function (e, t, a, o, n, r) {
    }, _ = function (e, t, a, o, n, r) {
    }, I = function (e, t, a, o, n, r) {
    }, H = function (e, t, a, o, n, r) {
    }, F = function (e, t, a, o, n, r) {
    }, B = function (e, t, a, o, n, r) {
    }, z = function (e, t, a, o, n, r) {
    }, O = function (e, t, a, o, n, r) {
    }, E = function (e, t) {
    }, L = function (e, t, a) {
        mergeCells(e, !0, t)
    }, j = function (e, t) {
    }, U = function (e, t) {
        mergeCells(e, !1)
    }, V = function (e, t, a, o, n, r) {
        hotbeforeRenderer(e, t, a, o, n, r)
    }, W = function (e, t, a, o, n, r) {
        hotafterRenderer(e, t, a, o, n, r)
    }, Z = function (e) {
    }, Y = function (e) {
        90 == e.keyCode && e.ctrlKey ? cUndo() : 89 == e.keyCode && e.ctrlKey ? cRedo() : 46 == e.keyCode && delImage()
    }, q = (k = function (e) {
        console.log("beforeUndo")
    }, N = function (e) {
        console.log("beforeRedo")
    }, R = function (e) {
        console.log("afterUndo")
    }, P = function (e) {
        console.log("afterRedo")
    }, function (e, t, a) {
        hotafterColumnResize(e, t, a)
    }), Q = function (e, t, a) {
        hotafterRowResize(e, t, a)
    }, G = function (e) {
        return l.getPlugin(e)
    };
    return {
        init: function () {
            var e = document.getElementById("showtable");
            l = new Handsontable(e, {
                width: "100%",
                height: "100%",
                allowEmpty: !0,
                colWidths: 100,
                rowHeights: 23,
                rowHeaders: !0,
                colHeaders: !0,
                allowInsertColumn: !0,
                allowInsertRow: !0,
                undo: !1,
                contextMenu: !0,
                copyPaste: !0,
                manualRowResize: !0,
                manualColumnResize: !0,
                language: "ZH",
                defaultColumnWidth: 1,
                minCols: 50,
                minRows: 30,
                outsideClickDeselects: !1,
                manualColumnMove: !0,
                mergeCells: !0,
                customBorders: !1,
                comments: !1,
                selectionMode: "range",
                contextMenu: {
                    callback: function (e, t) {
                        try {
                            contextMenuCallback(e, t)
                        } catch (e) {
                            console.log(e), console.error("contextMenuCallback函数不存在")
                        }
                    },
                    items: {
                        hot: {
                            name: "配置",
                            submenu: {
                                items: [{key: "hot:removeDataDic", name: "清除字典项"}, {
                                    key: "hot:link",
                                    name: "配置超链接"
                                }, {key: "hot:removelink", name: "取消超链接"}, {
                                    key: "hot:subreport",
                                    name: "配置子报表"
                                }, {key: "hot:removesubreport", name: "取消子报表"}, {
                                    key: "hot:overlapping",
                                    name: "交叉表头"
                                }, {key: "hot:clearoverlapping", name: "清除交叉表头"}, {key: "hot:addImage", name: "插入图片"}]
                            }
                        },
                        hsep3: "---------",
                        row_above: {},
                        row_below: {},
                        hsep1: "---------",
                        col_left: {},
                        col_right: {},
                        hsep2: "---------",
                        remove_row: {},
                        remove_col: {},
                        hsep4: "---------",
                        alignment: {},
                        hsep6: "---------",
                        copy: {},
                        cut: {},
                        hsep8: "---------",
                        mergeCells: {},
                        hsep9: "---------",
                        copyStyle: {name: "复制单元格样式"},
                        pasteStyle: {name: "粘贴单元格样式"}
                    }
                }
            }), t()
        }, getHot: function () {
            return l
        }, Methods: {
            countEmptyRows: function (e) {
                return l.countEmptyRows(e)
            }, countEmptyCols: function (e) {
                return l.countEmptyCols(e)
            }, countSourceCols: function () {
                return l.countSourceCols()
            }, countSourceRows: function () {
                return l.countSourceRows()
            }, countCols: function () {
                return l.countCols()
            }, countRows: function () {
                return l.countRows()
            }, getSelected: function () {
                return l.getSelected()
            }, getData: function (e, t, a, o) {
                return l.getData(e, t, a, o)
            }, getValue: function () {
                return l.getValue()
            }, getCellMeta: function (e, t) {
                return l.getCellMeta(e, t)
            }, getSourceDataAtCell: function (e, t) {
                return l.getSourceDataAtCell(e, t)
            }, getSourceData: function (e, t, a, o) {
                return l.getSourceData(e, t, a, o)
            }, getCell: function (e, t, a) {
                return l.getCell(e, t, a)
            }, getSelectedRange: function () {
                return l.getSelectedRange()
            }, getSelectedRangeLast: function () {
                return l.getSelectedRangeLast()
            }, getDataAtCell: function (e, t) {
                return l.getDataAtCell(e, t)
            }, setDataAtCell: function (e, t, a, o) {
                return l.setDataAtCell(e, t, a, o)
            }, setCellMeta: function (e, t, a, o) {
                return l.setCellMeta(e, t, a, o)
            }, setCellMetaObject: function (e, t, a) {
                return l.setCellMetaObject(e, t, a)
            }, loadData: function (e) {
                return l.loadData(e)
            }, render: function () {
                return l.render()
            }, updateSettings: function (e) {
                return l.updateSettings(e)
            }, getSettings: function () {
                return l.getSettings()
            }, mergeSelection: function () {
                G("MergeCells").mergeSelection()
            }, unmergeSelection: function () {
                G("MergeCells").unmergeSelection()
            }, getInstance: function () {
                return l.getInstance()
            }, alert: function (e, t, a, o, n) {
                l.alter(e, t, a, o, n)
            }, getColWidth: function (e) {
                return l.getColWidth(e)
            }, getRowHeight: function (e) {
                return l.getRowHeight(e)
            }, disablePlugin: function () {
                var e = G("ManualColumnResize"), t = G("ManualRowResize");
                e.disablePlugin(), t.disablePlugin()
            }, enablePlugin: function () {
                var e = G("ManualColumnResize"), t = G("ManualRowResize");
                e.enablePlugin(), t.enablePlugin()
            }, updatePlugin: function () {
                var e = G("ManualColumnResize"), t = G("ManualRowResize");
                e.updatePlugin(), t.updatePlugin()
            }, getCellMetaAtRow: function (e) {
                return l.getCellMetaAtRow(e)
            }, deselectCell: function () {
                return l.deselectCell()
            }, selectCell: function (e, t, a, o, n, r) {
                return l.selectCell(e, t, a, o, n, r)
            }, getPlugin: G
        }
    }
};

function cellCreateImage(e, o, n) {
    $.each(e, function (e, t) {
        if (null != t.value) {
            var a = $('<div class="cell-img"></div>');
            a[0].style.backgroundImage = 'url("' + t.value + '")', a[0].style.backgroundRepeat = "no-repeat", a.css({
                position: "absolute",
                left: t.left + "px",
                top: t.top + "px",
                width: t.width + "px",
                height: t.height + "px",
                "z-index": 101
            }), a.attr("data-index", e), a.data("r", o), a.data("c", n), a[0].style.backgroundSize = t.width + "px " + t.height + "px", $(".ht_master .wtHider").append(a), a.myDrag({
                randomPosition: !1,
                direction: "all",
                handler: !1,
                x: t.left + "px",
                y: t.top + "px",
                elem: $(".ht_master .wtHider"),
                dragEnd: function (e, t, a) {
                    if (0 <= e.data("r") && 0 <= e.data("c")) {
                        var o = hot.Methods.getCellMeta(e.data("r"), e.data("c")).image[e.data("index")];
                        o.top = a, o.left = t
                    }
                }
            }), a.dragDivResize($(".ht_master .wtHider")[0], function (e, t, a) {
                var o = hot.Methods.getCellMeta(e.data("r"), e.data("c")).image[e.data("index")];
                o.width = t, o.height = a
            }), a.bind("click", function () {
                return $(".cell-img").removeClass("curr-img"), $(this).addClass("curr-img"), !1
            })
        }
    })
}

function openDic() {
    var l = hot.Methods.getSelected();
    if (l) {
        var e = l[0], t = hot.Methods.getCellMeta(e[0], e[1]).dic, o = "", n = "";
        t && (o = t.split("=")[0], n = t.split("=")[1]), layer.open({
            type: 1,
            area: ["554px", "166px"],
            title: "字典项配置",
            content: $("#dataDic"),
            cancel: function () {
            },
            success: function (a, e) {
                a.find("#dicds").empty(), a.find("#dicTypeVal").val(n);
                var t = getDataSetsNodesByParam("dic", !0);
                a.find("#dicds").append('<option value=""></option>'), $.each(t, function (e, t) {
                    a.find("#dicds").append('<option value="' + t.name + "." + t.keyName + '">' + t.name + "</option>")
                }), a.find("#dicds").val(o)
            },
            end: function () {
            },
            btn: ["保存", "取消"],
            yes: function (e, t) {
                var a = t.find("#dicds").val(), o = t.find("#dicTypeVal").val(), n = l[0];
                if (a && o) $("#parmdic").val(a + "=" + o), hot.Methods.setCellMeta(n[0], n[1], "dic", a + "=" + o); else {
                    $("#parmdic").val("");
                    var r = hot.Methods.getCellMeta(n[0], n[1]);
                    r.dic = "", delete r.dic
                }
                layer.close(e)
            },
            btn2: function (e, t) {
                layer.close(e)
            }
        })
    }
}

function removeDataDic() {
    var e = hot.Methods.getSelected();
    if (e) {
        var t = e[0], a = hot.Methods.getCellMeta(t[0], t[1]);
        a.dic = "", delete a.dic, $("#parmdic").val("")
    }
}

$(function () {
    var a, o = window.URL || window.webkitURL, n = $("#image"), t = $("#dataX"), r = $("#dataY"), l = $(".rdp-cropper"),
        i = $("#dataHeight"), s = $("#dataWidth"), d = $("#dataWidthRatio"), c = $("#dataHeightRatio"),
        u = $("#dataRotate"), p = $("#dataScaleX"), f = $("#dataScaleY"), e = $("#save-cropper-image"),
        g = $("#cancel-cropper-image"), m = !1, h = {
            aspectRatio: 16 / 9, preview: ".rdp-img-preview", crop: function (e) {
                m || (t.val(Math.round(e.detail.x)), r.val(Math.round(e.detail.y)), i.val(Math.round(e.detail.height)), s.val(Math.round(e.detail.width)), c.val(Math.round(e.detail.height)), d.val(Math.round(e.detail.width)), u.val(e.detail.rotate), p.val(e.detail.scaleX), f.val(e.detail.scaleY))
            }
        };
    n.attr("src");
    n.on({
        ready: function (e) {
        }, cropstart: function (e) {
        }, cropmove: function (e) {
        }, cropend: function (e) {
        }, crop: function (e) {
        }, zoom: function (e) {
        }
    }).cropper(h), $(".rdp-img-menu .menu-item").bind("click", function () {
        var e = $(this).data();
        if (n.data("cropper") && e.method) switch (e = $.extend({}, e), result = n.cropper(e.method, e.option, e.secondOption), e.method) {
            case"scaleX":
            case"scaleY":
                $(this).data("option", -e.option)
        }
    }), $(".docs-toggles").on("change", "input", function () {
        var e = $(this), t = e.attr("name");
        "radio" === e.prop("type") && (h[t] = e.val(), e.parents("li").addClass("active").siblings().removeClass("active")), n.cropper("destroy").cropper(h)
    }), $(".docs-data .cropper-data").bind("input propertychange", function () {
        m = !0;
        var e = {};
        e.x = Number(t.val()), e.y = Number(r.val()), e.height = Number(i.val()), e.width = Number(s.val()), e.rotate = Number(u.val()), e.scaleX = Number(p.val()), e.scaleY = Number(f.val()), m = !1, n.cropper("setData", e), e = null
    }), $(".docs-data .cropper-ratio").bind("input propertychange", function () {
        var e = $('input[name="aspectRatio"]:checked').val();
        if ("NaN" != e) {
            var t = Number(this.value);
            if ("dataWidthRatio" == this.id) {
                var a = t / e;
                c.val(Math.round(a))
            } else if ("dataHeightRatio" == this.id) {
                a = t * e;
                d.val(Math.round(a))
            }
        }
    }), e.bind("click", function () {
        var e = {};
        if (e.width = d.val(), e.height = c.val(), e.fillColor = "#fff", result = n.cropper("getCroppedCanvas", e), "importImage" == imageActionName) {
            var t = hot.Methods.getSelected();
            if (t) {
                var a = t[0], o = hot.Methods.getCell(a[0], a[1]);
                hot.Methods.setCellMeta(a[0], a[1], "bgimage", result.toDataURL()), o.style.backgroundImage = 'url("' + result.toDataURL() + '")', o.style.backgroundRepeat = "no-repeat"
            }
        } else if ("addImage" == imageActionName) {
            var i = $('<div class="cell-img"></div>');
            i[0].style.backgroundImage = 'url("' + result.toDataURL() + '")', i[0].style.backgroundRepeat = "no-repeat", i.css({
                position: "absolute",
                left: "49px",
                top: "25px",
                "z-index": 101
            });
            var s = new Image;
            s.onload = function () {
                var e = s.width, t = s.height;
                i.css({
                    width: e + "px",
                    height: t + "px"
                }), i[0].style.backgroundSize = e + "px " + t + "px", $(".ht_master .wtHider").append(i), i.myDrag({
                    randomPosition: !1,
                    direction: "all",
                    handler: !1,
                    elem: $(".ht_master .wtHider"),
                    dragEnd: function (e, t, a) {
                        if (0 <= e.data("r") && 0 <= e.data("c")) {
                            var o = hot.Methods.getCellMeta(e.data("r"), e.data("c")).image[e.data("index")];
                            o.top = a, o.left = t
                        }
                    }
                }), i.dragDivResize($(".ht_master .wtHider")[0], function (e, t, a) {
                    var o = hot.Methods.getCellMeta(e.data("r"), e.data("c")).image[e.data("index")];
                    o.width = t, o.height = a
                });
                var a = hot.Methods.getSelected();
                if (a) {
                    var o = a[0], n = hot.Methods.getCellMeta(o[0], o[1]).image || [], r = {};
                    r.value = result.toDataURL(), r.width = e, r.height = t, r.top = 0, r.left = 0, n.push(r);
                    var l = n.length - 1;
                    i.data("r", o[0]), i.data("c", o[1]), i.data("index", l), hot.Methods.setCellMeta(o[0], o[1], "image", n)
                }
                i.bind("click", function () {
                    return $(".cell-img").removeClass("curr-img"), $(this).addClass("curr-img"), !1
                })
            }, s.src = result.toDataURL()
        }
        l.hide()
    }), g.bind("click", function () {
        l.hide()
    });
    var v = $("#importImage");
    o ? v.bind("change", function () {
        l.css({"z-index": 104, opacity: 1}).show();
        var e, t = this.files;
        n.data("cropper") && t && t.length && (e = t[0], /^image\/\w+$/.test(e.type) ? (e.name, e.type, a && o.revokeObjectURL(a), a = o.createObjectURL(e), n.cropper("destroy").attr("src", a).cropper(h), v.val(""), setTimeout(function () {
            d.val(s.val()), c.val(i.val())
        }, 100)) : window.alert("Please choose an image file."))
    }) : v.prop("disabled", !0).parent().addClass("disabled"), $(document).bind("click", function () {
        $(".cell-img").removeClass("curr-img")
    })
});
var dsname = "", dataExprSetting = {
    data: {simpleData: {enable: !0}, key: {title: "title"}},
    callback: {onDblClick: onDblClickForExpr}
}, dataExprZNodes = [{id: 1, pId: 0, name: "全部", open: !0}, {id: 10, pId: 1, name: "数据集函数"}, {
    id: 1001,
    pId: 10,
    name: "select()",
    title: "参数：select(String filed,String filter)\n说明：首列数据集过滤\n返回值：按filter条件过滤后的数据集的filed字段对应的值"
}, {id: 1002, pId: 10, name: "group()", title: "参数：group(String str)\n说明：分组函数，同类别同行合并\n返回值：原字符串 "}, {
    id: 1003,
    pId: 10,
    name: "gpc()",
    title: "参数：gpc(String str)\n说明：动态列，用作动态扩展列\n返回值：查询动态字符串 "
}, {id: 20, pId: 1, name: "单元格函数"}, {
    id: 2001,
    pId: 20,
    name: "sum()",
    title: "参数：sum(Object... args)\n说明：转Double后求和\n返回值：和字符串"
}, {id: 2002, pId: 20, name: "avg()", title: "参数：avg(Object... args)\n说明：转Double后求平均数\n返回值：平均值字符串"}, {
    id: 2003,
    pId: 20,
    name: "max()",
    title: "参数：max(Object... args)\n说明：转Double后求最大值\n返回值：最大值字符串"
}, {id: 2004, pId: 20, name: "min()", title: "参数：min(Object... args)\n说明：转Double后求最小值\n返回值：最小值字符串"}, {
    id: 2006,
    pId: 20,
    name: "nvl()",
    title: "参数：nvl(Object value1,Object value2)\n说明：处理空值\n返回值：当value1为null或空字符串时返回value2，否则返回value1"
}, {
    id: 2007,
    pId: 20,
    name: "img()",
    title: "参数：img(Object... url)\n说明：一个参数：url 其中url为图片地址，长宽自适应单元格尺寸\n&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;  两个参数：url,true 其中url为图片地址，长宽自适应图片实际尺寸\n&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;  三个参数：url,width,height 其中url为图片地址,width为图片宽度，height为图片高度\n返回值：图片地址为url的img标签"
}, {id: 30, pId: 1, name: "时间日期函数"}, {
    id: 3001,
    pId: 30,
    name: "day()",
    title: "参数：day(String dateStr)，格式：yyyy-MM-dd HH:mm:ss\n说明：获取日期\n返回值：日期字符串"
}, {
    id: 3002,
    pId: 30,
    name: "month()",
    title: "参数：month(String dateStr)，格式：yyyy-MM-dd HH:mm:ss\n说明：获取月份\n返回值：月份字符串"
}, {
    id: 3003,
    pId: 30,
    name: "year()",
    title: "参数：year(String dateStr)，格式：yyyy-MM-dd HH:mm:ss\n说明：获取年份\n返回值：年份字符串"
}, {id: 3004, pId: 30, name: "now()", title: "参数：now()\n说明：返回当前时间\n返回值：当前时间字符串（格式：yyyy-MM-dd HH:mm:ss）"}, {
    id: 3005,
    pId: 30,
    name: "time()",
    title: "参数：time()\n说明：返回当前时间\n返回值：当前时间字符串（格式：HH:mm:ss）"
}, {id: 40, pId: 1, name: "字符串函数"}, {
    id: 4001,
    pId: 40,
    name: "chn()",
    title: "参数：1、chn(String str)\n2、chn(String str,boolean flag1,boolean flag2)\n3、chn(String str,boolean flag1)\n说明：数字转中文大写\n返回值：1、纯中文大写（例：2800->二八零零）\n\t    2、flag2为true返回大写（例：2800->贰仟捌佰），其它同1\n\t    3、flag1为true返回大写（例：2800->二千八百）,其它同1\n"
}, {
    id: 4002,
    pId: 40,
    name: "left()",
    title: "参数：left(String str,int n)\n说明：截取左边n个字符\n返回值：截取后的字符串（长度不够直接返回原字符串）"
}, {
    id: 4003,
    pId: 40,
    name: "right()",
    title: "参数：right(String str,int n)\n说明：截取右边n个字符\n返回值：截取后的字符串（长度不够直接返回原字符串）"
}, {
    id: 4004,
    pId: 40,
    name: "mid()",
    title: "参数：1、mid(String str,int start)\n2、mid(String str,int start,int end)\n说明：截取字符串\n返回值：1、返回从start位置开始的字符串\n\t\t2、返回从start位置开始，end位置结束的字符串"
}, {id: 4005, pId: 40, name: "ltrim()", title: "参数：ltrim(String str)\n说明：去除左空格\n返回值：去除左空格的字符串"}, {
    id: 4006,
    pId: 40,
    name: "rtrim()",
    title: "参数：rtrim(String str)\n说明：去除右空格\n返回值：去除右空格的字符串"
}, {id: 4007, pId: 40, name: "trim()", title: "参数：trim(String str)\n说明：去除左右空格\n返回值：去除左右空格的字符串"}, {
    id: 4008,
    pId: 40,
    name: "len()",
    title: "参数：len(String str)\n说明：取长度\n返回值：字符串的长度"
}, {id: 4009, pId: 40, name: "lower()", title: "参数：lower(String str)\n说明：转小写\n返回值：转小写后的字符串"}, {
    id: 4010,
    pId: 40,
    name: "upper()",
    title: "参数：upper(String str)\n说明：转大写\n返回值：转大写后的字符串"
}, {
    id: 4011,
    pId: 40,
    name: "pos()",
    title: "参数：1、pos(String str1,String str2)\n2、pos(String str1,String str2,int index)\n说明：查找位置\n返回值：1、返回str2在str1中的第一次出现位置\n\t\t2、返回str2在tr1中的第index次出现位置"
}, {id: 4012, pId: 40, name: "rmb()", title: "参数：rmb(Number num)、rmb(String num)\n说明：转人民币大写\n返回值：人民币大写字符串"}, {
    id: 4013,
    pId: 40,
    name: "rplc()",
    title: "参数：rplc(String str,String strz,String strt)\n说明：全部替换\n返回值：将str中的strz全部替换成strt后的字符串"
}, {id: 4014, pId: 40, name: "space()", title: "参数：space(int n)\n说明：取空格\n返回值：有n个空格的字符串"}, {
    id: 4015,
    pId: 40,
    name: "split()",
    title: "参数：split(String str,String flag)\n说明：以flag分隔字符串\n返回值：分隔后的数组"
}, {id: 4016, pId: 40, name: "wordCap()", title: "参数：wordCap(String str)\n说明：去除空白字符并转为大写\n返回值：大写字符串"}, {
    id: 4017,
    pId: 40,
    name: "rmQuote()",
    title: "参数：rmQuote(String str)\n说明：替换字符串中的单、双引号\n返回值：替换后的字符串"
}, {id: 50, pId: 1, name: "数据类型转换函数"}, {
    id: 5001,
    pId: 50,
    name: "date()",
    title: "参数：date(String dataStr)，格式：yyyy-MM-dd\n说明：日期字符串格式化为长日期\n返回值：格式化后的日期"
}, {
    id: 5002,
    pId: 50,
    name: "dateTime()",
    title: "参数：dateTime(String dataStr)、dateTime(Long dataStr)\n说明：日期格式化\n返回值：格式化后的日期（yyyy-MM-dd HH:mm:ss）"
}, {
    id: 5003,
    pId: 50,
    name: "dateTime2()",
    title: "参数：dateTime2(String dataStr, String format)\n说明：按格式格式化日期\n返回值：返回format格式化后的日期"
}, {id: 5004, pId: 50, name: "toDouble()", title: "参数：toDouble(String str)\n说明：转换成double类型\n返回值：double值"}, {
    id: 5005,
    pId: 50,
    name: "toFloat()",
    title: "参数：toFloat(String str)\n说明：转换成float类型\n返回值：float值"
}, {id: 5006, pId: 50, name: "toInt()", title: "参数：toInt(String str)\n说明：转换成int类型\n返回值：int值"}, {
    id: 5007,
    pId: 50,
    name: "toLong()",
    title: "参数：toLong(String str)\n说明：转换成long类型\n返回值：long值"
}, {id: 5008, pId: 50, name: "toNumber()", title: "参数：toNumber(String str)\n说明：转换成number类型\n返回值：number值"}, {
    id: 5009,
    pId: 50,
    name: "toStr()",
    title: "参数：String toStr(Object obj)\n说明：对象转换成字符串\n返回值：转换后的字符串"
}, {
    id: 5010,
    pId: 50,
    name: "toDef()",
    title: "参数：toDef(Object str,String pattern)，pattern格式：DecimalFormat支持的格式（例：#,##0.00）\n说明：自定义数值格式化（str自动转成double类型）\n返回值：格式化后的字符串"
}, {
    id: 5011,
    pId: 50,
    name: "toDtf()",
    title: "参数：toDtf(Object str,String frompattern,String topattern)，pattern格式：SimpleDateFormat支持的格式\n说明：自定义日期格式化\n返回值：格式化后的日期"
}, {
    id: 5012,
    pId: 50,
    name: "toDwf()",
    title: "参数：toDwf(Object str,String pattern)，pattern格式：DecimalFormat支持的格式（例：#,##0.00）\n说明：自定义数值格式化（str自动转成double类型并除以10000）\n返回值：格式化后的字符串"
}, {id: 60, pId: 1, name: "统计函数"}, {
    id: 6001,
    pId: 60,
    name: "smalltotal()",
    title: "参数：smalltotal(String filed)\n说明：分组小计指定字段参数求和\n返回值：统计分组小计求和值"
}, {id: 6002, pId: 60, name: "smallrecord()", title: "参数：smalltotal()\n说明：分组小计组内记录数\n返回值：分组小计组内记录数"}, {
    id: 6003,
    pId: 60,
    name: "count()",
    title: "参数：count(String filed)\n说明：当前页对应字段数据求和\n返回值：统计求和值"
}, {id: 70, pId: 1, name: "表达式"}, {
    id: 7001,
    pId: 70,
    name: "if(条件){结果1}else{结果2}",
    title: "说明：if-else条件判断,支持嵌套\n返回值：结果"
}, {id: 7002, pId: 70, name: "条件?结果1:结果2", title: "说明：三元表达式，支持嵌套\n返回值：结果"}];

function onDblClickForExpr(e, t, a, o) {
    2 == a.level && filld(a.name)
}

function filld(e) {
    "" != dsname && (e = e.replace("$F{", "$F{" + dsname + ".")), insertAtCursor(document.getElementById("exptext"), e);
    var t = $("#exptext").val().indexOf("()");
    0 < t && setCursorPosition(document.getElementById("exptext"), t + 1)
}

function initExpr() {
    var e = getDataSetsNodesByParam("level", 1);
    $("#aexpr").empty(), $("#ds").empty(), $("#ds").append("<option value=''></option>"), $.each(e, function (e, t) {
        $("#aexpr").append('<option value="' + t.name + '">' + t.name + "</option>"), $("#ds").append('<option value="' + t.name + '">' + t.name + "</option>")
    }), $("#aexpr").append('<option value="parm">参数</option>')
}

function changeDataSets(e) {
    if ($("#dsvs").empty(), $("#dsvs").append("<option value=''></option>"), "" == e) $("#dsvt").show().val("").focus(), $("#dsvs").hide(); else {
        var t = getDataSetsNodesByParam("type", "field", getDataSetsNodesByParam("dataSetName", e)[0])[0].children;
        $.each(t, function (e, t) {
            $("#dsvs").append('<option value="' + t.name + '">' + t.name + "</option>")
        }), $("#dsvt").hide(), $("#dsvs").show()
    }
    var a = hot.Methods.getSelected();
    if (a) {
        var o = a[0];
        hot.Methods.setCellMeta(o[0], o[1], "ds", e)
    }
}

function setdv(e) {
    var t = hot.Methods.getSelected();
    if (t) {
        var a = "";
        "" != e.value && (a = "=" + $("#ds").val() + "." + e.value), hot.Methods.setDataAtCell(t[0][0], t[0][1], a)
    }
}

function setv(e, t) {
    var a = hot.Methods.getSelected();
    a && hot.Methods.setDataAtCell(a[0][0], a[0][1], t)
}

function sl(e) {
    if ($("#bexpr").empty(), "parm" == e) {
        var t = getDataParmsNodesByParam("level", 1);
        $.each(t, function (e, t) {
            $("#bexpr").append('<option value="' + t.parmName + '">' + t.parmName + "</option>")
        })
    } else {
        var a = getDataSetsNodesByParam("type", "field", getDataSetsNodesByParam("name", dsname = e)[0])[0].children;
        $.each(a, function (e, t) {
            $("#bexpr").append('<option value="' + t.name + '">' + t.name + "</option>")
        })
    }
}

function setCursorPosition(t, a) {
    var o = t.value.length;
    if (o < a) return !1;
    setTimeout(function () {
        if (t.focus(), t.setSelectionRange) t.setSelectionRange(a, a); else {
            var e = t.createTextRange();
            e.moveStart("character", -o), e.moveEnd("character", -o), e.moveStart("character", a), e.moveEnd("character", 0), e.select()
        }
    }, 10)
}

function insertAtCursor(e, t) {
    if (document.selection) e.focus(), sel = document.selection.createRange(), sel.text = t, sel.select(); else if (e.selectionStart || "0" == e.selectionStart) {
        var a = e.selectionStart, o = e.selectionEnd, n = e.scrollTop;
        e.value = e.value.substring(0, a) + t + e.value.substring(o, e.value.length), 0 < n && (e.scrollTop = n), e.focus(), e.selectionStart = a + t.length, e.selectionEnd = a + t.length
    } else e.value += t, e.focus()
}

function submit() {
    try {
        var e = hot.Methods.getSelected();
        if (e) {
            var t = e[0],
                a = $("#exptext").val().replace(/\&/g, "&amp;").replace(/\>/g, "&gt;").replace(/\</g, "&lt;").trim();
            hot.Methods.setCellMeta(t[0], t[1], "exptext", a);
            var o = warningTree.getWarningData("condition_tree");
            hot.Methods.setCellMeta(t[0], t[1], "warnings", o), setCellval(a)
        }
    } catch (e) {
    }
}

function openExpr() {
    initExpr(), layer.open({
        type: 1,
        area: ["800px", "600px"],
        title: "表达式配置",
        content: $("#dataExpr"),
        cancel: function () {
        },
        success: function (e, t) {
            var a = hot.Methods.getSelected();
            if (a) {
                var o = hot.Methods.getDataAtCell(a[0][0], a[0][1]);
                if (initDataExprWarning(hot.Methods.getCellMeta(a[0][0], a[0][1]).warnings), o && 0 == o.indexOf("=")) {
                    $("#dsvt").hide(), $("#dsvs").show();
                    var n = o.substring(1, o.length).split(".");
                    changeDataSets(n[0]), $("#ds").val(n[0]), $("#dsvs").val(n[1])
                } else $("#ds").val(""), $("#dsvt").show().val(o), $("#dsvs").hide()
            }
        },
        end: function () {
        },
        btn: ["保存", "取消"],
        yes: function (e, t) {
            submit(), layer.close(e)
        },
        btn2: function (e, t) {
            layer.close(e)
        }
    })
}

function dataExprTabs(e) {
    var t = $(e), a = t.parent().index();
    t.parents("ul").find(".current").removeClass("current"), t.parent().addClass("current"), t.parents(".dataExpr").find(".tabs-content .tabs-pages").addClass("tabs-hiden"), t.parents(".dataExpr").find(".tabs-content .tabs-pages.tabs" + a).removeClass("tabs-hiden")
}

function initDataExprWarning(e) {
    var t = $(".table-warning").find(".tr-list .list-context");
    setDataExprWarningDataDefault();
    var a = t.find("#condition_tree");
    void 0 !== e && null != e && "" != e ? warningTree.initTree(a, e) : warningTree.initTree(a, [])
}

var prefix = "warning", warningTree = {
    defaultStyle: {font_size: "", font_weight: "", color: "", background_color: ""},
    defaultSymbol: {operator: "0", value: "", andOr: "and", explain: "", operatorText: ""},
    setting: {
        data: {keep: {parent: !0, leaf: !0}, simpleData: {enable: !0}}, callback: {
            onClick: function (e, t, a) {
                if (a.isParent) setWarningStyleData(a.nodeData.style, a.name); else {
                    var o = a.getParentNode();
                    setWarningStyleData(o.nodeData.style, o.name), setWarningSymbolData(a.nodeData.symbol)
                }
            }
        }
    },
    selectedNode: function () {
        return $(".curSelectedNode")
    },
    initTree: function (e, t) {
        var r = [];
        $.each(t, function (n, e) {
            var t = {};
            t.id = prefix + n, t.name = e.name, t.pId = 0, t.open = !0, t.isParent = !0;
            var a = e.style;
            $.extend(!0, warningTree.defaultStyle, a), t.nodeData = {style: a}, r.push(t), $.each(e.symbols, function (e, t) {
                var a = {}, o = t;
                $.extend(!0, warningTree.defaultSymbol, o), a.id = prefix + n + e, a.name = warningTree.getSymbolName(o), a.pId = prefix + n, a.isParent = !1, a.nodeData = {symbol: o}, r.push(a)
            })
        }), $.fn.zTree.init($(e), warningTree.setting, r)
    },
    addLevel_1: function (e) {
        var t = $.fn.zTree.getZTreeObj(e), a = [{
            id: prefix + 1,
            name: "条件属性1",
            pid: 0,
            open: !0,
            isParent: !0,
            nodeData: {style: getWarningStyleData()}
        }];
        if (null != t) {
            var o = warningTree.getMaxNodes(t.getNodes());
            $.extend(!0, a, [{id: prefix + o, name: "条件属性" + o}]), t.addNodes(null, a)
        } else $.fn.zTree.init($("#" + e), warningTree.setting, a)
    },
    add: function (e) {
        var t = $.fn.zTree.getZTreeObj(e), a = t.getSelectedNodes()[0];
        if (a && a.isParent) {
            var o = warningTree.getMaxNodes(a.children);
            a = t.addNodes(a, {
                id: prefix + a.id + "_" + o,
                pId: a.id,
                isParent: !1,
                name: warningTree.getSymbolName(getWarningSymbolData()),
                nodeData: {symbol: getWarningSymbolData()}
            })
        } else if (a) {
            var n = a.getParentNode();
            o = warningTree.getMaxNodes(n.children);
            a = t.addNodes(n, {
                id: prefix + a.id + "_" + o,
                pId: n.pId,
                isParent: !1,
                name: warningTree.getSymbolName(getWarningSymbolData()),
                nodeData: {symbol: getWarningSymbolData()}
            })
        } else layer.msg("未选择条件项")
    },
    update: function (e) {
        var t = $.fn.zTree.getZTreeObj(e), a = t.getSelectedNodes(), o = a[0];
        if (0 < a.length) if (o.isParent) o.name = warningTree.getConditionName(), o.nodeData = {style: getWarningStyleData()}, t.updateNode(o); else {
            var n = o.getParentNode();
            n.name = warningTree.getConditionName(), n.nodeData = {style: getWarningStyleData()}, t.updateNode(n), o.nodeData = {symbol: getWarningSymbolData()}, o.name = warningTree.getSymbolName(getWarningSymbolData()), t.updateNode(o)
        } else layer.msg("请先选择一个节点")
    },
    del: function (e) {
        var t = $.fn.zTree.getZTreeObj(e), a = t.getSelectedNodes(), o = a[0];
        0 != a.length ? t.removeNode(o, !0) : alert("请先选择一个节点")
    },
    getMaxNodes: function (e) {
        return null != e && void 0 !== e ? e.length + 1 : 1
    },
    isExist: function (e, t) {
    },
    getWarningData: function (e) {
        var t = $.fn.zTree.getZTreeObj(e), a = [];
        if (t) for (var o = t.getNodes(), n = o.length, r = 0; r < n; r++) {
            var l = {}, i = o[r];
            l.name = i.name, l.style = i.nodeData.style;
            var s = i.children, d = [];
            if (null != s && void 0 !== s) for (var c = 0; c < s.length; c++) d.push(s[c].nodeData.symbol);
            l.symbols = d, a.push(l)
        }
        return a
    },
    getSymbolName: function (e) {
        var t = "";
        return void 0 !== e && (t += e.andOr, t += e.operatorText, t += e.value, "" != e.explain && (t += "(" + e.explain + ")")), t
    },
    getConditionName: function () {
        return $(".table-warning").find(".tr-condition_name").find("input[name='conditionName']").val()
    }
};

function getWarningStyleData() {
    var e = $(".table-warning").find(".tr-attr"), t = e.find("input[name='tdFontSize']").val(),
        a = e.find("input[name='tdFontWeight']").val(), o = e.find("input[name='tdFontColor']").val(),
        n = e.find("input[name='tdFontBgColor']").val(), r = {};
    return r.font_size = t, r.font_weight = a, r.color = o, r.background_color = n, r
}

function getWarningSymbolData() {
    var e = $(".table-warning").find(".tr-symbol"), t = e.find("select[name='operator']").val(),
        a = e.find("select[name='operator']").find("option:selected").text(), o = e.find("input[name='tdValue']").val(),
        n = e.find("input[name='andOr']:checked").val(), r = e.find("textarea[name='explain']").val(), l = {};
    return l.operator = t, l.operatorText = a, l.andOr = n, l.value = o, l.explain = r, l
}

function setWarningStyleData(e, t) {
    var a = $(".table-warning").find(".tr-attr");
    $(".table-warning").find(".tr-condition_name").find("input[name='conditionName']").val(t), $.extend(!0, warningTree.defaultStyle, e), a.find("input[name='tdFontSize']").val(e.font_size), a.find("input[name='tdFontWeight']").val(e.font_weight), a.find("input[name='tdFontColor']").val(e.color), a.find("input[name='tdFontBgColor']").val(e.background_color), e.background_color ? ($("#tdchangeBgColor").css("background-color", e.background_color), $("#tdchangeBgColor").css("background-image", "")) : ($("#tdchangeBgColor").css("background-color", ""), $("#tdchangeBgColor").css("background-image", "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)")), e.color ? ($("#tdchangeColor").css("background-color", e.color), $("#tdchangeColor").css("background-image", "")) : ($("#tdchangeColor").css("background-color", ""), $("#tdchangeColor").css("background-image", "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)"));
    var o = $(".table-warning").find(".tr-symbol");
    o.find("select[name='operator']").val("0"), o.find("input[name='tdValue']").val(""), o.find("input[name='andOr'][value='and']").prop("checked", !0), o.find("textarea[name='explain']").val("")
}

function setWarningSymbolData(e) {
    var t = $(".table-warning").find(".tr-symbol");
    $.extend(!0, warningTree.defaultSymbol, e), t.find("select[name='operator']").val(e.operator), t.find("input[name='tdValue']").val(e.value), t.find("input[name='andOr'][value='" + e.andOr + "']").prop("checked", !0), t.find("textarea[name='explain']").val(e.explain)
}

function setDataExprWarningDataDefault() {
    var e = $(".table-warning").find(".tr-attr"), t = $(".table-warning").find(".tr-symbol");
    $(".table-warning").find(".tr-condition_name").find("input[name='conditionName']").val(""), e.find("input[name='tdFontSize']").val(""), e.find("input[name='tdFontWeight']").val(""), e.find("input[name='tdFontColor']").val(""), e.find("input[name='tdFontBgColor']").val(""), $("#tdchangeBgColor").css("background-image", "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)"), $("#tdchangeColor").css("background-image", "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)"), t.find("select[name='operator']").val("0"), t.find("input[name='tdValue']").val(""), t.find("input[name='andOr'][value='and']").prop("checked", !0), t.find("textarea[name='explain']").val("")
}

var dataLinkLayero, parmstr = "", filestr = "", datalinkparmData = {};

function addLink() {
    var e = hot.Methods.getSelected();
    if (e) {
        var t = e[0], c = hot.Methods.getCellMeta(t[0], t[1]), a = hot.Methods.getDataAtCell(t[0], t[1]);
        if (!a) return layer.msg("当前单元格未配置字段"), !1;
        var u = a.substring(1, a.length).split(".");
        layer.open({
            type: 1, area: ["600px", "480px"], title: "配置超链接", content: $("#dataLink"), cancel: function () {
            }, success: function (o, e) {
                datalinkparmData = {}, (dataLinkLayero = o).find("#temlist").empty(), o.find("#plist").empty(), o.find("#myconfig").val(""), o.find("#temlist").append("<option value='' >请选择</option>");
                var n = "";
                filestr = "";
                var t = c.link;
                if (t) {
                    o.find("#myconfig").val(t);
                    for (var a = t.split(","), r = 0; r < a.length; r++) {
                        var l = a[r].split(":");
                        "uuid" == l[0] ? n = l[1] : -1 < l[1].indexOf("(#=") ? datalinkparmData[l[0]] = l[1].replace("(#=", "").replace("#)", "") : datalinkparmData[l[0]] = l[1]
                    }
                }
                "" != n && $.rdp.ajax({
                    url: "../../selectAllParmsByUUID.action",
                    type: "post",
                    data: {uuid: n},
                    async: !1,
                    success: function (e) {
                        for (var t in parmstr = "", e) parmstr += "<option value=" + t + ">" + t + "</option>"
                    }
                });
                var i = $.fn.zTree.getZTreeObj("dataSets"), s = i.getNodeByParam("dataSetName", u[0], null),
                    d = i.getNodeByParam("type", "field", s).children;
                $.each(d, function (e, t) {
                    filestr += "<option value=" + u[0] + "." + t.columnName + ">" + u[0] + "." + t.columnComments + "</option>"
                }), $.each(datalinkparmData, function (e, t) {
                    "url" != e && "reporttype" != e && "parms" != e && addp(t, e)
                }), $.rdp.ajax({
                    url: "../../selectAllReportFile.action", type: "post", success: function (e) {
                        for (var t in e) {
                            var a = "";
                            n == e[t].uuid && (a = " selected = 'selected'"), o.find("#temlist").append("<option value='" + e[t].uuid + ",reporttype:" + getreportstyle(e[t].reportStyle) + "' " + a + ">" + e[t].name + "</option>")
                        }
                        $("#padd").show()
                    }
                }), o.find("#temlist").bind("change", function () {
                    var e = this.value.split(",")[0];
                    o.find("#plist").empty(), $.rdp.ajax({
                        url: "../../selectAllParmsByUUID.action",
                        type: "post",
                        data: {uuid: e},
                        success: function (e) {
                            for (var t in parmstr = "", e) parmstr += "<option value=" + t + ">" + t + "</option>"
                        }
                    })
                })
            }, end: function () {
                dataLinkLayero = null, console.log("销毁layer")
            }, btn: ["保存", "取消"], yes: function (e, t) {
                var a = hot.Methods.getSelected();
                if (a) {
                    var o = a[0];
                    hot.Methods.getCellMeta(o[0], o[1]);
                    hot.Methods.setCellMeta(o[0], o[1], "link", dataLinkLayero.find("#myconfig").val())
                }
                console.log("保存"), layer.close(e)
            }, btn2: function (e, t) {
                layer.close(e)
            }
        })
    }
}

function getreportstyle(e) {
    var t = "";
    switch (e) {
        case"普通报表":
            t = "N";
            break;
        case"图表报表":
            t = "C";
            break;
        default:
            t = "D"
    }
    return t
}

function createlink() {
    var a = "url:designPreviewIndex.jsp,uuid:" + dataLinkLayero.find("#temlist").val() + ",";
    dataLinkLayero.find("#plist").find(".top").each(function () {
        var e = $(this).find(".filelist")[0].value, t = $(this).find(".parmlist")[0].value;
        a += t + ":(#=" + e + "#),"
    }), dataLinkLayero.find("#myconfig").val(a.substring(0, a.length - 1))
}

function addp(e, t) {
    var a = (new Date).getTime(),
        o = '<div class="top"><span><select name="parmlist" class="parmlist" id="parmlist' + a + '"><option value="">请选择参数</option>' + parmstr + '</select></span><span>=</span><span><select name="filelist" class="filelist" id="filelist' + a + '"><option value="">请选择字段</option>' + filestr + '</select></span><span><input type="button" class="pdel" value="删除" onclick="$(this).parent().parent(\'div\').remove();" /></span></div>';
    dataLinkLayero.find("#plist").append(o), dataLinkLayero.find("#filelist" + a).val(e), dataLinkLayero.find("#parmlist" + a).val(t)
}

function removeLink() {
    var e = hot.Methods.getSelected();
    if (e) {
        var t = e[0], a = hot.Methods.getCellMeta(t[0], t[1]);
        a.link = "", delete a.link
    }
}

var tempLayeroForParms, tempDataReportLayerIndex, tempTreeNodeForSets, settingForParms = {
    view: {
        showLine: !1,
        addDiyDom: addDiyDomForParms,
        addHoverDom: addHoverDomForParms,
        removeHoverDom: removeHoverDomForParms
    },
    data: {simpleData: {enable: !0}},
    edit: {
        enable: !0, showRenameBtn: !1, showRemoveBtn: function (e, t) {
            return 1 == t.level
        }, removeTitle: "删除", drag: {autoExpandTrigger: !0, prev: !1, inner: !1, next: !1, isCopy: !0, isMove: !1}
    },
    callback: {beforeDrag: beforeDragForParms, onClick: zTreeOnClickForParms, beforeRemove: zTreeBeforeRemoveForParms}
}, zNodesForParms = [{id: 0, name: "参数列表", open: !0}];

function getDataParmsNodesByParam(e, t, a) {
    return $.fn.zTree.getZTreeObj("dataParms").getNodesByParam(e, t, a)
}

function addDiyDomForParms(e, t) {
    if (0 == t.level) {
        $("#" + t.tId + "_a").append('<button type="button" class="tb_btn" id="addParmBtn" onclick="addDataParms()">添加参数</button>')
    }
}

function zTreeOnClickForParms(e, t, a) {
}

function beforeDragForParms(e, t) {
    return 1 == t[0].level
}

function zTreeBeforeRemoveForParms(e, t) {
    return layer.confirm("确认删除参数  “" + t.name + "” 吗？", {btn: ["确定", "取消"]}, function (e) {
        $.fn.zTree.getZTreeObj("dataParms").removeNode(t), layer.alert("删除成功!")
    }, function (e) {
        layer.close(e)
    }), !1
}

function addHoverDomForParms(e, t) {
    if (1 != t.level) return !1;
    var a = $("#" + t.tId + "_span");
    if (!(t.editNameFlag || 0 < $("#" + t.tId + "_editBtn").length)) {
        var o = "<span class='button edit' id='" + t.tId + "_editBtn' title='修改' onfocus='this.blur();'></span>";
        a.after(o);
        var n = $("#" + t.tId + "_editBtn");
        n && n.bind("click", function () {
            return addDataParms(t), !1
        })
    }
}

function removeHoverDomForParms(e, t) {
    if (1 != t.level) return !1;
    $("#" + t.tId + "_editBtn").unbind().remove()
}

function addDataParms(a) {
    layer.open({
        type: 1, area: ["535px", "410px"], title: "参数配置", content: $("#dataParmsInfo"), cancel: function () {
        }, success: function (e, t) {
            a ? setDomAllVals(e[0], a) : setDomAllVals(e[0])
        }, end: function () {
        }, btn: ["添加", "取消"], yes: function (e, t) {
            a ? editParmNode(t, a) : addParmNode(t), layer.close(e)
        }, btn2: function (e, t) {
            layer.close(e)
        }
    })
}

function addParmNode(e) {
    var t = getDomAllVals(e[0]), a = $.fn.zTree.getZTreeObj("dataParms"), o = a.getNodes(), n = $.extend(!0, {}, t);
    n.name = t.parmCName, n = a.addNodes(o[0], n)
}

function editParmNode(e, t) {
    var a = getDomAllVals(e[0]), o = $.fn.zTree.getZTreeObj("dataParms");
    (t = $.extend(!0, t, a)).name = a.parmCName, o.updateNode(t)
}

function setFrameId(e) {
    var t = hot.Methods.getSelected();
    if (t) {
        var a = t[0];
        hot.Methods.getCellMeta(a[0], a[1]);
        hot.Methods.setCellMeta(a[0], a[1], "frameid", $(e).val()), hot.Methods.setDataAtCell(a[0], a[1], "subreport:" + $(e).find("option:selected").text())
    }
    layer.close(tempDataReportLayerIndex)
}

function removeReport() {
    var e = hot.Methods.getSelected();
    if (e) {
        var t = e[0], a = hot.Methods.getCellMeta(t[0], t[1]);
        a.frameid = "", delete a.frameid, hot.Methods.setDataAtCell(t[0], t[1], "")
    }
}

function addSubReport() {
    var e = hot.Methods.getSelected();
    if (e) {
        var t = e[0], a = hot.Methods.getCell(t[0], t[1]), o = $(a).offset().left + $(a).width(),
            n = $(a).offset().top + $(a).height(), r = hot.Methods.getCellMeta(t[0], t[1]).frameid;
        tempDataReportLayerIndex = layer.open({
            type: 1,
            shade: .01,
            title: !1,
            shadeClose: !0,
            closeBtn: 0,
            offset: [n + "px", o + "px"],
            resize: !1,
            success: function (e, t) {
                e.find("#temlist").empty(), e.find("#temlist").append("<option value=''>请选择子报表</option>"), $.rdp.ajax({
                    url: "../../selectAllReportFile.action",
                    type: "post",
                    success: function (e) {
                        for (var t in e) {
                            var a = "";
                            r == e[t].uuid && (a = " selected = 'selected'"), $("#temlist").append("<option value='" + e[t].uuid + "' " + a + ">" + e[t].name + "</option>")
                        }
                    }
                })
            },
            content: $("#dataReports")
        })
    }
}

var tempCoordsForSets, tempLayeroForSets, dragFlagForSets = !1, settingForSets = {
    view: {
        addHoverDom: addHoverDomForSets,
        removeHoverDom: removeHoverDomForSets,
        addDiyDom: addDiyDomForSets
    },
    data: {simpleData: {enable: !0}},
    edit: {
        drag: {
            autoExpandTrigger: !0, prev: function (e, t, a) {
                return !(!a.getParentNode() || "parms" != a.getParentNode().type)
            }, inner: function (e, t, a) {
                return a && "parms" == a.type
            }, next: function (e, t, a) {
                return !(!a.getParentNode() || "parms" != a.getParentNode().type)
            }, isCopy: !0, isMove: !1
        }, enable: !0, showRenameBtn: !1, showRemoveBtn: function (e, t) {
            return 1 == t.level
        }, removeTitle: "删除"
    },
    callback: {
        beforeDrag: beforeDragForSets,
        beforeDrop: beforeDropForSets,
        onDrag: onDragForSets,
        onDrop: onDropForSets,
        onClick: zTreeOnClickForSets,
        beforeRemove: zTreeBeforeRemoveForSets
    }
}, zNodesForSets = [{id: 1, pId: 0, name: "数据集列表", open: !0}];

function getDataSetsNodesByParam(e, t, a) {
    return $.fn.zTree.getZTreeObj("dataSets").getNodesByParam(e, t, a)
}

function addDiyDomForSets(e, t) {
    if (0 == t.level) {
        $("#" + t.tId + "_a").append('<button type="button" class="tb_btn" id="addDataSetsBtn" onclick="addDataSets()">新增数据集</button>')
    }
}

function beforeDragForSets(e, t) {
    return "field" == t[0].type || "field" == t[0].getParentNode().type && 3 == t[0].level
}

function beforeDropForSets(e, t, a, o, n) {
    return !0
}

function onDragForSets(e, t, a) {
    dragFlagForSets = !0
}

function onDropForSets(e, t, a, o, n, r) {
    if (dragFlagForSets = !1, a[0].type && "field" == a[0].type) {
        var l = a[0].getParentNode().name, i = a[0].children, s = Number(tempCoordsForSets.row),
            d = Number(tempCoordsForSets.col);
        $.each(i, function (e, t) {
            hot.Methods.setDataAtCell(s, d + e, "=" + l + "." + t.name), hot.Methods.setCellMeta(s, d + e, "columnName", t.columnName), hot.Methods.setCellMeta(s, d + e, "columnType", t.columnType)
        }), tempCoordsForSets = {}, console.log(a[0])
    } else {
        l = a[0].getParentNode().getParentNode().name;
        hot.Methods.setDataAtCell(tempCoordsForSets.row, tempCoordsForSets.col, "=" + l + "." + a[0].name), hot.Methods.setCellMeta(tempCoordsForSets.row, tempCoordsForSets.col, "columnName", a[0].columnName), hot.Methods.setCellMeta(tempCoordsForSets.row, tempCoordsForSets.col, "columnType", a[0].columnType), tempCoordsForSets = {}
    }
}

function setCoords(e) {
    tempCoordsForSets = e
}

function zTreeOnClickForSets(e, t, a) {
}

function zTreeBeforeRemoveForSets(e, t) {
    return layer.confirm("确认删除数据集  “" + t.name + "” 吗？", {btn: ["确定", "取消"]}, function (e) {
        $.fn.zTree.getZTreeObj("dataSets").removeNode(t), layer.alert("删除成功!")
    }, function (e) {
        layer.close(e)
    }), !1
}

function addHoverDomForSets(e, t) {
    if (1 != t.level) return removeSql(), !1;
    showSql(t);
    var a = $("#" + t.tId + "_span");
    if (!(t.editNameFlag || 0 < $("#" + t.tId + "_editBtn").length)) {
        var o = "<span class='button edit' id='" + t.tId + "_editBtn' title='修改' onfocus='this.blur();'></span>";
        a.after(o);
        var n = $("#" + t.tId + "_editBtn");
        n && n.bind("click", function () {
            return addDataSets(t), !1
        })
    }
}

function removeHoverDomForSets(e, t) {
    if (removeSql(t), 1 != t.level) return !1;
    $("#" + t.tId + "_editBtn").unbind().remove()
}

function addParmItem(e) {
    var t = $('<div class="parm-item"><select></select><div class="btn-group"><i class="icon icon-insert"onclick="addParmItem(this);">+</i><i class="icon icon-del"onclick="delParmItem(this)">-</i></div></div>'),
        a = $.fn.zTree.getZTreeObj("dataParms").getNodesByParam("level", "1", null), o = t.find("select");
    ($.each(a, function (e, t) {
        o.append('<option value="' + t.parmName + '">' + t.parmCName + "</option>")
    }), e) ? $(e).parents(".parm-item").after(t) : tempLayeroForSets.find(".parm-list").append(t)
}

function addParmItemForEdit(n, e) {
    var t = $.fn.zTree.getZTreeObj("dataParms").getNodesByParam("level", "1", null), r = "";
    $.each(t, function (e, t) {
        r += "<option value='" + t.parmName + "'>" + (t.parmCName || t.parmName) + "</option>"
    });
    var a = $.fn.zTree.getZTreeObj("dataSets").getNodesByParam("type", "parms", e)[0].children;
    a && 0 < a.length && $.each(a, function (e, t) {
        var a = $('<div class="parm-item"><select></select><div class="btn-group"><i class="icon icon-insert"onclick="addParmItem(this);">+</i><i class="icon icon-del"onclick="delParmItem(this)">-</i></div></div>'),
            o = a.find("select");
        o.append(r), o.val(t.parmName), n.find(".parm-list").append(a)
    })
}

function delParmItem(e) {
    $(e).parents(".parm-item").remove()
}

function showSql(e) {
    var t = sqlFormatter.format(e.commandText), a = new RegExp("\n|\r\n", "g"),
        o = t.replace(a, "</br>").replace(/\s/g, "&nbsp;&nbsp;");
    $(".showsql").unbind().remove();
    var n = $('<div class="showsql" id="' + e.tId + '_showsql"></div>'), r = $("#" + e.tId + "_a"),
        l = rdpConfig.getConfigParm("dataSet");
    n.append("&nbsp;&nbsp;&nbsp;&nbsp;" + o), hljs.configure({useBR: !0, languages: ["sql"]}), n.each(function (e, t) {
        hljs.highlightBlock(t)
    }), n.appendTo("body"), "left" == l ? n.css({
        "min-width": "200px",
        "min-height": "200px",
        top: "10px",
        right: "410px",
        position: "absolute",
        border: "1px solid #b4b4b4",
        "border-radius": "5px",
        "z-index": 999
    }) : (n.css({
        "min-width": "200px",
        "min-height": "200px",
        left: r.offset().left + "px",
        position: "absolute",
        border: "1px solid #b4b4b4",
        "border-radius": "5px",
        "z-index": 999
    }), n.css("top", r.offset().top - n.outerHeight(!0) + "px")), n.bind("click", function () {
        return !1
    })
}

function removeSql(e) {
    $(".showsql").remove()
}

function addDataSets(o) {
    layer.open({
        type: 1, area: ["640px", "480px"], title: "数据集配置", content: $("#dataSetsInfo"), cancel: function () {
        }, success: function (a, e) {
            (tempLayeroForSets = a).find("#DataSourceName").empty(), a.find("#DataSourceName").append('<option value=""></option><option value="javabean">javabean</option>'), $.rdp.ajax({
                url: "../../getDataSourceNameAll.action",
                type: "post",
                async: !1,
                success: function (e) {
                    for (var t = 0; t < e.length; t++) a.find("#DataSourceName").append("<option value='" + e[t].dataSourceName + "'>" + e[t].dataSourceName + "</option>")
                }
            }), a.find("#DataSourceName").bind("change", function () {
                "javabean" == $(this).val() ? ($(a).find("#ddslist").hide(), $(a).find("#jblist").show()) : ($(a).find("#ddslist").show(), $(a).find("#jblist").hide())
            }), a.find(".formatterBtn").bind("click", function () {
                var e = tempLayeroForSets.find("#CommandText").val(), t = sqlFormatter.format(e);
                tempLayeroForSets.find("#CommandText").val(t)
            }), a.find(".parm-list").empty(), o ? (setDomAllVals(a[0], o), addParmItemForEdit(a, o)) : setDomAllVals(a[0], {isvalid: !0}), "javabean" == a.find("#DataSourceName").val() ? ($(a).find("#ddslist").hide(), $(a).find("#jblist").show(), a.find("#FactoryClass").val(o.commandText)) : ($(a).find("#ddslist").show(), $(a).find("#jblist").hide())
        }, end: function () {
            tempLayeroForSets = null
        }, btn: ["保存", "取消"], yes: function (e, t) {
            (o ? editSetsNode(t, o) : addSetsNode(t)) && layer.close(e)
        }, btn2: function (e, t) {
            layer.close(e)
        }
    })
}

function addSetsNode(e) {
    var t, a = getDomAllVals(e.find(".form-info")[0]), o = a.dataSetName, n = a.dataSourceName, r = !0;
    if ("" == n) return window.top.layer.tips("请选择数据源", $(e).find("#DataSourceName"), {tipsMore: !0}), !1;
    if ("" == o) return window.top.layer.tips("数据集名称不能为空", $(e).find("#DataSetName"), {tipsMore: !0}), !1;
    if ("javabean" == n && (a.commandText = a.factoryClass), (a.dic || a.isvalid || "javabean" == n) && $.rdp.ajax({
        url: "../../parFieldsForJSON.action",
        type: "post",
        async: !1,
        data: {dataSourceName: a.dataSourceName, dataSetType: a.dataSetType, value: a.commandText},
        success: function (e) {
            e.flag ? (t = e.list, layer.msg("校验通过，保存成功", {time: 2e3})) : (layer.tips("sql错误", $(tempLayeroForSets).find("#CommandText"), {tipsMore: !0}), layer.closeAll("loading"), r = !1)
        },
        error: function () {
            layer.tips("sql错误", $(tempLayeroForSets).find("#CommandText"), {tipsMore: !0}), layer.closeAll("loading"), r = !1
        },
        beforeSend: function () {
            layer.load(1, {shade: [.1, "#fff"]})
        },
        complete: function () {
            layer.closeAll("loading")
        }
    }), r) {
        var l = $.fn.zTree.getZTreeObj("dataSets"), i = l.getNodes(), s = $.extend(!0, {}, a);
        s.name = a.dataSetName, s = l.addNodes(i[0], s);
        var d = {name: "字段", type: "field", open: !1}, c = {name: "参数", type: "parms", open: !1};
        d = l.addNodes(s[0], d), c = l.addNodes(s[0], c);
        var u = getParmListVals(e.find(".parm-list")[0]);
        if (l.addNodes(c[0], u), t && 0 < t.length) {
            var p = [];
            $.each(t, function (e, t) {
                var a = t;
                a.columnComments ? a.name = a.columnComments : a.name = a.columnName, p.push(a)
            }), l.addNodes(d[0], p)
        } else l.addNodes(d[0], []);
        a.dic && settingDic(d[0])
    }
    return r
}

function editSetsNode(e, a) {
    var n, r = $.fn.zTree.getZTreeObj("dataSets"), l = getDomAllVals(e.find(".form-info")[0]), i = !0,
        t = l.dataSetName, o = l.dataSourceName;
    if ("" == o) return window.top.layer.tips("请选择数据源", $(layero).find("#DataSourceName"), {tipsMore: !0}), !1;
    if ("" == t) return window.top.layer.tips("数据集名称不能为空", $(layero).find("#DataSetName"), {tipsMore: !0}), !1;
    if ("javabean" == o && (l.commandText = l.factoryClass), (a = $.extend(!0, a, l)).name = l.dataSetName, r.updateNode(a), (l.dic || l.isvalid || "javabean" == o) && $.rdp.ajax({
        url: "../../parFieldsForJSON.action",
        type: "post",
        async: !1,
        data: {dataSourceName: l.dataSourceName, dataSetType: l.dataSetType, value: l.commandText},
        success: function (e) {
            if (e.flag) {
                n = e.list;
                var t = r.getNodesByParam("type", "field", a);
                if (r.removeChildNodes(t[0]), n && 0 < n.length) {
                    var o = [];
                    $.each(n, function (e, t) {
                        var a = t;
                        a.columnComments ? a.name = a.columnComments : a.name = a.columnName, o.push(a)
                    }), r.addNodes(t[0], o)
                } else r.addNodes(t[0], []);
                l.dic && settingDic(t[0]), layer.msg("校验通过，保存成功", {time: 2e3})
            } else layer.tips("sql错误", $(tempLayeroForSets).find("#CommandText"), {tipsMore: !0}), i = !1
        },
        error: function () {
            layer.tips("sql错误", $(tempLayeroForSets).find("#CommandText"), {tipsMore: !0}), i = !1
        },
        beforeSend: function () {
            layer.load(1, {shade: [.1, "#fff"]})
        },
        complete: function () {
            layer.closeAll("loading")
        }
    }), i) {
        var s = r.getNodesByParam("type", "parms", a);
        r.removeChildNodes(s[0]);
        var d = getParmListVals(e.find(".parm-list")[0]);
        r.addNodes(s[0], d)
    }
    return i
}

function getParmListVals(e) {
    for (var t = [], a = e.getElementsByTagName("SELECT"), o = 0; o < a.length; o++) {
        var n = {}, r = a[o].selectedIndex, l = "";
        a[o].options[r] && (l = a[o].options[r].text), n.name = l, n.parmCName = l, n.parmName = a[o].value, t.push(n)
    }
    return t
}

function settingDic(n) {
    layer.open({
        type: 1, area: ["540px", "164px"], title: "数据集字典项配置", content: $("#dataSetsDic"), cancel: function () {
        }, success: function (e, t) {
            e.find("#dicType").empty(), e.find("#dicID").empty(), e.find("#dicText").empty(), e.find("#dicType").append('<option value="">请选择字典类型</option>'), e.find("#dicID").append('<option value="">请选择字段名称</option>'), e.find("#dicText").append('<option value="">请选择值名称</option>');
            var a = n.children;
            $.each(a, function (e, t) {
                $("#dicType").append('<option value="' + t.columnName + '">' + t.columnName + "</option>"), $("#dicID").append('<option value="' + t.columnName + '">' + t.columnName + "</option>"), $("#dicText").append('<option value="' + t.columnName + '">' + t.columnName + "</option>")
            });
            var o = n.getParentNode();
            e.find("#dicType").val(o.keyName), e.find("#dicText").val(o.optName), e.find("#dicID").val(o.optCode)
        }, end: function () {
        }, btn: ["保存", "取消"], yes: function (e, t) {
            var a = $.fn.zTree.getZTreeObj("dataSets"), o = n.getParentNode();
            o.keyName = t.find("#dicType").val(), o.optName = t.find("#dicText").val(), o.optCode = t.find("#dicID").val(), a.updateNode(o), layer.close(e)
        }, btn2: function (e, t) {
            layer.close(e)
        }
    })
}

var tempOverlapping, imageActionName = "";

function importImage() {
    var e = hot.Methods.getSelected();
    if (e) {
        var t = e[0];
        hot.Methods.getCellMeta(t[0], t[1]);
        imageActionName = "importImage", $("#importImage").click()
    }
}

function addImage() {
    hot.Methods.getSelected() && (imageActionName = "addImage", $("#importImage").click())
}

function delImage() {
    var e = $(".cell-img.curr-img");
    0 < e.length && (hot.Methods.getCellMeta(e.data("r"), e.data("c")).image[e.data("index")] = {}, e.unbind().remove())
}

function clearImage() {
    var e = hot.Methods.getSelected();
    if (e) {
        var t = e[0], a = hot.Methods.getCell(t[0], t[1]);
        hot.Methods.setCellMeta(t[0], t[1], "bgimage", ""), a.style.backgroundImage = ""
    }
}

function getImg() {
    var n = new FileReader, e = $("#importImage")[0].files[0];
    e && (n.readAsDataURL(e), n.onload = function (e) {
        if (105e4 < n.result.length) layer.msg("上传失败，请上传不大于1M的图片！"); else {
            var t = hot.Methods.getSelected();
            if (t) {
                var a = t[0], o = hot.Methods.getCell(a[0], a[1]);
                hot.Methods.setCellMeta(a[0], a[1], "image", n.result), o.style.backgroundImage = 'url("' + n.result + '")', o.style.backgroundRepeat = "no-repeat"
            }
        }
    })
}

function setOverlapping() {
    var e = hot.Methods.getSelected(), n = {};
    if (e) {
        var r = e[0], l = hot.Methods.getCellMeta(r[0], r[1]), a = hot.Methods.getCell(r[0], r[1]);
        n = l.overlapping || {}, layer.open({
            type: 1, area: ["700px", "410px"], title: "交叉表头配置", content: $("#overlapping"), cancel: function () {
            }, success: function (e, t) {
                (tempOverlapping = e).find("#view-border").width($(a).outerWidth()).height($(a).outerHeight() - 1), e.find("#lineHeight").val($(a).outerHeight() - 1), e.find("#lineWidth").val($(a).outerWidth()), e.find("#view-td").css("background-image", "").empty(), e.find("#line").val(0), e.find("#overlap-items").empty(), e.find("#lineHeight").bind("input propertychange", function () {
                    e.find("#view-border").height($(this).val())
                }), e.find("#lineWidth").bind("input propertychange", function () {
                    e.find("#view-border").width($(this).val())
                }), e.find("#line").bind("change", function () {
                    createItmes($(this).val())
                }), e.find("#viewOverlap").bind("click", function () {
                    createViewLine()
                }), e.find("#overlapping-fontsize").bind("change input", function () {
                    $(".overlap-node").css("font-size", this.value + "px")
                }), e.find(".overlapping-color").spectrum({
                    showInput: !0,
                    allowEmpty: !0,
                    showAlpha: !0,
                    cancelText: "取消",
                    chooseText: "确认",
                    togglePaletteMoreText: "更多",
                    togglePaletteLessText: "简略",
                    change: function (e) {
                        if ("overlapping-bgcolor" == this.id) $("#view-td").css("background-color", e.toRgbaString()); else if ("overlapping-fontcolor" == this.id) $(".overlap-node").css("color", e.toRgbString()); else if ("overlapping-linecolor" == this.id) {
                            line(tempOverlapping.find("#view-td")[0], 1, e.toRgbaString(), $("#line").val())
                        }
                    },
                    show: function (e) {
                    },
                    move: function (e) {
                    }
                }), initOverlapping(n, e)
            }, end: function () {
            }, btn: ["保存", "取消"], yes: function (t, a) {
                var o = tempOverlapping.find("#view-td");
                html2canvas(o[0]).then(function (e) {
                    n.base64 = e.toDataURL(), n.nodes = [], o.find(".overlap-node").each(function () {
                        var e = {};
                        e.top = $(this).css("top"), e.left = $(this).css("left"), e.value = $(this).text(), n.nodes.push(e)
                    }), l.overlapping = n, hot.Methods.setCellMetaObject(r[0], r[1], l), TableData.rowHeights[r[0]] = Number(a.find("#lineHeight").val()), TableData.colWidths[r[1]] = Number(a.find("#lineWidth").val()), hot.Methods.disablePlugin(), tb_updateSettings(), hot.Methods.enablePlugin(), layer.close(t)
                })
            }, btn2: function (e, t) {
                layer.close(e)
            }
        })
    }
}

function clearoverlapping() {
    var e = hot.Methods.getSelected();
    if (e) {
        var t = e[0], a = hot.Methods.getCell(t[0], t[1]);
        delete hot.Methods.getCellMeta(t[0], t[1]).overlapping, a.style.backgroundImage = ""
    }
}

function initOverlapping(e, t) {
    var a = e.nodes;
    a && 1 < a.length && (t.find("#line").val(a.length - 1), createItmes(a.length - 1, a), createViewLine(a))
}

function createItmes(e, t) {
    var a = tempOverlapping.find("#overlap-items");
    a.empty();
    for (var o = 0; o < Number(e) + 1; o++) if (t) {
        var n = $('<div class="linenames-div"><input type="text" value="' + t[o].value + '" name="linenames" placeholder="请输入第' + (o + 1) + '个参数" /></div>');
        a.append(n)
    } else {
        n = $('<div class="linenames-div"><input type="text" name="linenames" placeholder="请输入第' + (o + 1) + '个参数" /></div>');
        a.append(n)
    }
}

function createViewLine(e) {
    var t = tempOverlapping.find("#view-td"), a = $("#overlapping-linecolor").spectrum("get").toRgbaString();
    if (e) line(t[0], 1, a, e.length - 1), addLabels(t, e); else {
        var o = tempOverlapping.find(".linenames-div"), n = [];
        $.each(o, function () {
            var e = {};
            e.value = $(this).find("[name=linenames]").val(), n.push(e)
        }), line(t[0], 1, a, o.length - 1), addLabels(t, n)
    }
}

function addLabels(o, e) {
    o.empty(), $.each(e, function (e, t) {
        var a = $('<label class="overlap-node">' + t.value + "</label>");
        a.appendTo(o), a.myDrag({
            randomPosition: !1,
            direction: "all",
            handler: !1,
            elem: o
        }), t.top && a.css("top", t.top), t.left && a.css("left", t.left), a.css("color", $("#overlapping-fontcolor").spectrum("get").toRgbString()), a.css("font-size", $("#overlapping-fontsize").val() + "px")
    })
}

function createLine(e, t, a) {
    if (!e && 0 <= t & 0 <= a) {
        e = hot.Methods.getCellMeta(t, a).overlapping;
        var o = hot.Methods.getCell(t, a, !1);
        e.base64 = line(o, 1, "#000000", e.val), hot.Methods.setCellMeta(t, a, "overlapping", e)
    } else {
        var n = hot.Methods.getSelected();
        if (n) {
            var r = n[0];
            hot.Methods.getCellMeta(r[0], r[1]), o = hot.Methods.getCell(r[0], r[1], !1);
            e.base64 = line(o, 1, "#000000", e.val), hot.Methods.setCellMeta(r[0], r[1], "overlapping", e), TableData.overlapping[r[0]] || (TableData.overlapping[r[0]] = []), TableData.overlapping[r[0]][r[1]] = e.val
        }
    }
}

function line(e, t, a, o) {
    var n = e.clientWidth, r = e.clientHeight, l = document.createElement("CANVAS");
    l.width = n, l.height = r;
    var i = l.getContext("2d");
    switch (i.clearRect(0, 0, n, r), i.fill(), i.lineWidth = t, i.strokeStyle = a, i.beginPath(), Number(o)) {
        case 1:
            i.moveTo(0, 0), i.lineTo(n, r);
            break;
        case 2:
            i.moveTo(0, 0), i.lineTo(n / 2, r), i.moveTo(0, 0), i.lineTo(n, r / 2);
            break;
        case 3:
            i.moveTo(0, 0), i.lineTo(n, r), i.moveTo(0, 0), i.lineTo(n / 2, r), i.moveTo(0, 0), i.lineTo(n, r / 2);
            break;
        default:
            return 0
    }
    i.stroke(), i.closePath();
    var s = i.canvas.toDataURL();
    return e.style.backgroundImage = 'url("' + s + '")', e.style.backgroundRepeat = "no-repeat", $(l).remove(), s
}

var hot, cPushArray = new Array, cStep = -1;

function cPush(e) {
    "init" == e && (tableInitFlag = !0), tableInitFlag && (++cStep < cPushArray.length && (cPushArray.length = cStep), cPushArray.push(getTabelData(!0)))
}

function cUndo() {
    tableInitFlag = !1, 0 < cStep && loadCellData(cPushArray[--cStep]), tableInitFlag = !0
}

function cRedo() {
    tableInitFlag = !1, cStep < cPushArray.length - 1 && loadCellData(cPushArray[++cStep]), tableInitFlag = !0
}

$(function () {
    var t = WebUploader.create({
        swf: "common/lib/webuploader/Uploader.swf",
        server: "../../importExcelAction.action",
        pick: "#fileupload",
        resize: !1,
        auto: !0,
        threads: 1,
        accept: {
            title: "Excel",
            extensions: "xls,xlsx",
            mimeTypes: "application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
        },
        fileVal: "filedata",
        fileNumLimit: 1
    });
    t.on("beforeFileQueued", function (e) {
        $(".progress-bg").find(".progress-line").css("width", "0px")
    }), t.on("fileQueued", function (e) {
        $(".progress-bg").show()
    }), t.on("fileDequeued", function (e) {
    }), t.on("reset", function () {
    }), t.on("startUpload", function () {
    }), t.on("stopUpload", function () {
    }), t.on("uploadFinished", function (e) {
        t.reset()
    }), t.on("uploadStart", function (e) {
    }), t.on("uploadAccept", function (e, t) {
    }), t.on("uploadProgress", function (e, t) {
        $(".progress-bg").find(".progress-line").stop().animate({width: 100 * t + "%"})
    }), t.on("uploadError", function (e, t) {
        layer.msg("导入失败")
    }), t.on("uploadSuccess", function (e, t) {
        layer.msg("导入成功"), loadData(t.data)
    }), t.on("uploadComplete", function (e) {
        $(".progress-bg").hide()
    }), t.on("error", function (e) {
    })
});
var selectedCell, tempStyle, tempTableData, uuid = "", tableInitFlag = !1, TableData = {
    mergeCells: [],
    colWidths: [],
    rowHeights: [],
    rowCategory: {},
    overlapping: [],
    toolbar: "top",
    page: 10,
    pageorder: 1,
    maxR: 0,
    maxC: 0,
    skinType: 0,
    uuid: "",
    reportStyle: "D",
    reportDescription: "",
    reportVersion: "1.0",
    reportMemo: "",
    mainUuid: ""
};

function initRowType(e, t) {
    var a = $(".ht_clone_left .wtHolder table.htCore tbody tr"), o = function (e, t) {
        a.eq(e).find("th a.rowtype").remove(), a.eq(e).find("th").append('<a class="rowtype rowtype_' + t + '"></a>')
    };
    null != e && void 0 !== e && "" != e ? o(e, t) : $.each(TableData.row, function (e, t) {
        o(e, t.rowCategory)
    })
}

function init() {
    $.fn.zTree.init($("#dataSets"), settingForSets, zNodesForSets), $.fn.zTree.init($("#dataParms"), settingForParms, zNodesForParms);
    $.fn.zTree.init($("#dataExpertree"), dataExprSetting, dataExprZNodes);
    $("#czz input").click(function () {
        filld(" " + $(this).val() + " ")
    })
}

function initColWidthAndHeight() {
    for (var e = hot.Methods.countCols() - 1, t = [], a = 0; a <= e; a++) t.push(hot.Methods.getColWidth(a));
    TableData.colWidths = t;
    var o = hot.Methods.countRows() - 1, n = [];
    for (a = 0; a <= o; a++) n.push(hot.Methods.getRowHeight(a));
    TableData.rowHeights = n
}

function getTabelData(e) {
    e || hot.Methods.deselectCell();
    for (var t = 0, a = 0, o = hot.Methods.getSourceData(0, 0, hot.Methods.countRows() - 1, hot.Methods.countCols() - 1), n = 0; n < o.length; n++) for (var r = 0; r < o[n].length; r++) o[n][r] && (t = t < n ? n : t, a = a < r ? r : a);
    TableData.mergeCells = getMergeCells(TableData);
    var l = TableData.mergeCells;
    for (n = 0; n < l.length; n++) {
        t = (i = (p = l[n]).row + p.rowspan - 1) < t ? t : i, a = (s = p.col + p.colspan - 1) < a ? a : s
    }
    TableData.maxR = t, TableData.maxC = a, TableData.skinType = $("#skinType").val(), TableData.row = [];
    for (n = 0; n <= t; n++) {
        var i = {col: []};
        for (r = 0; r <= a; r++) {
            var s, d = hot.Methods.getCellMeta(n, r), c = d.value;
            (s = {}).value = c, s.width = hot.Methods.getColWidth(r), s.colwidth = getTDWidth(n, r, l), s.height = hot.Methods.getRowHeight(n), s.col = d.col, s.row = d.row, s.exptext = d.exptext, s.ds = d.ds, s.frameid = d.frameid, s.link = d.link, s.columnType = d.columnType, s.columnName = d.columnName, s.dic = d.dic, s.image = d.image, s.bgimage = d.bgimage, s.overlapping = d.overlapping, s.warnings = d.warnings, s.style = $.extend(!0, {font_family: "SimSun"}, d.style), s.style.font_family && "null" != s.style.font_family || (s.style.font_family = "SimSun"), s.style.font_size && "null" != s.style.font_size || (s.style.font_size = "12px"), s.className = d.className, i.col.push(s), TableData.colWidths[r] = hot.Methods.getColWidth(r), TableData.rowHeights[n] = hot.Methods.getRowHeight(n)
        }
        var u = hot.Methods.getCellMeta(n, 0);
        i.rowCategory = u.rowCategory ? u.rowCategory : "reporthead", TableData.row.push(i)
    }
    for (n = 0; n < l.length; n++) {
        var p = l[n];
        TableData.row[p.row].rowspan = p.rowspan, TableData.row[p.row].col[p.col].rowspan = p.rowspan, TableData.row[p.row].col[p.col].colspan = p.colspan
    }
    var f = $.fn.zTree.getZTreeObj("dataSets"), g = f.transformTozTreeNodes(f.getNodes());
    getDataSetsNodesVal(g);
    var m = $.fn.zTree.getZTreeObj("dataParms"), h = m.transformTozTreeNodes(m.getNodes());
    return TableData.dataSets = getDataSetsNodesVal(g), TableData.dataParms = getDataParmsNodesVal(h), tempTableData = $.extend(!0, {}, TableData)
}

function tb_modif() {
    getTabelData(), uuid && "null" != uuid ? (tempTableData = $.extend(!0, {}, TableData), $.rdp.ajax({
        url: "../../saveReport.action",
        data: {report: JSON.stringify(tempTableData)},
        type: "post",
        success: function (e) {
            layer.msg(e.msg)
        }
    })) : layer.prompt({title: "请输入报表名称"}, function (n, e, t) {
        null != n && "" != n && layer.prompt({value: n, title: "请输入简要的描述"}, function (e, t, a) {
            if (null != e && "" != e) {
                var o = guid();
                uuid = o, TableData.uuid = o, TableData.mainUuid = o, TableData.reportDescription = n, TableData.reportMemo = e, TableData.reportVersion = "1.0", TableData.reportStyle = "D", TableData.fileName = o + ".xml", tempTableData = $.extend(!0, {}, TableData), $.rdp.ajax({
                    url: "../../saveReport.action",
                    data: {report: JSON.stringify(tempTableData)},
                    type: "post",
                    success: function (e) {
                        layer.msg(e.msg);
                        history.pushState({}, n, "Main_D_V2.jsp?uuid=" + uuid), $("#reportTitle").html(n)
                    }
                })
            }
            layer.close(t)
        }), layer.close(e)
    })
}

function tb_save() {
    getTabelData(), layer.prompt({title: "请输入报表名称"}, function (n, e, t) {
        null != n && "" != n && layer.prompt({value: n, title: "请输入简要的描述"}, function (e, t, a) {
            if (null != e && "" != e) {
                var o = guid();
                uuid = o, TableData.uuid = o, TableData.mainUuid = o, TableData.reportDescription = n, TableData.reportMemo = e, TableData.reportVersion = "1.0", TableData.reportStyle = "D", TableData.fileName = o + ".xml", tempTableData = $.extend(!0, {}, TableData), $.rdp.ajax({
                    url: "../../saveReport.action",
                    data: {report: JSON.stringify(tempTableData)},
                    type: "post",
                    success: function (e) {
                        layer.msg(e.msg);
                        history.pushState({}, n, "Main_D_V2.jsp?uuid=" + uuid), $("#reportTitle").html(n)
                    }
                })
            }
            layer.close(t)
        }), layer.close(e)
    })
}

function tb_view() {
    window.open("designPreview.jsp?reporttype=D", "left=0,top=0,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 50) + ",toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")
}

function tb_upload() {
    layer.msg("导入"), $("#uploadCells").click()
}

function tb_paste() {
}

function tb_copy() {
}

function tb_cut() {
}

function tb_fontfamily() {
}

function tb_merge() {
    selectedCell = hot.Methods.getSelected(), hot.Methods.mergeSelection()
}

function tb_split() {
    selectedCell = hot.Methods.getSelected(), hot.Methods.unmergeSelection()
}

function tb_wrap() {
    var e = getRange(hot.Methods.getSelected());
    if (e) {
        hot.Methods.deselectCell();
        for (var t = e, a = t[0]; a <= t[2]; a++) for (var o = t[1]; o <= t[3]; o++) {
            var n = hot.Methods.getCellMeta(a, o).style || {}, r = hot.Methods.getCell(a, o);
            n.white_space && "normal" == n.white_space ? (delete n.white_space, $(r).css("white-space", ""), $(".toolbars .group .tag-btn.wrap-btn").removeClass("on")) : (n.white_space = "normal", $(r).css("white_space", "normal"), $(".toolbars .group .tag-btn.wrap-btn").addClass("on")), hot.Methods.setCellMeta(a, o, "style", n)
        }
        hot.Methods.selectCell(t[0], t[1], t[2], t[3])
    }
}

function tb_category(e) {
    var t = hot.Methods.getSelectedRange();
    if (t) for (var a = t[0], o = a.from, n = a.to, r = o.row < n.row ? o.row : n.row, l = o.row > n.row ? o.row : n.row, i = r; i <= l; i++) console.log(e.value), hot.Methods.setCellMeta(i, 0, "rowCategory", e.value), initRowType(i, e.value)
}

function tb_toolbarpos(e) {
    TableData.toolbar = e.value
}

function tb_frame() {
}

function tb_exp() {
}

function tb_width(e) {
    var t = hot.Methods.getSelected();
    t && (hot.Methods.disablePlugin(), TableData.colWidths[t[0][1]] = Number(e), tb_updateSettings(), hot.Methods.enablePlugin())
}

function tb_height(e) {
    var t = hot.Methods.getSelected();
    t && (hot.Methods.disablePlugin(), TableData.rowHeights[t[0][0]] = Number(e), tb_updateSettings(), hot.Methods.enablePlugin())
}

function tb_updateSettings() {
    var e = getMergeCells(TableData);
    TableData.mergeCells = [], hot.Methods.updateSettings({
        rowHeights: TableData.rowHeights,
        colWidths: TableData.colWidths,
        mergeCells: e
    }), hot.Methods.render()
}

function tb_orientation(e) {
    TableData.pageorder = $(e).val()
}

function tb_paging(e) {
    TableData.page = $(e).val()
}

function tb_cellval(e) {
    var t = hot.Methods.getSelected();
    t && hot.Methods.setDataAtCell(t[0][0], t[0][1], e)
}

function tb_parmdic() {
}

function getRange(e) {
    var t = hot.Methods.getSelected();
    if (0 < e.length && t) {
        var a = e[0], o = t[0];
        if (a[0] != o[0] || a[1] != o[1]) return null;
        var n, r, l, i, s = [];
        return n = a[0] < a[2] ? a[0] : a[2], l = a[0] > a[2] ? a[0] : a[2], r = a[1] < a[3] ? a[1] : a[3], i = a[1] > a[3] ? a[1] : a[3], s.push(n), s.push(r), s.push(l), s.push(i), s
    }
    return null
}

function setCellval(e) {
    $("#cellval").val(e)
}

function getBgColor(e) {
    $("#bgColor").spectrum("set", e)
}

function getFontColor(e) {
    $("#fontColor").spectrum("set", e)
}

function setBgColor(e) {
    var t = getRange(selectedCell);
    if (t) {
        var a, o, n, r, l = t;
        a = l[0] < l[2] ? l[0] : l[2], n = l[0] > l[2] ? l[0] : l[2], o = l[1] < l[3] ? l[1] : l[3], r = l[1] > l[3] ? l[1] : l[3];
        for (var i = a; i <= n; i++) for (var s = o; s <= r; s++) {
            var d = hot.Methods.getCellMeta(i, s).style || {};
            d.background_color = e, hot.Methods.setCellMeta(i, s, "style", d);
            var c = hot.Methods.getCell(i, s);
            $(c).css("background-color", e)
        }
        cPush("setBgColor")
    }
}

function setFontColor(e) {
    var t = getRange(selectedCell);
    if (t) {
        for (var a = t, o = a[0]; o <= a[2]; o++) for (var n = a[1]; n <= a[3]; n++) {
            var r = hot.Methods.getCellMeta(o, n).style || {};
            r.color = e, hot.Methods.setCellMeta(o, n, "style", r);
            var l = hot.Methods.getCell(o, n);
            $(l).css("color", e)
        }
        cPush("setFontColor")
    }
}

function hotbeforeRenderer(e, t, a, o, n, r) {
    var l = r.style || {};
    r.className = "", $.each(l, function (e, t) {
        switch (e = e.replace(/_/g, "-")) {
            case"vertical-align":
                "middle" == t ? r.className += " htMiddle" : "top" == t ? r.className += " htTop" : "bottom" == t && (r.className += " htBottom");
                break;
            case"text-align":
                "center" == t ? r.className += " htCenter" : "left" == t ? r.className += " htLeft" : "right" == t && (r.className += " htRight")
        }
    })
}

function hotafterRenderer(a, e, t, o, n, r) {
    var l = r.style || {};
    $.each(l, function (e, t) {
        switch (e = e.replace(/_/g, "-")) {
            case"vertical-align":
            case"text-align":
                break;
            case"font-style":
                "italic" == t && $(a).addClass("italic");
                break;
            case"font-weight":
                "700" == t && $(a).addClass("bold");
                break;
            case"text-decoration":
                -1 < $.inArray("underline", l.text_decoration) && $(a).addClass("underline"), -1 < $.inArray("strike", l.text_decoration) && $(a).addClass("strike"), -1 < $.inArray("underline", l.text_decoration) && -1 < $.inArray("strike", l.text_decoration) && $(a).addClass("strike-underline");
                break;
            default:
                $(a).css(e, t)
        }
    });
    var i = r.overlapping;
    i && i.base64 && (a.style.backgroundImage = 'url("' + i.base64 + '")', a.style.backgroundRepeat = "no-repeat");
    var s = r.bgimage;
    s && (a.style.backgroundImage = 'url("' + s + '")', a.style.backgroundRepeat = "no-repeat")
}

function hotafterColumnResize(e, t, a) {
    $.each(TableData.overlapping, function (a, e) {
        e && $.each(e, function (e, t) {
            t && createLine(null, a, e)
        })
    })
}

function hotafterRowResize(e, t, a) {
    $.each(TableData.overlapping, function (a, e) {
        e && $.each(e, function (e, t) {
            t && createLine(null, a, e)
        })
    })
}

function hotafterSelection(e, t, a, o, n, r) {
    var l = hot.Methods.getCellMeta(e, t);
    l.exptext ? (setCellval(l.exptext), $("#exptext").val(l.exptext.replace(/&gt;/g, ">").replace(/&lt;/g, "<").replace(/&amp;/g, "&"))) : (setCellval(l.value), $("#exptext").val(""));
    var i = l.style || {}, s = (l.className || "").split(" ");
    $(".toolbars .group .tag-btn").removeClass("on");
    for (var d = 0; d < s.length; d++) $(".btn-" + s[d]).addClass("on");
    $("#fontfamily").val(""), $("#fontsize").val("12px").trigger("change"), $.each(i, function (e, t) {
        switch (e = e.replace(/_/g, "-")) {
            case"vertical-align":
            case"text-align":
                break;
            case"font-family":
                $("#fontfamily").val(t);
                break;
            case"white-space":
                "normal" == t && $(".toolbars .group .tag-btn.wrap-btn").addClass("on");
                break;
            case"font-size":
                $("#fontsize").val(t).trigger("change");
                break;
            case"font-style":
                "italic" == t && $(".toolbars .group .tag-btn.btn-italic").addClass("on");
                break;
            case"font-weight":
                "700" == t && $(".toolbars .group .tag-btn.btn-bold").addClass("on");
                break;
            case"text-decoration":
                -1 < $.inArray("underline", i.text_decoration) && $(".toolbars .group .tag-btn.btn-underline").addClass("on"), -1 < $.inArray("strike", i.text_decoration) && $(".toolbars .group .tag-btn.btn-strike").addClass("on");
                break;
            case"background-color":
                getBgColor(t);
                break;
            case"color":
                getFontColor(t)
        }
    });
    var c = hot.Methods.getColWidth(t);
    $("#cell-width").val(c);
    var u = hot.Methods.getRowHeight(e);
    $("#cell-height").val(u);
    hot.Methods.getCell(e, t, !0);
    var p = hot.Methods.getCellMeta(e, 0);
    $("#category").val(p.rowCategory), $("#parmdic").val(l.dic)
}

function contextMenuCallback(e, t) {
    switch (e) {
        case"alignment:left":
            setAlignmentH("htLeft");
            break;
        case"alignment:center":
            setAlignmentH("htCenter");
            break;
        case"alignment:right":
            setAlignmentH("htRight");
            break;
        case"alignment:top":
            setAlignmentV("htTop");
            break;
        case"alignment:middle":
            setAlignmentV("htMiddle");
            break;
        case"alignment:bottom":
            setAlignmentV("htBottom");
            break;
        case"hot:subreport":
            addSubReport();
            break;
        case"hot:removesubreport":
            removeReport();
            break;
        case"hot:link":
            addLink();
            break;
        case"hot:removelink":
            removeLink();
            break;
        case"hot:removeDataDic":
            removeDataDic();
            break;
        case"copyStyle":
            copyStyle();
            break;
        case"pasteStyle":
            pasteStyle();
            break;
        case"hot:overlapping":
            setOverlapping();
            break;
        case"hot:importimage":
            importImage();
            break;
        case"hot:clearimage":
            clearImage();
            break;
        case"hot:addImage":
            addImage();
            break;
        case"hot:clearoverlapping":
            clearoverlapping()
    }
}

function dataType(e) {
    return null === e ? "Null" : void 0 === e ? "Undefined" : Object.prototype.toString.call(e).slice(8, -1)
}

function dealObjectValue(e) {
    var t = {};
    if (null == e || "" === e) return t;
    for (var a in e) "Object" === dataType(e[a]) ? t[a] = dealObjectValue(e[a]) : null !== e[a] && void 0 !== e[a] && "" !== e[a] && (t[a] = e[a]);
    return t
}

function loadData(e) {
    if (!e) return console.info("数据为空"), !1;
    e = dealObjectValue(e), TableData = $.extend(!0, TableData, e), e.mergeCells && 0 != e.mergeCells.length || (TableData.mergeCells = []), $("#reportTitle").html(TableData.reportDescription);
    for (var t = e.row, a = [], o = 0; o < t.length; o++) {
        a[o] || (a[o] = []);
        for (var n = 0; n < t[o].col.length; n++) a[o][n] = t[o].col[n].value
    }
    0 < a.length && hot.Methods.loadData(a);
    for (o = 0; o < t.length; o++) {
        for (n = 0; n < t[o].col.length; n++) {
            var r = $.extend(!0, {}, t[o].col[n]);
            hot.Methods.setCellMetaObject(o, n, r);
            var l = r.image;
            l && cellCreateImage(l, o, n)
        }
        hot.Methods.setCellMeta(o, 0, "rowCategory", t[o].rowCategory)
    }
    hot.Methods.render(), tb_updateSettings(), $("#orientation").val(TableData.pageorder), $("#paging").val(TableData.page), $("#toolbarpos").val(TableData.toolbar), $("#skinType").val(TableData.skinType), e.dataSets && 0 < e.dataSets.length && $.fn.zTree.init($("#dataSets"), settingForSets, setDataSetsNodesVal(e.dataSets)), e.dataParms && 0 < e.dataParms.length && $.fn.zTree.init($("#dataParms"), settingForParms, setDataParmsNodesVal(e.dataParms)), initRowType()
}

function loadCellData(e) {
    if (!e) return console.info("数据为空"), !1;
    TableData = $.extend(!0, TableData, e), $("#reportTitle").html(TableData.reportDescription), hot.Methods.disablePlugin();
    for (var t = e.row, a = [], o = 0; o < t.length; o++) {
        a[o] || (a[o] = []);
        for (var n = 0; n < t[o].col.length; n++) a[o][n] = t[o].col[n].value
    }
    var r = getMergeCells(e);
    TableData.mergeCells = [], hot.Methods.loadData(a), hot.Methods.updateSettings({
        colWidths: e.colWidths,
        rowHeights: e.rowHeights,
        mergeCells: r
    });
    for (o = 0; o < t.length; o++) {
        for (n = 0; n < t[o].col.length; n++) {
            var l = $.extend(!0, {}, t[o].col[n]);
            hot.Methods.setCellMetaObject(o, n, l)
        }
        hot.Methods.setCellMeta(o, 0, "rowCategory", t[o].rowCategory)
    }
    hot.Methods.enablePlugin(), hot.Methods.render()
}

function mergeCells(e, t, a) {
    var o = TableData.mergeCells;
    if (t) o.push(a); else {
        for (var n = [], r = 0; r < o.length; r++) {
            var l = o[r];
            e.from.row == l.row && e.from.col == l.col && e.to.row == l.row + l.rowspan - 1 && e.to.col == l.col + l.colspan - 1 && n.push(r)
        }
        for (var i = n.length - 1; 0 <= i; i--) o.splice(n[i], 1)
    }
    cPush("mergeCells")
}

function getMergeCells(e) {
    var t = [], a = e.mergeCells;
    if (a) for (var o = 0; o < a.length; o++) 0 <= a[o].row && 0 <= a[o].col && (1 < a[o].colspan || 1 < a[o].rowspan) && t.push(a[o]);
    return t
}

function setFontFamily(e) {
    var t = e.value, a = hot.Methods.getSelected();
    if (a) {
        for (var o = a[0], n = o[0]; n <= o[2]; n++) for (var r = o[1]; r <= o[3]; r++) {
            var l = hot.Methods.getCellMeta(n, r).style || {}, i = hot.Methods.getCell(n, r);
            l.font_family = t, $(i).css("font-family", t), hot.Methods.setCellMeta(n, r, "style", l)
        }
        cPush("setFontFamily")
    }
}

function setFontSize(e) {
    var t = e, a = hot.Methods.getSelected();
    if (a) {
        for (var o = a[0], n = o[0]; n <= o[2]; n++) for (var r = o[1]; r <= o[3]; r++) {
            var l = hot.Methods.getCellMeta(n, r).style || {}, i = hot.Methods.getCell(n, r);
            l.font_size = t, $(i).css("font-size", t), hot.Methods.setCellMeta(n, r, "style", l)
        }
        cPush("setFontSize")
    }
}

function setFontStyle(e) {
    var t = hot.Methods.getSelected();
    if (t) {
        for (var a = t[0], o = a[0]; o <= a[2]; o++) for (var n = a[1]; n <= a[3]; n++) {
            var r = hot.Methods.getCellMeta(o, n).style || {}, l = hot.Methods.getCell(o, n);
            if ("italic" == e) r.font_style && "italic" == r.font_style ? (r.font_style = "normal", $(l).removeClass("italic"), $(".toolbars .group .tag-btn.btn-italic").removeClass("on")) : (r.font_style = "italic", $(l).addClass("italic"), $(".toolbars .group .tag-btn.btn-italic").addClass("on")); else if ("700" == e) r.font_weight && "700" == r.font_weight ? (r.font_weight = "normal", $(l).removeClass("bold"), $(".toolbars .group .tag-btn.btn-bold").removeClass("on")) : (r.font_weight = "700", $(l).addClass("bold"), $(".toolbars .group .tag-btn.btn-bold").addClass("on")); else if ("underline" == e) {
                if (r.text_decoration && -1 < $.inArray("underline", r.text_decoration)) {
                    var i = $.inArray("underline", r.text_decoration);
                    r.text_decoration.splice(i, 1), $(l).removeClass("underline"), $(".toolbars .group .tag-btn.btn-underline").removeClass("on")
                } else r.text_decoration || (r.text_decoration = []), r.text_decoration.push("underline"), $(l).addClass("underline"), $(".toolbars .group .tag-btn.btn-underline").addClass("on");
                -1 < $.inArray("underline", r.text_decoration) && -1 < $.inArray("strike", r.text_decoration) ? $(l).addClass("strike-underline") : $(l).removeClass("strike-underline")
            } else if ("strike" == e) {
                if (r.text_decoration && -1 < $.inArray("strike", r.text_decoration)) {
                    i = $.inArray("strike", r.text_decoration);
                    r.text_decoration.splice(i, 1), $(l).removeClass("strike"), $(".toolbars .group .tag-btn.btn-strike").removeClass("on")
                } else r.text_decoration || (r.text_decoration = []), r.text_decoration.push("strike"), $(l).addClass("strike"), $(".toolbars .group .tag-btn.btn-strike").addClass("on");
                -1 < $.inArray("underline", r.text_decoration) && -1 < $.inArray("strike", r.text_decoration) ? $(l).addClass("strike-underline") : $(l).removeClass("strike-underline")
            }
            hot.Methods.setCellMeta(o, n, "style", r)
        }
        cPush("setFontStyle")
    }
}

function setAlignmentV(e) {
    $(".btn-av").removeClass("on"), $(".btn-" + e).addClass("on");
    var t = hot.Methods.getSelected();
    if (t) {
        for (var a = getRange(t), o = a[0]; o <= a[2]; o++) for (var n = a[1]; n <= a[3]; n++) {
            var r = hot.Methods.getCellMeta(o, n), l = r.className || "", i = hot.Methods.getCell(o, n),
                s = r.style || {};
            switch ($(i).removeClass("htTop").removeClass("htMiddle").removeClass("htBottom"), l = l.replace(/htTop|htMiddle|htBottom/, ""), e) {
                case"htTop":
                    l += " htTop", $(i).addClass("htTop"), s.vertical_align = "top";
                    break;
                case"htMiddle":
                    l += " htMiddle", $(i).addClass("htMiddle"), s.vertical_align = "middle";
                    break;
                case"htBottom":
                    l += " htBottom", $(i).addClass("htBottom"), s.vertical_align = "bottom"
            }
            hot.Methods.setCellMeta(o, n, "className", l), hot.Methods.setCellMeta(o, n, "style", s)
        }
        cPush("setAlignmentV")
    }
}

function setAlignmentH(e) {
    $(".btn-ah").removeClass("on"), $(".btn-" + e).addClass("on");
    var t = hot.Methods.getSelected();
    if (t) {
        for (var a = getRange(t), o = a[0]; o <= a[2]; o++) for (var n = a[1]; n <= a[3]; n++) {
            var r = hot.Methods.getCellMeta(o, n), l = r.className || "", i = r.style || {},
                s = hot.Methods.getCell(o, n);
            switch ($(s).removeClass("htLeft").removeClass("htCenter").removeClass("htRight"), l = l.replace(/htLeft|htCenter|htRight/, ""), e) {
                case"htLeft":
                    l += " htLeft", $(s).addClass("htLeft"), i.text_align = "left";
                    break;
                case"htCenter":
                    l += " htCenter", $(s).addClass("htCenter"), i.text_align = "center";
                    break;
                case"htRight":
                    l += " htRight", $(s).addClass("htRight"), i.text_align = "right"
            }
            hot.Methods.setCellMeta(o, n, "className", l), hot.Methods.setCellMeta(o, n, "style", i)
        }
        cPush("setAlignmentH")
    }
}

function getDomAllVals(e) {
    for (var t = e.getElementsByTagName("INPUT"), a = e.getElementsByTagName("TEXTAREA"), o = e.getElementsByTagName("SELECT"), n = {}, r = 0; r < t.length; r++) t[r].name && ("checkbox" == t[r].type ? n[t[r].name] = t[r].checked : n[t[r].name] = t[r].value);
    for (r = 0; r < a.length; r++) a[r].name && (n[a[r].name] = a[r].value);
    for (r = 0; r < o.length; r++) o[r].name && (n[o[r].name] = o[r].value);
    return n
}

function setDomAllVals(a, e) {
    for (var t = a.getElementsByTagName("INPUT"), o = a.getElementsByTagName("TEXTAREA"), n = a.getElementsByTagName("SELECT"), r = 0; r < t.length; r++) t[r].name && ("checkbox" == t[r].type ? t[r].checked = !1 : t[r].value = "");
    for (r = 0; r < o.length; r++) o[r].name && (o[r].value = "");
    for (r = 0; r < n.length; r++) n[r].name && (n[r].value = "");
    e && $.each(e, function (e, t) {
        "checkbox" == $(a).find("[name=" + e + "]").attr("type") ? $(a).find("[name=" + e + "]")[0].checked = t : $(a).find("[name=" + e + "]").val(t)
    })
}

function setBorder(e) {
    var t = hot.Methods.getSelected();
    if (t) {
        var a = getRange(t);
        switch (e) {
            case"borderLeft":
                for (var o = a[0]; o <= a[2]; o++) {
                    (l = hot.Methods.getCellMeta(o, a[1]).style || {}).border_left = "1px solid rgb(0,0,0)", hot.Methods.setCellMeta(o, a[1], "style", l);
                    var n = hot.Methods.getCell(o, a[1]);
                    $(n).css("border-left", "1px solid rgb(0,0,0)")
                }
                break;
            case"borderRight":
                for (o = a[0]; o <= a[2]; o++) {
                    (l = hot.Methods.getCellMeta(o, a[3]).style || {}).border_right = "1px solid rgb(0,0,0)", hot.Methods.setCellMeta(o, a[3], "style", l);
                    n = hot.Methods.getCell(o, a[3]);
                    $(n).css("border-right", "1px solid rgb(0,0,0)")
                }
                break;
            case"borderTop":
                for (o = a[1]; o <= a[3]; o++) {
                    (l = hot.Methods.getCellMeta(a[0], o).style || {}).border_top = "1px solid rgb(0,0,0)", hot.Methods.setCellMeta(a[0], o, "style", l);
                    n = hot.Methods.getCell(a[0], o);
                    $(n).css("border-top", "1px solid rgb(0,0,0)")
                }
                break;
            case"borderBottom":
                for (o = a[1]; o <= a[3]; o++) {
                    (l = hot.Methods.getCellMeta(a[2], o).style || {}).border_bottom = "1px solid rgb(0,0,0)", hot.Methods.setCellMeta(a[2], o, "style", l);
                    n = hot.Methods.getCell(a[2], o);
                    $(n).css("border-bottom", "1px solid rgb(0,0,0)")
                }
                break;
            case"borderOut":
                setBorder("borderLeft"), setBorder("borderRight"), setBorder("borderTop"), setBorder("borderBottom");
                break;
            case"borderIn":
                setBorder("borderAll");
                break;
            case"borderAll":
                for (o = a[0]; o <= a[2]; o++) for (var r = a[1]; r <= a[3]; r++) {
                    (l = hot.Methods.getCellMeta(o, r).style || {}).border_top = "1px solid rgb(0,0,0)", l.border_bottom = "1px solid rgb(0,0,0)", l.border_left = "1px solid rgb(0,0,0)", l.border_right = "1px solid rgb(0,0,0)", hot.Methods.setCellMeta(o, r, "style", l);
                    n = hot.Methods.getCell(o, r);
                    $(n).css({
                        "border-top": "1px solid rgb(0,0,0)",
                        "border-bottom": "1px solid rgb(0,0,0)",
                        "border-left": "1px solid rgb(0,0,0)",
                        "border-right": "1px solid rgb(0,0,0)"
                    })
                }
                break;
            case"borderNode":
                for (o = a[0]; o <= a[2]; o++) for (r = a[1]; r <= a[3]; r++) {
                    var l;
                    delete (l = hot.Methods.getCellMeta(o, r).style || {}).border_top, delete l.border_bottom, delete l.border_left, delete l.border_right, hot.Methods.setCellMeta(o, r, "style", l);
                    n = hot.Methods.getCell(o, r);
                    $(n).css({"border-top": "", "border-bottom": "", "border-left": "", "border-right": ""})
                }
        }
    }
}

function copyStyle() {
    var e = hot.Methods.getSelected();
    if (e) {
        var t = e[0], a = hot.Methods.getCellMeta(t[0], t[1]);
        tempStyle = a.style
    }
}

function pasteStyle() {
    var e = hot.Methods.getSelected();
    if (e) for (var t = e[0], a = t[0]; a <= t[2]; a++) for (var o = t[1]; o <= t[3]; o++) hot.Methods.setCellMeta(a, o, "style", tempStyle);
    hot.Methods.render()
}

function getDataSetsNodesVal(e) {
    var a = [], t = e[0].children;
    return t && $.each(t, function (e, t) {
        var n = {};
        n.dic = t.dic, n.isvalid = t.isvalid, n.dataSourceName = t.dataSourceName, n.dataSetName = t.dataSetName, n.dataSetType = t.dataSetType, n.commandText = t.commandText, n.keyName = t.keyName, n.optCode = t.optCode, n.optName = t.optName, $.each(t.children, function (e, t) {
            if ("field" == t.type) {
                var a = t.children;
                n.field = [], $.each(a, function (e, t) {
                    var a = {};
                    a.columnComments = t.columnComments, a.columnName = t.columnName, a.columnType = t.columnType, n.field.push(a)
                })
            } else if ("parms" == t.type) {
                var o = t.children;
                n.parms = [], $.each(o, function (e, t) {
                    var a = {};
                    a.parmName = t.parmName, a.parmCName = t.parmCName, n.parms.push(a)
                })
            }
        }), a.push(n)
    }), a
}

function setDataSetsNodesVal(e) {
    var r = {name: "数据集列表", children: []};
    return $.each(e, function (e, t) {
        var a = {children: []};
        a.name = t.dataSetName, a.dic = t.dic, a.isvalid = t.isvalid, a.dataSourceName = t.dataSourceName, a.dataSetName = t.dataSetName, a.dataSetType = t.dataSetType, a.commandText = t.commandText, a.keyName = t.keyName, a.optCode = t.optCode, a.optName = t.optName;
        var o = {type: "field", name: "字段", children: []}, n = {type: "parms", name: "参数", children: []};
        $.each(t.field, function (e, t) {
            var a = {};
            a.columnComments = t.columnComments, a.columnName = t.columnName, a.columnType = t.columnType, a.name = t.columnComments ? t.columnComments : t.columnName, o.children.push(a)
        }), $.each(t.parms, function (e, t) {
            var a = {};
            a.parmName = t.parmName, a.parmCName = t.parmCName, a.name = t.parmCName ? t.parmCName : t.parmName, n.children.push(a)
        }), a.children.push(o), a.children.push(n), r.children.push(a)
    }), r
}

function getDataParmsNodesVal(e) {
    var o = [], t = e[0].children;
    return t && 0 < t.length && $.each(t, function (e, t) {
        var a = {};
        a.dbType = t.dbType, a.parmCName = t.parmCName, a.parmName = t.parmName, a.parmType = t.parmType, a.parmvl = t.parmvl, a.isnull = t.isnull, a.showType = t.showType, o.push(a)
    }), o
}

function setDataParmsNodesVal(e) {
    var o = {name: "参数列表", children: []};
    return $.each(e, function (e, t) {
        var a = {};
        a.dbType = t.dbType, a.parmCName = t.parmCName, a.parmName = t.parmName, a.parmType = t.parmType, a.parmvl = t.parmvl, a.isnull = t.isnull, a.showType = t.showType, a.name = t.parmCName ? t.parmCName : t.parmName, o.children.push(a)
    }), o
}

function getTableDataByUUID(e) {
    $.rdp.ajax({
        url: "../../selectReport.action", data: {uuid: e}, type: "post", success: function (e) {
            loadData(e.json), tableInitFlag = !0, cPush("getTableDataByUUID")
        }
    })
}

function pasteSetValue(e) {
    for (var t = 0; t < e.length; t++) hot.Methods.setCellMeta(e[t][0], e[t][1], "value", e[t][3])
}

function hotafterCreateRow(e, t, a) {
    if ("auto" != a) {
        for (var o = getMergeCells(TableData), n = 0; n < o.length; n++) o[n].row >= e && (o[n].row += t);
        TableData.rowHeights.splice(e, 0, 23), tb_updateSettings()
    }
}

function hotafterCreateCol(e, t, a) {
    if ("auto" != a) {
        for (var o = getMergeCells(TableData), n = 0; n < o.length; n++) o[n].col >= e && (o[n].col += t);
        TableData.colWidths.splice(e, 0, 100), tb_updateSettings()
    }
}

function hotafterRemoveRow(e, t) {
    for (var a = getTabelData(), o = a.mergeCells, n = 0; n < o.length; n++) o[n].row > e ? o[n].row -= t : o[n].row == e && (o[n].rowspan -= t);
    var r = a.row;
    r.length >= e && r.splice(e, 1);
    var l = a.rowHeights;
    l.length >= e && l.splice(e, 1), loadData(a)
}

function hotafterRemoveCol(e, t) {
    for (var a = getTabelData(), o = a.mergeCells, n = 0; n < o.length; n++) o[n].col > e ? o[n].col -= t : o[n].col == e && (o[n].colspan -= t);
    var r = a.row;
    for (n = 0; n < r.length; n++) {
        var l = r[n].col;
        l.length >= e && l.splice(e, 1)
    }
    var i = a.colWidths;
    i.length >= e && i.splice(e, 1), loadData(a)
}

function getQueryString(e) {
    var t = new RegExp("(^|&)" + e + "=([^&]*)(&|$)", "i"), a = window.location.search.substr(1).match(t);
    return null != a ? unescape(a[2]) : null
}

function getTDWidth(a, o, e) {
    var n, t = 0;
    if ($.each(e, function (e, t) {
        t.row == a && t.col == o && (n = t)
    }), n) for (var r = 0; r < n.colspan; r++) t += hot.Methods.getColWidth(o + r); else t = hot.Methods.getColWidth(o);
    return t
}

function S4() {
    return (65536 * (1 + Math.random()) | 0).toString(16).substring(1)
}

function guid() {
    return S4() + S4() + S4() + S4() + S4() + S4() + S4() + S4()
}

function guide_line(e) {
    var t = $(e).val(), a = $(e).find("option:selected").text();
    if ($(".wtSpreader .guide_line").remove(), null != t && "" != t && null != t) {
        var o = $(".htCore").height(), n = $('<line class="guide_line ' + t + '_guide" title="' + a + '"></line>');
        n.css("height", o), $(".wtSpreader").append(n)
    }
}

function loadToolsBar() {
    $(".toolbars").mCustomScrollbar({
        theme: "3d-dark",
        axis: "x",
        autoHideScrollbar: !0,
        scrollButtons: {enable: !0},
        advanced: {updateOnBrowserResize: !0, autoExpandHorizontalScroll: !0}
    }), $(window).resize(function () {
        $(".toolbars").mCustomScrollbar("update")
    });
    var e = document.documentElement.clientWidth;
    $(".toolbars .group .bar_shrink").each(function (e, t) {
        var a = $(t), o = a.parents(".group").width();
        a.css({left: o - 20 + "px"})
    }), $(".toolbars .group .bar_shrink").bind("click", function () {
        var e = $(this), t = e.parents(".group");
        if (t.hasClass("group_hidden")) {
            t.removeClass("group_hidden");
            var a = e.parents(".group").width();
            e.css({left: a - 20 + "px"})
        } else t.addClass("group_hidden"), e.removeAttr("style");
        initBarWidth()
    }), e < 1500 && $(".toolbars .group .bar_shrink").click()
}

function initBarWidth(e) {
    var o = 0;
    $(".toolbars .group").each(function (e, t) {
        var a = $(t).width();
        o += a
    }), o += 10, $(".customScrollbar").css({
        "min-width": o + "px",
        width: o + "px"
    }), $(".toolbars").mCustomScrollbar("update")
}

$(function () {
    (hot = new Hot).init(), initColWidthAndHeight(), $("#cellval").bind("keyup", function () {
        tb_cellval($(this).val())
    }), $("#cell-width").bind("input", function () {
        tb_width($(this).val())
    }), $("#cell-height").bind("input", function () {
        tb_height($(this).val())
    }), $("#bgColor").spectrum({
        showInput: !0,
        allowEmpty: !0,
        showAlpha: !0,
        showPalette: !0,
        togglePaletteOnly: !0,
        hideAfterPaletteSelect: !0,
        showSelectionPalette: !0,
        cancelText: "取消",
        chooseText: "确认",
        togglePaletteMoreText: "更多",
        togglePaletteLessText: "简略",
        palette: [["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"], ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"], ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"], ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"], ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"], ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"], ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"], ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]],
        change: function (e) {
            setBgColor(e ? e.toRgbaString() : ""), selectedCell = []
        },
        show: function (e) {
            selectedCell = hot.Methods.getSelected()
        },
        move: function (e) {
        }
    }), $("#fontColor").spectrum({
        showInput: !0,
        allowEmpty: !0,
        showAlpha: !1,
        showPalette: !0,
        togglePaletteOnly: !0,
        hideAfterPaletteSelect: !0,
        showSelectionPalette: !0,
        cancelText: "取消",
        chooseText: "确认",
        togglePaletteMoreText: "更多",
        togglePaletteLessText: "简略",
        palette: [["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"], ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"], ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"], ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"], ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"], ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"], ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"], ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]],
        change: function (e) {
            setFontColor(e ? e.toRgbString() : ""), selectedCell = []
        },
        show: function (e) {
            selectedCell = hot.Methods.getSelected()
        },
        move: function (e) {
        }
    }), $(".rows-btn").bind("click", function () {
        $(".select-div").hide();
        var e = $(this).outerHeight(!0) + $(this).offset().top, t = $(this).offset().left;
        return $(".select-ctrl-rows").css({top: e + "px", left: t + "px"}), $(".select-ctrl-rows").show(), !1
    }), $(".select-ctrl-rows li").bind("click", function () {
        var e = hot.Methods.getSelected();
        e && ("insertRowAbove" == $(this).data("ctrl") ? hot.Methods.alert("insert_row", e[0][0]) : "insertRowBelow" == $(this).data("ctrl") ? hot.Methods.alert("insert_row", e[0][0] + 1) : "delRow" == $(this).data("ctrl") && hot.Methods.alert("remove_row", e[0][0], e[0][2] - e[0][0] + 1))
    }), $(".cols-btn").bind("click", function () {
        $(".select-div").hide();
        var e = $(this).outerHeight(!0) + $(this).offset().top, t = $(this).offset().left;
        return $(".select-ctrl-cols").css({top: e + "px", left: t + "px"}), $(".select-ctrl-cols").show(), !1
    }), $(".select-ctrl-cols li").bind("click", function () {
        var e = hot.Methods.getSelected();
        e && ("insertColLeft" == $(this).data("ctrl") ? hot.Methods.alert("insert_col", e[0][1]) : "insertColRight" == $(this).data("ctrl") ? hot.Methods.alert("insert_col", e[0][1] + 1) : "delCol" == $(this).data("ctrl") && hot.Methods.alert("remove_col", e[0][1], e[0][3] - e[0][1] + 1))
    }), $(".select-ctrl-border li").bind("click", function () {
        setBorder($(this).data("ctrl"))
    }), $(document.body).bind("click", function (e) {
        $(".select-div").hide(), $(".showsql").remove(), 0 == $(e.target).parents(".dataExpr").length && $(".select-current").removeClass("select-current")
    }), $(".foot-switch").bind("click", function () {
        var e = $(".tb-foot").hasClass("tb-foot_left");
        $(".tb-foot").hasClass("on") ? ($(".tb-foot").removeClass("on"), e || $(".tb-center").removeClass("on")) : ($(".tb-foot").addClass("on"), e || $(".tb-center").addClass("on")), setTimeout(function () {
            hot.Methods.render()
        }, 400)
    }), $(".box ul li").bind("click", function () {
        $(this).addClass("on").siblings().removeClass("on"), $(".box .ct").eq($(".box ul li").index(this)).addClass("on").siblings().removeClass("on"), $(".tb-foot").hasClass("on") || ($(".tb-foot").addClass("on"), $(".tb-center").addClass("on")), setTimeout(function () {
            hot.Methods.render()
        }, 400)
    }), init(), (uuid = getQueryString("uuid")) && "" != uuid && "null" != uuid ? getTableDataByUUID(uuid) : cPush("init"), $("#fontsize").select2({tags: !0}), $("#fontsize").on("select2:select", function (e) {
        setFontSize(e.params.data.id)
    }), $("#tdchangeColor").spectrum({
        showInput: !0,
        allowEmpty: !0,
        showAlpha: !0,
        showPalette: !0,
        togglePaletteOnly: !0,
        hideAfterPaletteSelect: !0,
        showSelectionPalette: !0,
        cancelText: "取消",
        chooseText: "确认",
        togglePaletteMoreText: "更多",
        togglePaletteLessText: "简略",
        palette: [["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"], ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"], ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"], ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"], ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"], ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"], ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"], ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]],
        change: function (e) {
            $("#tdchangeColor").parents(".attrspan").find("input").val(e ? e.toRgbString() : ""), e ? ($("#tdchangeColor").css("background-color", e.toRgbString()), $("#tdchangeColor").css("background-image", "")) : ($("#tdchangeColor").css("background-color", ""), $("#tdchangeColor").css("background-image", "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)"))
        },
        show: function (e) {
            var t = $(".layui-layer").css("z-index");
            $("#tdchangeColor").spectrum("container").css("z-index", t + 1)
        },
        move: function (e) {
        }
    }), $("#tdchangeBgColor").spectrum({
        showInput: !0,
        allowEmpty: !0,
        showAlpha: !0,
        showPalette: !0,
        togglePaletteOnly: !0,
        hideAfterPaletteSelect: !0,
        showSelectionPalette: !0,
        cancelText: "取消",
        chooseText: "确认",
        togglePaletteMoreText: "更多",
        togglePaletteLessText: "简略",
        palette: [["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"], ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"], ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"], ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"], ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"], ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"], ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"], ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]],
        change: function (e) {
            $("#tdchangeBgColor").parents(".attrspan").find("input").val(e ? e.toRgbaString() : ""), e ? ($("#tdchangeBgColor").css("background-color", e.toRgbaString()), $("#tdchangeBgColor").css("background-image", "")) : ($("#tdchangeBgColor").css("background-color", ""), $("#tdchangeBgColor").css("background-image", "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)"))
        },
        show: function (e) {
            var t = $(".layui-layer").css("z-index");
            $("#tdchangeBgColor").spectrum("container").css("z-index", t + 1)
        },
        move: function (e) {
        }
    }), $(".table-warning .dataExprAttrAdd").bind("click", function () {
        warningTree.addLevel_1("condition_tree")
    }), $(".table-warning .dataExprAttrSymbol").bind("click", function () {
        null == $.fn.zTree.getZTreeObj("condition_tree") ? warningTree.addLevel_1("condition_tree") : 0 < warningTree.selectedNode().length ? warningTree.add("condition_tree") : layer.msg("未选中的条件项！")
    }), $(".table-warning .dataExprAttrUpdate").bind("click", function () {
        null != $.fn.zTree.getZTreeObj("condition_tree") ? warningTree.update("condition_tree") : layer.msg("未发发现可删除条件项！")
    }), $(".table-warning .dataExprAttrDel").bind("click", function () {
        null != $.fn.zTree.getZTreeObj("condition_tree") ? warningTree.del("condition_tree") : layer.msg("未发发现可删除条件项！")
    }), loadToolsBar()
}), window.addEventListener("load", function (e) {
    console.log("All resources finished loading!")
});
