var time=null;function sortTable(e,n){$(".checkul").remove();var t=document.getElementById(e),o=t.tBodies[0],l=o.rows,i=[],c=t.getElementsByTagName("thead")[0].getElementsByTagName("td")[n],e=c.getAttribute("sort"),t=c.style.width;c.style.setProperty("background-position-x",t),"desc"!=e&&"asc"==e?(c.setAttribute("sort","desc"),c.setAttribute("class","sort_desc")):(c.setAttribute("sort","asc"),c.setAttribute("class","sort_asc"));for(var s=0;s<l.length;s++)i[+s]=l[s];o.sortCol==n?i.reverse():i.sort(function(e,t){e=e.cells[n].innerHTML,t=t.cells[n].innerHTML;return isNaN(e)||isNaN(t)?e.localeCompare(t):e-t});for(var r=document.createDocumentFragment(),s=0;s<i.length;s++)r.appendChild(i[s]);o.appendChild(r),o.sortCol=n}function Drag(e){for(var f=document.getElementById("page1"),g=document.getElementById(e),e=g.tBodies[0],x=g.getElementsByTagName("thead")[0].getElementsByTagName("td"),t=e.getElementsByTagName("td"),b=document.getElementById("box"),m=$('<div style="display:none"></div>'),y=x.length,A=[],v=function(e){e.onmousedown=function(e){$(".checkul").remove();for(var t=(e=e||window.event).target||e.srcElement,n=t.offsetWidth,o=f.offsetWidth-n,r=g.rows,l=f.offsetLeft,t=t.offsetLeft,d=this,a=e.clientX-l-t,i=0;i<r.length;i++){var c=document.createElement("p");c.innerHTML=r[i].cells[this.cellIndex].innerHTML;var s=$(r[i].cells[this.cellIndex]).outerHeight(!0),p=$(r[i].cells[this.cellIndex]).outerWidth(!0);c.style.width=p+"px",c.style.height=s+"px",c.style.padding="0px",c.style.margin="0px";var u=$(r[i].cells[this.cellIndex]).css("background-color"),h=$(r[i].cells[this.cellIndex]).css("color"),p=$(r[i].cells[this.cellIndex]).css("font-size"),s=$(r[i].cells[this.cellIndex]).css("font-weight");"rgba(0, 0, 0, 0)"==u&&(u=$(r[i].cells[this.cellIndex]).parents("tr").css("background-color")),c.style.backgroundColor=u,c.style.fontSize=p,c.style.fontWeight=s,c.style.color=h,m.append($(r[i].cells[this.cellIndex]).prop("outerHTML")),b.appendChild(c)}for(i=0;i<x.length;i++)A.push(x[i].offsetLeft);b.style.display="block",b.style.width=n+"px",b.style.left=t+g.offsetLeft+"px",b.style.top=g.offsetTop+"px",document.onmousemove=function(e){((e=e||window.event).target||e.srcElement).offsetWidth;b.style.top=g.offsetTop+"px",b.style.left=e.clientX+g.offsetLeft-l-a+"px",b.offsetLeft>o?b.style.left=o+"px":b.offsetLeft<0&&(b.style.left=0),document.onselectstart=function(){return!1},window.getSelection?window.getSelection().removeAllRanges():doc.selection.empty()},document.onmouseup=function(e){for(var e=e||window.event,t=(b.getElementsByTagName("p"),b.offsetLeft+a),n=0,o=0;o<A.length;o++)A[o]<t&&(n=o);for(var l=d.cellIndex,o=0;o<r.length;o++){for(var i=$("<tr></tr>"),c=0;c<y;c++)l==c||n==c?n<=l?n==c?i.append($(m).find("td").eq(o).prop("outerHTML")):i.append($(r[o].cells[n]).prop("outerHTML")):l==c?i.append($(r[o].cells[n]).prop("outerHTML")):i.append($(m).find("td").eq(o).prop("outerHTML")):i.append($(r[o].cells[c]).prop("outerHTML"));if(r[o].innerHTML=i.html(),0!=o)for(var s=0;s<r[o].cells.length;s++)v(r[o].cells[s]);else{for(s=0;s<r[o].cells.length;s++)$(r[o].cells[s]).unbind().bind("click",function(){var e=$(this).index();clearTimeout(time),time=setTimeout(function(){sortTable("tableSort",e)},300)});changethead("tableSort")}}b.innerHTML="",m.html(""),A.splice(0,A.length),b.style.display="none",document.onmousemove=null,document.onmouseup=null,document.onselectstart=function(){return!1}}}},n=0;n<t.length;n++)v(t[n])}function changethead(t){$("#"+t).find("thead tr td").unbind("dblclick").bind("dblclick",function(e){clearTimeout(time);var i,e=getMousePos(e),c=$(".checkul");c.length?c.css({top:e.y,left:e.x}):((c=$('<ul class="checkul" style=" display: block;position: fixed;width: 85px;min-height: 30px;border: 1px solid;padding-left: 5px;background: white; border-radius: 2px; border: 1px solid #E6E5E5;-moz-box-shadow:0px 1px 7px #333333; -webkit-box-shadow:0px 1px 7px #333333; box-shadow:0px 1px 7px #333333;"></ul>')).css({top:e.y,left:e.x}),(i=$(this)).parent("tr").find("td").each(function(e,t){var n=$('<li style="text-align: left;"></li>'),o=void 0===$(this).attr("check")||"true"==$(this).attr("check");n.append('<input type="checkbox" value="'+e+'"/>'+$(this).text()),n.find("input[type='checkbox']").prop("checked",o),c.append(n)}),c.append('<li><input type="button" value="提交" style="height: 20px;background: #00A3FF;border-radius: 2px;font-size: 12px;color: #FFF;cursor: pointer;border: none;padding: 1px 8px;"/></li>'),c.find("input[type='button']").bind("click",function(){var o=new Array,l=0;$(this).parents("ul").find("input[type='checkbox']").each(function(e,t){var n=$(this).val();$(this).prop("checked")?(i.parent("tr").find("td").eq(n).attr("check",!0),l++,o[e]=!0):(i.parent("tr").find("td").eq(n).attr("check",!1),o[e]=!1)}),0==l?alert("未选择任何列！"):(hidenTd(t,o),c.remove())}),$("body").append(c))})}function hidenTd(e,o){var l=getMerg(e);$("#"+e).find("tr").each(function(n,e){$(this).find("td").each(function(e,t){1==l[n][e]&&(o[e]?$(this).show():$(this).hide())})})}function getMousePos(e){var t=e||window.event,n=document.documentElement.scrollLeft||document.body.scrollLeft,e=document.documentElement.scrollTop||document.body.scrollTop;return{x:t.pageX||t.clientX+n,y:t.pageY||t.clientY+e}}function getMerg(e){for(var e=$("#"+e),r=e.find("tbody tr")[0].cells.length,t=e[0].rows.length,d=new Array(new Array(r)),n=0;n<t;n++)d[n]=new Array(r);return e.find("tr").each(function(e,t){for(var n=0;n<r;n++)if(0!=d[e][n]){var o=$(t).find("td").size(),l=null==$(t).find("td").eq(n).attr("rowspan")?1:$(t).find("td").eq(n).attr("rowspan"),i=null==$(t).find("td").eq(n).attr("colspan")?1:$(t).find("td").eq(n).attr("colspan");if(n<=o)for(var c=0;c<l;c++)for(var s=0;s<i;s++)0==c&&0==s?d[e+c][n+s]=1:1!=d[e+c][n+s]&&(d[e+c][n+s]=0)}}),d}function initcol(e){var t,n,o;0<$(".sort_content").length?$(".sort_content").find(".col_div").find("input[type='button']").click():(t=$('<div class="sort_seach" style="text-align: left;padding: 5px 5px 5px 20px;margin: 5px;border: 1px solid #a0a2a5;border-radius: 2px;color: #323437;background-color: #fff;-webkit-box-shadow: 0 1px 5px rgba(0,0,0,.2);box-shadow: 0 1px 5px rgba(0,0,0,.2);"></div>'),(n=$('<div class="sort_content" style="position:  fixed;width: 100%;top: 0px;z-index: 1;background-color: white;"></div>')).append(t),$("#datalist").before(n),t.append('<div class="btn"><input type="button" value="自定义列" style="user-select: none;outline: 0;margin-bottom: 5px;width: 80px;height: 25px;line-height: 25px;border: 1px solid #d9dbdc;border-radius: 2px;color: #1276e5;background-color: #fff;cursor: pointer;font-size: 12px;"/></div>'),o=$('<div class="col_div" style="display:none;"></div>'),t.append(o),t.find(".btn").find("input[type='button']").bind("click",function(){$(".col_div").toggle(300,function(){$("#datalist").css({top:$(".sort_content").outerHeight(!0)})})}),$("#page1").find("table thead tr td").each(function(e,t){e=$('<span class="checkbox_item"><input type="checkbox" value="'+e+'"/><label class="check_label on"><i class="checkbox_icon "></i><em class="checkbox_text">'+$(this).text()+"</em></label></span>");e.find("input[type='checkbox']").prop("checked",!0),o.append(e)}),o.find(".check_label").checkbox(),o.append('<div><input type="button" value="确定" style="margin-top: 5px;display: inline-block;zoom: 1;padding: 4px 12px;border: 1px solid #d9dbdc;border-radius: 2px;text-align: center;line-height: 1;color: #0063d0;border-color: #d9dbdc;background-color: white;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;"/></div>'),$("#datalist").css({top:$(".sort_content").outerHeight(!0),position:"relative"}),t.find("input[type='button']").bind("click",function(){var n=new Array,o=0;$(this).parents(".sort_seach").find(".col_div").find("input[type='checkbox']").each(function(e,t){$(this).val();$(this).prop("checked")?(o++,n[e]=!0):n[e]=!1}),0==o?alert("未选择任何列！"):hidenTd(e,n)}))}$(function(){!function(){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.appendChild(n),t=".sort_asc{background:#ececec url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAV0lEQVQ4T2NkIBMw4tL3////AyA5RkZGB2xqRjUOqcDRZ2BguMDAwHCRkZGxADk+CcWjPUgTAwODAyMj4wdSNApg0wROUXiS3AQGBoYGdJtg6nFqJJT2AWw4Ng+GpYxlAAAAAElFTkSuQmCC) no-repeat 14px 13px;}",t+="  .sort_desc{background:#ececec url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAYElEQVQ4T+3SwQmAQAxE0T8d2IFbglaoJdiRlmQHIzksyLroehTMOY9hQsTD2O4k7eWa7lwgYJU0NsOMgEHSJaCaeEaR9AYukQQkoG+GuY/tGZh+WPmEbx0nHiBJ2somBwrcOA8tqIZuAAAAAElFTkSuQmCC) no-repeat 14px 13px;}";try{n.appendChild(document.createTextNode(t))}catch(e){n.styleSheet.cssText=t}}(),$.fn.extend({checkbox:function(){return this.each(function(){var e=$(this);e.hasClass("on")?e.siblings("input").prop("checked","checked"):e.siblings("input").removeAttr("checked"),e.on("click",function(){e.hasClass("on")?(e.siblings("input").removeAttr("checked"),e.removeClass("on")):(e.siblings("input").prop("checked","checked"),e.addClass("on"))})})}})});